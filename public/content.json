[{"title":"å­¦ä¹ å’Œè®¤è¯†Trove Strategies","date":"2017-10-17T07:28:57.000Z","path":"2017/10/17/introduction-to-trove-strategies/","text":"åœ¨Troveçš„ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹Troveçš„æ¶æ„å’Œå„ä¸ªç»„ä»¶ï¼Œæœ€è¿‘çœ‹åˆ°ä¸€å¼ å›¾ï¼Œæ„Ÿè§‰éå¸¸æ¸…æ™°ï¼Œåˆ—åˆ°è¿™é‡Œï¼š çœ‹å›¾ï¼Œå¯ä»¥ç®€å•å›é¡¾ä¸€ä¸‹ï¼ŒTroveè¿™ä¸ªåŸºäºOpenStackä¸­çš„è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œã€é•œåƒç­‰ä¹‹ä¸Šçš„ä¸€ä¸ªDBaaSé¡¹ç›®ï¼Œå›¾ä¸­å¯ä»¥çœ‹åˆ°å®ƒçš„å‡ ä¸ªç»„ä»¶ï¼Œä»¥åŠå®ƒè·Ÿå…¶ä»–OpenStackç»„ä»¶çš„äº¤äº’ã€‚ Trove strategieså¯¹äºTroveæ¥è®²ï¼Œå…¶ç›®æ ‡å°±æ˜¯æä¾›ä¸€ä¸ªæ•°æ®åº“æ— å…³çš„åŠŸèƒ½é›†ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ¡†æ¶å†…å®ç°æ‰©å±•ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¼•å…¥äº†Troveçš„Strategiesï¼Œå³ç­–ç•¥ã€‚ ç­–ç•¥æ˜¯Troveä¸­çš„ä¸€ä¸ªè®¾è®¡ç»“æ„ï¼Œå…è®¸å¼€å‘äººå‘˜åœ¨Troveä½œä¸ºæ•´ä½“æ¡†æ¶çš„å‰æä¸‹ï¼Œå»ºç«‹æŒ‡å®šæŠ½è±¡çš„æ–°çš„å®ç°æ¥æ‰©å±•Troveï¼Œä¸¾ä¸ªğŸŒ°æ¥è¯´æ˜â€”â€” æˆ‘ä»¬çŸ¥é“ï¼Œæ— è®ºæ˜¯MySQLã€PostgreSQLç­‰å…³ç³»å‹æ•°æ®åº“ï¼Œè¿˜æ˜¯å…¶ä»–çš„éå…³ç³»å‹æ•°æ®åº“æ¯”å¦‚MongoDBã€Redisï¼Œå‡æä¾›å¤‡ä»½çš„åŠŸèƒ½ã€‚ç„¶è€Œä¸åŒæ•°æ®åº“çš„å¤‡ä»½åŠŸèƒ½åˆæœ‰æ‰€å·®åˆ«ï¼Œç”šè‡³åŒä¸€ä¸ªæ•°æ®åº“å…·æœ‰ä¸åŒçš„é›†ä¸­æ–¹å¼æ¥äº§ç”Ÿä¸€ä¸ªå¤‡ä»½ã€‚ä¸‹é¢ç»“åˆMySQLå¤‡ä»½çš„æ¶ˆæ¯æµè½¬å›¾æ¥è¯´æ˜ï¼š MySQLå¤‡ä»½åŠŸèƒ½ä¸­çš„ç­–ç•¥ å®¢æˆ·ç«¯é€šè¿‡Trove APIå‘èµ·å¤‡ä»½çš„è¯·æ±‚ï¼Œé€šè¿‡é˜…è¯»ä»£ç æˆ‘ä»¬çŸ¥é“è°ƒç”¨çš„APIçš„æ–¹æ³•æ˜¯trove.backup.service.BackupController#createï¼ŒAPIé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å‘èµ·å¯¹Task Managerä¸­create_backupçš„å¼‚æ­¥è°ƒç”¨ï¼ˆè§trove.taskmanager.api.API#create_backupï¼‰:def create_backup(self, backup_info, instance_id): LOG.debug(\"Making async call to create a backup for instance: %s\" % instance_id) self._cast(\"create_backup\", self.version_cap, backup_info=backup_info, instance_id=instance_id) ç„¶åTask Managerä¸­ï¼ˆè§trove.taskmanager.manager.Manager#create_backupï¼‰:def create_backup(self, context, backup_info, instance_id): with EndNotification(context, backup_id=backup_info['id']): instance_tasks = models.BuiltInstanceTasks.load(context, instance_id) instance_tasks.create_backup(backup_info) å…¶ä¸­åˆè°ƒç”¨äº†BuildInstanceTasksä¸­çš„create_backupæ–¹æ³•ï¼Œè¿™é‡Œå®é™…å‘èµ·äº†å¯¹Guest Agentä¸­å¤‡ä»½åˆ›å»ºçš„è°ƒç”¨ï¼šdef create_backup(self, backup_info): LOG.info(_(\"Initiating backup for instance %s.\") % self.id) self.guest.create_backup(backup_info) å¯¹äºMySQLæ¥è®²ï¼ŒGuest Agentä¸­æˆ‘ä»¬è‚¯å®šè¦å»æ‰¾trove.guestagent.datastore.mysql_common.manager.MySqlManagerï¼Œé‚£ä¹ˆå¯¹åº”çš„æ–¹æ³•å°±æ˜¯ï¼šdef create_backup(self, context, backup_info): \"\"\" Entry point for initiating a backup for this guest agents db instance. The call currently blocks until the backup is complete or errors. If device_path is specified, it will be mounted based to a point specified in configuration. :param backup_info: a dictionary containing the db instance id of the backup task, location, type, and other data. \"\"\" with EndNotification(context): backup.backup(context, backup_info) æˆ‘ä»¬åœ¨å»çœ‹çœ‹backup.backup(context, backup_info)ï¼ˆè§trove.guestagent.backup.backupï¼‰ï¼šfrom trove.guestagent.backup.backupagent import BackupAgentAGENT = BackupAgent()def backup(context, backup_info): \"\"\" Main entry point for starting a backup based on the given backup id. This will create a backup for this DB instance and will then store the backup in a configured repository (e.g. Swift) :param context: the context token which contains the users details :param backup_id: the id of the persisted backup object \"\"\" return AGENT.execute_backup(context, backup_info) å…¶ä¸­ï¼Œå¯¹å®é™…æ‰§è¡Œå¤‡ä»½ï¼Œä½¿ç”¨çš„æ˜¯trove.guestagent.backup.backupagent.BackupAgentä¸­çš„execute_backupï¼šCONFIG_MANAGER = CONF.get('mysql' if not CONF.datastore_manager else CONF.datastore_manager)STRATEGY = CONFIG_MANAGER.backup_strategyBACKUP_NAMESPACE = CONFIG_MANAGER.backup_namespaceRESTORE_NAMESPACE = CONFIG_MANAGER.restore_namespaceRUNNER = get_backup_strategy(STRATEGY, BACKUP_NAMESPACE)class BackupAgent(object): ... def execute_backup(self, context, backup_info, runner=RUNNER, extra_opts=EXTRA_OPTS, incremental_runner=INCREMENTAL_RUNNER): LOG.debug(\"Running backup %(id)s.\", backup_info) ... self.stream_backup_to_storage(context, backup_info, runner, storage, parent_metadata, extra_opts) æ³¨æ„BACKUP_NAMESPACEæŒ‡æ˜äº†ç­–ç•¥çš„å‘½åç©ºé—´ï¼Œè¿™é‡Œçš„RUNNERï¼Œæ‰æ˜¯å®é™…åŠ è½½å¤‡ä»½ç­–ç•¥çš„åœ°æ–¹ï¼Œå½“ç„¶ï¼Œè¦æ ¹æ®/trove/common/cfg.pyä¸­çš„é…ç½®ï¼šcfg.StrOpt('backup_namespace', default='trove.guestagent.strategies.backup.mysql_impl', help='Namespace to load backup strategies from.', deprecated_name='backup_namespace', deprecated_group='DEFAULT'),cfg.StrOpt('backup_strategy', default='InnoBackupEx', help='Default strategy to perform backups.', deprecated_name='backup_strategy', deprecated_group='DEFAULT'), å½“ç„¶ï¼Œè¿™éƒ¨åˆ†é…ç½®æˆ‘ä»¬æ˜¯å¯ä»¥åœ¨trove-guestagent.confä¸­é…ç½®çš„ï¼š# ========== Datastore Specific Configuration Options ==========...[mysql]# For mysql, the following are the defaults for backup, and restore:backup_strategy = InnoBackupExbackup_namespace = trove.guestagent.strategies.backup.mysql_impl... é‚£æˆ‘ä»¬å°±çŸ¥é“ï¼Œå…¶å®MySQLçš„å¤‡ä»½ä½¿ç”¨çš„æ˜¯trove.guestagent.strategies.backup.mysql_impl.InnoBackupExï¼šclass InnoBackupEx(base.BackupRunner): \"\"\"Implementation of Backup Strategy for InnoBackupEx.\"\"\" __strategy_name__ = 'innobackupex' ... @property def cmd(self): cmd = ('sudo innobackupex' ' --stream=xbstream' ' %(extra_opts)s ' + self.user_and_pass + MySqlApp.get_data_dir() + ' 2&gt;/tmp/innobackupex.log' ) return cmd + self.zip_cmd + self.encrypt_cmd ... è¿™é‡Œé¢å¤–è¯´ä¸€ä¸‹ï¼Œç©¶ç«Ÿæ˜¯åœ¨å“ªé‡Œè§¦å‘æ‰§è¡Œçš„å¤‡ä»½å‘¢ï¼Ÿ åœ¨å‰é¢self.stream_backup_to_storage(context, backup_info, runner, storage, parent_metadata, extra_opts)ä¸­ï¼Œä½¿ç”¨äº†withæ¥æ‰§è¡Œrunnerï¼šdef stream_backup_to_storage(self, context, backup_info, runner, storage, parent_metadata=&#123;&#125;, extra_opts=EXTRA_OPTS): ... try: with runner(filename=backup_id, extra_opts=extra_opts, **parent_metadata) as bkup: LOG.debug(\"Starting backup %s.\", backup_id) ... å³è¿™é‡Œï¼Œè°ƒç”¨äº†InnoBackupExçš„æ„é€ æ–¹æ³•ï¼Œè€ŒInnoBackupExæ˜¯ç»§æ‰¿è‡ªBackupRunnerï¼Œåˆ™ï¼šclass BackupRunner(Strategy): \"\"\"Base class for Backup Strategy implementations.\"\"\" __strategy_type__ = 'backup_runner' __strategy_ns__ = 'trove.guestagent.strategies.backup' # The actual system call to run the backup cmd = None is_zipped = CONF.backup_use_gzip_compression is_encrypted = CONF.backup_use_openssl_encryption encrypt_key = CONF.backup_aes_cbc_key def __init__(self, filename, **kwargs): self.base_filename = filename self.process = None self.pid = None kwargs.update(&#123;'filename': filename&#125;) self.command = self.cmd % kwargs super(BackupRunner, self).__init__() ... def _run(self): LOG.debug(\"BackupRunner running cmd: %s\", self.command) self.process = subprocess.Popen(self.command, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, preexec_fn=os.setsid) self.pid = self.process.pid def __enter__(self): \"\"\"Start up the process.\"\"\" self._run_pre_backup() self._run() return self ... çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±çŸ¥é“å¤‡ä»½æ‰§è¡Œæ˜¯åœ¨å“ªé‡Œè§¦å‘çš„äº†â€”â€”é¦–å…ˆï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œé€šè¿‡self.command = self.cmd % kwargsè·å–äº†InnoBackupExä¸­çš„cmdï¼Œç„¶åå› ä¸ºæˆ‘ä»¬ä½¿ç”¨withæ¥è°ƒç”¨ï¼Œåˆ™ä¼šè°ƒç”¨__enter__(self)æ–¹æ³•ï¼Œå…¶ä¸­çš„_run(self)ä¸­ä½¿ç”¨Popenåç¨‹æ¥çœŸæ­£çš„æ‰§è¡Œã€‚åé¢è¡¥å……ä¸€ç¯‡å¯¹eventlentå’ŒPopençš„å­¦ä¹ å¿ƒå¾—ã€‚ å…¶ä»–ç­–ç•¥åº”ç”¨åœºæ™¯é™¤äº†ä¸Šé¢ä¾‹å­ä¸­çš„MySQLå¤‡ä»½åŠŸèƒ½ï¼ŒTroveçš„Strategiesè¿˜å¯ä»¥é€šè¿‡æ‰©å±•Guest Agentã€APIå’ŒTask Managerç­‰æ¥å®ç°é›†ç¾¤çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸‹é¢åˆ—ä¸¾äº†MongoDBä¸­çš„æ‰©å±•ï¼šcfg.StrOpt('api_strategy', default='trove.common.strategies.cluster.experimental.' 'mongodb.api.MongoDbAPIStrategy', help='Class that implements datastore-specific API logic.'),cfg.StrOpt('taskmanager_strategy', default='trove.common.strategies.cluster.experimental.mongodb.' 'taskmanager.MongoDbTaskManagerStrategy', help='Class that implements datastore-specific task manager ' 'logic.'),cfg.StrOpt('guestagent_strategy', default='trove.common.strategies.cluster.experimental.' 'mongodb.guestagent.MongoDbGuestAgentStrategy', help='Class that implements datastore-specific Guest Agent API ' 'logic.'), å½“ç”¨æˆ·è¯·æ±‚APItrove.cluster.service.ClusterController#createï¼Œå¯¹MongoDBåˆ›å»ºé›†ç¾¤æ—¶ï¼Œç»è¿‡å„ç§è°ƒç”¨ï¼Œä¼šå»æ‰§è¡Œtrove.common.strategies.cluster.experimental.mongodb.api.MongoDbCluster#createæ¥åˆ›å»ºMongoDBçš„Clusterã€‚åé¢çš„å…·ä½“æµç¨‹æˆ‘ä»¬è¿™é‡Œå°±åœ¨èµ˜è¿°äº†ï¼Œæ„Ÿå…´è¶£çš„ç«¥é‹å¯ä»¥å»é˜…è¯»ä¸€ä¸‹ä»£ç ã€‚ä¸è¿‡ç›®å‰åœ¨MongoDBé›†ç¾¤åŠŸèƒ½ä¸­ï¼Œè¿˜æ²¡æœ‰åŒºåˆ†Replica setå’ŒShardï¼Œéœ€è¦ç´§è·Ÿä¸Šæ¸¸æˆ–è€…è‡ªå·±å®ç°ï¼ˆæœ‰ä½åŒäº‹æœ€è¿‘åœ¨åšè¿™é¡¹åŠŸèƒ½ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¸Œæœ›æäº¤ä¸Šæ¸¸çš„â€¦â€¦è¿™å°±è·‘é¢˜äº†ğŸ˜‚ï¼‰ ç»“è¯­æœ¬æ–‡ä¸»è¦ä»¥MySQLå¤‡ä»½çš„ä»£ç è¿‡ç¨‹ä¸ºä¾‹ï¼Œè®²è§£äº†Troveä¸­çš„Strategiesçš„åº”ç”¨ï¼Œäº†è§£å…¶åŸºæœ¬åŸç†å’Œå‡ ä¸ªä½¿ç”¨åœºæ™¯ï¼ŒåŒæ—¶åœ¨çœ‹ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°çš„æ–°çš„çŸ¥è¯†ç‚¹eventletå’Œeventlet.green.subprocess.Popenï¼Œå€¼å¾—æˆ‘ä»¬å»å­¦ä¹ å’Œç ”ç©¶ä¸€ç•ªã€‚ å‚è€ƒ[1].OpenStack Trove by Amrith Kumar[2].OpenStack Architecture[3].openstack/trove","tags":[{"name":"OpenStack","slug":"OpenStack","permalink":"http://elbarco.cn/tags/OpenStack/"},{"name":"Trove","slug":"Trove","permalink":"http://elbarco.cn/tags/Trove/"}]},{"title":"Gitä¸­ä½¿ç”¨rebaseå‘½ä»¤æ›´æ–°æœ¬åœ°åˆ†æ”¯","date":"2017-09-28T06:34:49.000Z","path":"2017/09/28/git-rebase-local-branch-with-upstream-branch/","text":"æœ€è¿‘åœ¨å¼€å‘troveä¸­ï¼Œå› ä¸ºè¯¯æäº¤ï¼Œæœ¬åœ°é¡¹ç›®çš„develåˆ†æ”¯å·²ç»ä¸ä¸Šæ¸¸çš„çš„develåˆ†æ”¯ä¸ä¸€è‡´äº†ã€‚ä¸ºäº†æ›´å¥½çš„åˆ›å»ºåˆ†æ”¯ï¼Œæˆ–è€…åé¢è¿›è¡Œcherry-pickå‡†å¤‡æ‰“åŒ…ï¼Œéƒ½éœ€è¦å°†æœ¬åœ°çš„åˆ†æ”¯ä¸ä¸Šæ¸¸çš„åˆ†æ”¯åšä¸€ä¸‹rebaseã€‚ æ³¨ï¼šä¸Šæ¸¸æŒ‡çš„æ˜¯eayunstack/troveï¼Œæœ¬åœ°æŒ‡çš„æ˜¯2hf/trove é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ·»åŠ upstreamè¿œç¨‹ä»“åº“ï¼š$ git remoteorigin$ git remote add upstream git@github.com:eayunstack/trove.git$ git remote -vorigin git@github.com:2hf/trove.git (fetch)origin git@github.com:2hf/trove.git (push)upstream git@github.com:eayunstack/trove.git (fetch)upstream git@github.com:eayunstack/trove.git (push) ç„¶åæ›´æ–°upstreamï¼š$ git fetch upstream æ­¤æ—¶è¿œç¨‹ä»“åº“å·²ç»å‡†å¤‡å°±ç»ªäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥rebaseæœ¬åœ°çš„åˆ†æ”¯äº†ã€‚ä¸¤ç§åšæ³•ï¼š# option one$ git checkout devel$ git rebase -i upstream/devel# option two$ git checkout devel$ git reset --hard upstream/devel æ³¨ï¼šå¦‚æœä¹‹å‰2hf/develåˆ†æ”¯å·²ç»åšè¿‡pushäº†ï¼Œä¸ºäº†ä¿æŒä¸ä¸Šæ¸¸ä¸€è‡´ï¼Œéœ€è¦git push -fã€‚","tags":[{"name":"Git","slug":"Git","permalink":"http://elbarco.cn/tags/Git/"},{"name":"rebase","slug":"rebase","permalink":"http://elbarco.cn/tags/rebase/"}]},{"title":"Pythonä¸­çš„è£…é¥°å™¨â€”â€”è£…é¥°å™¨å‚æ•°ç¯‡","date":"2017-09-20T08:52:14.000Z","path":"2017/09/20/python-introduction-to-decorator-arguments/","text":"å…ˆä¸¾ä¸ªä¾‹å­åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°çš„è£…é¥°å™¨çš„ä¾‹å­æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œå°±æ˜¯åªæ¥æ”¶è¢«è£…é¥°çš„æ–¹æ³•ä½œä¸ºå‚æ•°ã€‚ä½†æ˜¯åœ¨å¾ˆå¤šæ—¶å€™ï¼Œè£…é¥°å™¨æœ¬èº«æ¥æ”¶æ›´å¤šçš„å‚æ•°æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ä½†æ˜¯å¦‚ä½•åšåˆ°å‘¢ï¼Ÿæˆ‘ä»¬å…ˆå›æƒ³ä¸€ä¸‹åŸºæœ¬çš„è£…é¥°å™¨ï¼Œå®ƒåœ¨å†…éƒ¨å£°æ˜ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åå°†è¿™ä¸ªå†…éƒ¨æ–¹æ³•è¿”å›ï¼Œå³è¢«è£…é¥°å™¨è¿”å›çš„callableã€‚å¦‚æœè¦ä½¿è£…é¥°å™¨æ¥æ”¶æ›´å¤šçš„å‚æ•°ï¼Œæˆ‘ä»¬å°±è¦å†åŒ…è£…ä¸€å±‚â€”â€”å³æ¥æ”¶å‚æ•°çš„â€è£…é¥°å™¨â€å¹¶ä¸æ˜¯çœŸæ­£çš„è£…é¥°å™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªè¿”å›è£…é¥°å™¨çš„å‡½æ•°ï¼Œè€ŒçœŸæ­£çš„è£…é¥°å™¨è´Ÿè´£æ¥æ”¶è¢«è£…é¥°çš„æ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œç„¶åè£…é¥°æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªcallableã€‚ è¿˜æ˜¯ç”¨å‰é¢json_outputçš„ä¾‹å­ï¼Œç®€å•æ”¹é€ ä¸€ä¸‹ï¼šimport functoolsimport jsonclass JSONOutputError(Exception): def __init__(self, message): self._message = message def __str__(self): return self._messagedef json_output(indent=None, sort_keys=False): \"\"\"Run the decorated function, serialize the result of that function to JSON, and return the JSON string. \"\"\" def actual_decorator(decorated): @functools.wraps(decorated) def inner(*args, **kwargs): try: result = decorated(*args, **kwargs) except JSONOutputError as ex: result = &#123; 'state': 'error', 'message': str(ex), &#125; return json.dumps(result, indent=indent, sort_keys=sort_keys) return inner return actual_decorator å¯ä»¥çœ‹åˆ°ï¼Œåœ¨json_outputä¸­ï¼Œä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°indentå’Œsort_keys, è¿”å›çš„æ˜¯è£…é¥°å™¨actual_decoratorï¼Œè€Œåœ¨innerä¸­ç”¨åˆ°äº†ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°ï¼Œç”¨äºJSONæ ¼å¼åŒ–æ—¶çš„ç¼©è¿›å’ŒKeyçš„æ’åºå±•ç¤ºï¼Œæ¥çœ‹è¿™ä¸ªè£…é¥°å™¨çš„æ•ˆæœï¼š@json_output(indent=4, sort_keys=True)def do_nothing(): return &#123;'status': 'done','a': '1'&#125;# output &#123; \"a\": \"1\", \"status\": \"done\"&#125; è¿˜æœ‰è¿™ç§æ“ä½œï¼Ÿé€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè£…é¥°å™¨æ˜¯actual_decoratorè€Œä¸æ˜¯json_outputï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœjson_outputä¸æ˜¯è£…é¥°å™¨è€Œåªæ˜¯ä¸€ä¸ªè¿”å›è£…é¥°å™¨çš„å‡½æ•°ï¼Œä¸ºä»€ä¹ˆå¯ä»¥åƒè£…é¥°å™¨ä¸€æ ·ä½¿ç”¨ï¼Ÿ é—®é¢˜çš„å…³é”®åœ¨äºæ“ä½œçš„é¡ºåºã€‚å…·ä½“æ¥è¯´ï¼Œjson_output(indent=4,sort_keys=True)çš„è°ƒç”¨åœ¨å‰ï¼Œ@æ“ä½œç¬¦åº”ç”¨åœ¨åï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°çš„ç»“æœå°±ä¼šè¢«å½“ä½œè£…é¥°å™¨ä½¿ç”¨ã€‚å³å…ˆè°ƒç”¨json_outputï¼Œå…¶ä¸­å®šä¹‰äº†è£…é¥°å™¨actual_decoratorï¼Œå¹¶ä¸”ç”±json_outputè¿”å›ï¼Œåˆ™æ­¤æ—¶å†åº”ç”¨@æ“ä½œç¬¦å°±ç­‰ä»·äºï¼š@actual_decoratordef do_nothing(): return &#123;'status': 'done','a': '1'&#125; è¿™ä¸å°±ç›¸å½“äºåœ¨ä¸€ä¸ªå‡½æ•°ä¸Šåº”ç”¨è£…é¥°å™¨å˜›ï¼ é‡è¦çš„ä¸€ç‚¹æ˜¯è¦æ„è¯†åˆ°ï¼Œå½“æˆ‘ä»¬å¼•å…¥æ–°çš„json_outputå‡½æ•°æ—¶ï¼Œå®é™…ä¸Šå¼•å…¥äº†ä¸€ä¸ªåå‘ä¸å…¼å®¹çš„ä¿®æ”¹ã€‚ ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿå› ä¸ºç°åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªé¢„æœŸçš„é¢å¤–å‡½æ•°è°ƒç”¨ã€‚å¦‚æœè¿™é‡Œæˆ‘ä»¬ä¸æƒ³ç»™json_outputä¼ é€’å‚æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾ç„¶è¦è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå³ç¨‹åºå¿…é¡»è¿™ä¹ˆå†™ï¼š@json_output()def do_nothing(): return &#123;'status': 'done','a': '1'&#125; å·å¤–ï¼šä¸€å®šè¦æ³¨æ„åœ†æ‹¬å·ï¼å› ä¸ºè¿™è¡¨ç¤ºå‡½æ•°æ˜¯è¢«è°ƒç”¨ï¼Œç„¶åå‡½æ•°ç»“æœè¢«åº”ç”¨@ã€‚ ä¸Šé¢çš„ä»£ç ï¼Œä¸ç­‰åŒäºï¼Œæ³¨æ„ï¼Œæ˜¯ä¸ç­‰åŒäºä¸‹é¢çš„å†™æ³•ï¼š@json_outputdef do_nothing(): return &#123;'status': 'done','a': '1'&#125;# print do_nothing() outputTypeError: actual_decorator() takes exactly 1 argument (0 given) è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼šå…¶ä¸€æ˜¯æ¯”è¾ƒè®©äººç–‘æƒ‘ï¼Œå› ä¸ºä¸€æ—¦ä¹ æƒ¯äºè§åˆ°æ²¡æœ‰æ‹¬å·çš„è£…é¥°å™¨ï¼Œè§åˆ°ç±»ä¼¼json_outputè¿™ç§å°±ä¼šè§‰å¾—åå¸¸ï¼›å…¶äºŒæ˜¯å¦‚æœæ—§çš„è£…é¥°å™¨å·²ç»åº”ç”¨äº†å…¶ä»–å¾ˆå¤šåœ°æ–¹ï¼Œå¦‚æœä¿®æ”¹äº†è¿™ä¸ªè£…é¥°å™¨ç±»ä¼¼ä¸Šé¢çš„ä¾‹å­ï¼Œé‚£ä¹ˆå…¶ä»–åº”ç”¨çš„åœ°æ–¹è¦ä¸€å¹¶ä¿®æ”¹ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªåå‘ä¸å…¼å®¹çš„æ›´æ”¹ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›è£…é¥°å™¨åœ¨ç¨‹åºä¸­å¯¹äºä¸‹åˆ—ä¸‰ç§åº”ç”¨æ–¹å¼éƒ½èƒ½å…¼å®¹ï¼š @json_output @json_output() @json_output(indent=4, sort_keys=True) å®æ—¶è¯æ˜ï¼Œè¿™æ˜¯å¯è¡Œçš„ï¼Œåªéœ€è¦è®©è£…é¥°å™¨æ ¹æ®å‚æ•°æ¥æ”¹å˜å…¶è¡Œä¸ºå³å¯ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ”¹å†™ä¸€ä¸‹json_outputï¼šdef json_output(decorated_=None, indent=None, sort_keys=False): \"\"\"Run the decorated function, serialize the result of that function to JSON, and return the JSON string. \"\"\" if decorated_ and (indent or sort_keys): raise RuntimeError('Unexpected arguments.') def actual_decorator(func): @functools.wraps(func) def inner(*args, **kwargs): try: result = func(*args, **kwargs) except JSONOutputError as ex: result = &#123; 'state': 'error', 'message': str(ex), &#125; return json.dumps(result, indent=indent, sort_keys=sort_keys) return inner if decorated_: return actual_decorator(decorated_) else: return actual_decorator æ³¨æ„ï¼Œæˆ‘ä»¬ä¸ºjson_outputå¢åŠ äº†ä¸€ä¸ªå…¥å‚ï¼Œdecorated_=Noneï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›åŒæ—¶ä¼ é€’è¢«è£…é¥°çš„æ–¹æ³•å’Œå…³é”®å­—å‚æ•°ï¼Œæ‰€ä»¥åœ¨json_outputä¸­å…ˆåšæ£€æŸ¥ï¼Œæ¥ç¡®ä¿æˆ‘ä»¬è¦ä¹ˆåªä¼ é€’è¢«è£…é¥°çš„æ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œè¦ä¹ˆåªä¼ é€’å…³é”®å­—å‚æ•°ã€‚æ¥ç€ï¼Œactual_decoratoræ˜¯å®é™…çš„è£…é¥°å™¨ã€‚æœ€ç»ˆï¼Œå¦‚æœè®¾ç½®äº†decorated_ï¼Œå³é‡‡ç”¨@json_outputè¿™ç§æ–¹å¼å»ä¿®é¥°do_nothingæ–¹æ³•ï¼ˆç­‰ä»·äºdo_nothing = json_output(decorated_=do_nothing)ï¼‰ï¼Œåˆ™æ­¤æ—¶çš„json_outputå°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥è¿”å›çš„æ˜¯actual_decorator(decorated_)ï¼›å¦‚æœæ²¡æœ‰è®¾ç½®decorated_ï¼Œåˆ™è¿™å°±æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå³å¯ä»¥é€šè¿‡@json_output()æˆ–@json_output(indent=4)çš„æ–¹å¼åº”ç”¨åˆ°do_nothing()ä¸Šå»â€”â€”# 1def do_nothing(): return &#123;'status': 'done','a': '1'&#125;do_nothing = json_output(decorated_=do_nothing)print do_nothing()# 1 - output&#123;\"status\": \"done\", \"a\": \"1\"&#125;# 2@json_outputdef do_nothing(): return &#123;'status': 'done','a': '1'&#125;print do_nothing()# 2 - output&#123;\"status\": \"done\", \"a\": \"1\"&#125;# 3@json_output()def do_nothing(): return &#123;'status': 'done','a': '1'&#125;print do_nothing()# 3 - output&#123;\"status\": \"done\", \"a\": \"1\"&#125;# 4@json_output(indent=4, sort_keys=True)def do_nothing(): return &#123;'status': 'done','a': '1'&#125;print do_nothing()# 4 - output&#123; \"a\": \"1\", \"status\": \"done\"&#125;# 5def do_nothing(): return &#123;'status': 'done','a': '1'&#125;do_nothing = json_output(decorated_=do_nothing, indent=4)print do_nothing()# 5 - outputTraceback (most recent call last): File \"/decorators/output.py\", line 77, in &lt;module&gt; do_nothing = json_output(decorated_=do_nothing, indent=4) File \"/decorators/output.py\", line 18, in json_output raise RuntimeError('Unexpected arguments.')RuntimeError: Unexpected arguments. 1ã€2ç­‰ä»·ï¼Œjson_outputå°±æ˜¯ä¸€ä¸ªå®å®åœ¨åœ¨çš„è£…é¥°å™¨ï¼›3ã€4ä¸­çš„json_outputåˆ™æ˜¯ä¸€ä¸ªå¸¦å‚æ•°çš„è£…é¥°å™¨ã€‚ ç»“è¯­æœ¬ç¯‡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•ç»™â€è£…é¥°å™¨â€ä¼ é€’æ›´å¤šçš„å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿå­¦åˆ°äº†å¦‚ä½•è®©â€è£…é¥°å™¨â€æ›´çµæ´»ï¼Œä»¥é€‚åº”ä¸åŒçš„åº”ç”¨å½¢å¼ã€‚","tags":[{"name":"Python","slug":"Python","permalink":"http://elbarco.cn/tags/Python/"},{"name":"decorator","slug":"decorator","permalink":"http://elbarco.cn/tags/decorator/"}]},{"title":"Pythonä¸­çš„è£…é¥°å™¨â€”â€”åˆè¯†ç¯‡","date":"2017-09-20T06:53:15.000Z","path":"2017/09/20/python-introduction-to-decorators-with-examples/","text":"è®¤è¯†è£…é¥°å™¨è£…é¥°å™¨ç®€å•æ¥è®²å°±æ˜¯ä¸€ä¸ªæ¥æ”¶è¢«è£…é¥°çš„å‡½æ•°ä½œä¸ºå›ºå®šå‚æ•°çš„å‡½æ•°ï¼ˆæˆ–ç§°ä¸ºcallableï¼Œæ¯”å¦‚ä¸€ä¸ªå¯¹è±¡å…·æœ‰callæ–¹æ³•ï¼‰ï¼Œå¹¶ä¸”å¯¹è¢«è£…é¥°çš„å‡½æ•°åšäº›å¤„ç†ã€‚ä¸¾ä¸ªä¾‹å­ï¼šdef decorated_by(func): func.__doc__ += '\\nDecorated by decorated_by.' return funcdef add(x, y): \"\"\"Return the sum of x and y.\"\"\" return x + yif __name__ == '__main__': add = decorated_by(add) print add.__doc__# output Return the sum of x and y.Decorated by decorated_by. å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªå…³å¿ƒæœ€ç»ˆè¢«è£…é¥°çš„å‡½æ•°ï¼Œè€ŒæŒæœ‰è£…é¥°å™¨å‡½æ•°çš„å¼•ç”¨åŸºæœ¬ä¸Šæ˜¯æ²¡å¿…è¦çš„ã€‚æ‰€ä»¥ï¼Œåœ¨Python 2.5ä¸­å¼•å…¥äº†å¯¹è£…é¥°å™¨çš„ç‰¹æ®Šè¯­æ³•â€”â€”è£…é¥°å™¨çš„åº”ç”¨å¯ä»¥é€šè¿‡åœ¨è¢«è£…é¥°çš„å‡½æ•°ä¸Šé¢ä¸€è¡Œæ·»åŠ @å­—ç¬¦ï¼Œå…¶åç´§è·Ÿè£…é¥°å™¨å‡½æ•°åçš„è¿™ç§æ–¹å¼ï¼šæ¯”å¦‚é’ˆå¯¹ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™ä½œï¼š@decorated_bydef add(x, y): \"\"\"Return the sum of x and y.\"\"\" return x + yif __name__ == '__main__': # add = decorated_by(add) add(1, 2) print add.__doc__# outputReturn the sum of x and y.Decorated by decorated_by. æ·»åŠ @+è£…é¥°å™¨åçš„è¿™ç§æ–¹å¼å°±ç­‰ä»·äº add = decorated_by(add)ã€‚è¿™ç§æ–¹å¼çœ‹èµ·æ¥æ›´ç®€æ´æ˜äº†ã€‚ è£…é¥°å™¨åº”ç”¨çš„é¡ºåºå½“@è¯­æ³•è¢«ä½¿ç”¨æ—¶ï¼Œè£…é¥°å™¨ä¼šåœ¨è¢«è£…é¥°çš„callableè¢«åˆ›å»ºåç«‹å³è°ƒç”¨ï¼ˆå³è£…é¥°å™¨çš„ä»£ç æ˜¯åœ¨åº”ç”¨åˆ°è¢«è£…é¥°çš„å‡½æ•°ä¸Šæ—¶æ‰§è¡Œï¼Œè€Œä¸æ˜¯è¢«è£…é¥°çš„å‡½æ•°è°ƒç”¨æ—¶æ‰§è¡Œï¼‰ã€‚å°±ä¸Šé¢çš„ä¾‹å­è€Œè¨€ï¼Œå°±æ˜¯addå‡½æ•°è¢«åˆ›å»ºåï¼Œç´§æ¥ç€decorated_byå‡½æ•°è¢«åº”ç”¨ã€‚é‚£ä¹ˆå¦‚æœå¯¹äºå•ä¸ªcallableä½¿ç”¨@è¯­æ³•åº”ç”¨å¤šä¸ªè£…é¥°å™¨æ—¶ï¼ˆPythonä¸­æ˜¯æ”¯æŒè¿™ç§åœºæ™¯çš„ï¼‰ï¼Œè£…é¥°å™¨çš„åº”ç”¨é¡ºåºæœ‰äº‹æ€æ ·çš„ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼šä»ä¸‹å¾€ä¸Šï¼ŒæŒ‰é¡ºåºæ‰§è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬æœ‰å¦å¤–çš„ä¸€ä¸ªå‡½æ•°å«åšalso_decorated_byï¼Œä¹Ÿæ˜¯åœ¨func.docåé¢æ·»åŠ ä¸€æ®µè¯ï¼Œç„¶åå¯¹addå‡½æ•°åº”ç”¨è¯¥è£…é¥°å™¨ï¼šdef also_decorated_by(func): func.__doc__ += '\\nAlso decorated by also_decorated_by.' return func@also_decorated_by@decorated_bydef add(x, y): \"\"\"Return the sum of x and y.\"\"\" return x + y æŒ‰ç…§ä»ä¸‹å¾€ä¸Šçš„é¡ºåºï¼Œæˆ‘ä»¬çŸ¥é“å½“æˆ‘ä»¬è°ƒç”¨addåï¼Œæ‰§è¡Œdecorated_byç›¸å½“äºadd = decorated_by(add) ï¼Œç„¶åå¯¹æ­¤æ—¶çš„addåº”ç”¨also_decorated_byï¼Œå°±ç›¸å½“äºadd = also_decorated_by(decorated_by(add))ã€‚æœ€ç»ˆçš„ç»“æœæ­£æ˜¯ï¼šif __name__ == '__main__': # add = decorated_by(add) add(1, 2) print add.__doc__Return the sum of x and y.Decorated by decorated_by.Also decorated by also_decorated_by. è£…é¥°å™¨çš„åº”ç”¨åœºæ™¯æ ‡å‡†åº“ä¸­çš„å¾ˆå¤šæ¨¡å—éƒ½åŒ…å«æœ‰è£…é¥°å™¨ï¼Œè®¸å¤šå¸¸è§çš„å·¥å…·å’Œæ¡†æ¶éƒ½å°†å…¶ç”¨äºå¸¸è§çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦åœ¨ç±»ä¸Šåˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ä¸éœ€è¦è¯¥ç±»çš„å®ä¾‹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨@classmethodæˆ–@staticmethodè£…é¥°å™¨ï¼Œè¿™æ˜¯æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªç®€å•ä¾‹å­ã€‚å¸¸ç”¨çš„å·¥å…·ä¸­ä¹Ÿæ˜¯ç”¨è£…é¥°å™¨ï¼Œæ¯”å¦‚å¸¸è§çš„Python Webæ¡†æ¶Djangoä¸­ï¼Œä½¿ç”¨@login_requiredä½œä¸ºè£…é¥°å™¨å…è®¸å¼€å‘è€…æŒ‡å®šç”¨æˆ·åœ¨è®¿é—®ç‰¹å®šé¡µé¢æ—¶å¿…é¡»è¦ç™»å½•ã€‚å¦å¤–ä¸€ä¸ªWebæ¡†æ¶Flaskä¸­ä½¿ç”¨@app.routeæ¥æ³¨å†ŒæŒ‡å®šçš„URIè¢«è®¿é—®åˆ°æ—¶è¦æ‰§è¡Œçš„å‡½æ•°ã€‚å†æ¯”å¦‚ï¼ŒCeleryä¸­ä½¿ç”¨ä¸€ä¸ªå¤æ‚çš„@taskè£…é¥°å™¨æ¥æ ‡è¯†ä¸€ä¸ªå‡½æ•°ä¸ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œè¿™ä¸ªè£…é¥°å™¨çš„è¿”å›å®é™…ä¸Šæ˜¯ä¸€ä¸ªTaskç±»çš„å®ä¾‹ï¼Œå±•ç¤ºå‡ºäº†å¦‚ä½•ç”¨è£…é¥°å™¨æ¥åˆ¶ä½œæ–¹ä¾¿å¿«æ·çš„APIã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è£…é¥°å™¨ æœ‰äº†è£…é¥°å™¨ï¼Œä½ å°±å¯ä»¥åšåˆ°åœ¨æŸäº›ç‰¹å®šçš„åœ°æ–¹ä½¿ç”¨å…·ä½“çš„ã€å¯å¤ç”¨çš„åŠŸèƒ½â€”â€”å¦‚æœä»£ç å†™å¾—å¥½ï¼Œè£…é¥°å™¨å°±æ˜¯æ¨¡å—åŒ–çš„ã€æ˜ç¡®çš„ã€‚æ­£æ˜¯ç”±äºè£…é¥°å™¨çš„æ¨¡å—åŒ–ï¼Œä½¿å¾—å®ƒä»¬éå¸¸é€‚åˆé¿å…é‡å¤çš„æ¨¡ç‰ˆè®¾ç½®å’Œæ‹†è§£ä»£ç ï¼ŒåŒæ—¶ç”±äºè£…é¥°å™¨ä»…ä¸è¢«è£…é¥°çš„å‡½æ•°æœ¬èº«æœ‰äº¤äº’ï¼Œæ‰€ä»¥éå¸¸æ“…é•¿åœ¨å…¶ä»–åœ°æ–¹æ³¨å†ŒåŠŸèƒ½ã€‚åœ¨Pythonåº”ç”¨ç¨‹åºå’Œæ¨¡å—ä¸­ç¼–å†™è£…é¥°å™¨æœ‰å‡ ä¸ªéå¸¸å¥½çš„ç”¨ä¾‹â€”â€” é™„åŠ åŠŸèƒ½ - åœ¨è¢«è£…é¥°çš„æ–¹æ³•å‰åæ‰§è¡Œé¢å¤–çš„é™„åŠ åŠŸèƒ½ æ•°æ®æ¸…æ´—æˆ–æ·»åŠ  - å¯¹ä¼ å…¥è¢«è£…é¥°çš„å‡½æ•°çš„å‚æ•°åšä¸€ä¸‹æ¸…æ™°ï¼Œç¡®ä¿å‚æ•°ç±»å‹ä¸€è‡´æ€§æˆ–è€…ä½¿å‚æ•°å€¼æ‘ä»ä¸€å®šçš„æ¨¡å¼ï¼Œæ¯”å¦‚@requires_ints åŠŸèƒ½æ³¨å†Œ åŠ¨æ‰‹å†™å‡ ä¸ªè£…é¥°å™¨çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚å†™ä¸‹æ¥å°±è¦åŠ¨æ‰‹å†™å‡ ä¸ªè£…é¥°å™¨çš„ä¾‹å­ã€‚ åŠŸèƒ½æ³¨å†Œå…ˆä¸Šä»£ç æ‰“ä¸ªæ ·ï¼š class Registry(object): def __init__(self): self._functions = [] def register(self, decorated): self._functions.append(decorated) return decorated def run_all(self, *args, **kwargs): return_values = [] for func in self._functions: return_values.append(func(*args, **kwargs)) return return_valuesa = Registry()b = Registry()@a.registerdef foo(x=3): return x@b.registerdef bar(x=5): return x@a.register@b.registerdef baz(x=7): return xa_r = a.run_all() # [3, 7]b_r = b.run_all() # [5, 7]a_r = a.run_all(x=4) # [4, 4] è¿è¡Œæ—¶å°è£…ä»£ç ï¼ˆwrap codeï¼‰ä¸Šé¢è£…é¥°å™¨çš„ä¾‹å­æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºè¢«è£…é¥°çš„å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’è¿‡å»æ—¶å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ã€‚ç„¶è€Œï¼Œæœ‰äº›æ—¶å€™å½“æˆ‘ä»¬è¿è¡Œè¢«è£…é¥°çš„æ–¹æ³•æ—¶ï¼Œå¸Œæœ›åšäº›é¢å¤–çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿”å›ä¸åŒçš„å¯è°ƒç”¨å‡½æ•°ï¼ˆcallableï¼‰æ¥æ·»åŠ ç›¸åº”çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ï¼ˆé€šå¸¸ï¼‰åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨è£…é¥°æ–¹æ³•ã€‚ä¸¾å‡ ä¸ªä¾‹å­ï¼š ç±»å‹æ£€æŸ¥def requires_int(decorated): def inner(*args, **kwargs): \"\"\" Get any values that may have been sent as keyword arguments. \"\"\" kwarg_values = [i for i in kwargs.values()] for arg in list(args) + kwarg_values: if not isinstance(arg, int): raise TypeError('%s only accepts integers as arguments.' % decorated.__name__) return decorated(*args, **kwargs) return inner@requires_intdef foo(x,y): \"\"\" Return the sum of x and y\"\"\" return x+yif __name__ == '__main__': print foo(1,y='a')# output Traceback (most recent call last): File \"F:/Test/PyTest/decorators/typecheck.py\", line 17, in &lt;module&gt; print foo(1,y='a') File \"F:/Test/PyTest/decorators/typecheck.py\", line 7, in inner decorated.__name__)TypeError: foo only accepts integers as arguments. ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è£…é¥°å™¨@requires_intå¯¹fooçš„å‚æ•°è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå…¥å‚ä¸­æœ‰ä»»ä½•ä¸æ˜¯intç±»å‹çš„å‚æ•°ï¼Œå°±æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ å¦‚æœæ­¤æ—¶æˆ‘ä»¬æ‰§è¡Œhelp(foo)ä¼šå‘ç°ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼šHelp on function inner in module __main__:inner(*args, **kwargs) Get any values that may have been sent as keyword arguments. å¾ˆå¥‡æ€ªå§ï¼Œä¸ºä»€ä¹ˆæ˜¾ç¤ºçš„æ˜¯innerçš„å‡½æ•°ååŠdocè€Œä¸æ˜¯fooå‘¢ï¼Ÿå› ä¸ºæ­¤æ—¶innerå‡½æ•°å·²ç»è¢«èµ‹å€¼ç»™äº†fooï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œfooï¼Œå…¶å®å°±æ˜¯æ‰§è¡Œinnerâ€”â€”é¦–å…ˆæ‰§è¡Œäº†ç±»å‹æ£€æŸ¥ï¼Œç„¶åè¿è¡Œè¢«è£…é¥°çš„æ–¹æ³•ï¼Œå› ä¸ºinneré€šè¿‡return decorated(args, *kwargs)è°ƒç”¨äº†è¢«è£…é¥°çš„å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰returnè¿™ä¸ªè°ƒç”¨ï¼Œè¢«è£…é¥°çš„æ–¹æ³•å°±ä¼šè¢«å¿½ç•¥ã€‚ ä¿ç•™åŸå‡½æ•°çš„å¸®åŠ©ä¿¡æ¯ç»è¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¼šè‡ªç„¶è€Œç„¶çš„æ€è€ƒä¸€é—®é¢˜ï¼Œå¦‚æœå½“æˆ‘ä»¬è¿è¡Œhelp()å»æŸ¥çœ‹å‡½æ•°çš„å¸®åŠ©ä¿¡æ¯æ—¶ï¼Œå¸Œæœ›çœ‹åˆ°çš„æ˜¯è¢«è£…é¥°çš„åŸå‡½æ•°çš„æ–‡æ¡£ï¼Œè€Œä¸æ˜¯è£…é¥°å™¨çš„æ–‡æ¡£ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™é‡Œï¼Œæˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨è£…é¥°å™¨@functools.wraps ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªå‡½æ•°é‡è¦çš„å†…éƒ¨å…ƒç´ æ‹·è´åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼šimport functoolsdef requires_int(decorated): @functools.wraps(decorated) def inner(*args, **kwargs): \"\"\" Get any values that may have been sent as keyword arguments. \"\"\" kwarg_values = [i for i in kwargs.values()]... é‚£ä¹ˆæ­¤æ—¶æŸ¥çœ‹help(foo)ï¼Œæˆ‘ä»¬å¾—åˆ°çš„è¾“å‡ºç»“æœæ˜¯ï¼šHelp on function foo in module __main__:foo(*args, **kwargs) Return the sum of x and y æ³¨ï¼šæˆ‘è¿™é‡Œè¿è¡Œçš„æ˜¯Python2.7ï¼Œå¦‚æœå®åœ¨Python3ä¸‹ï¼Œçœ‹åˆ°çš„ç»“æœåº”è¯¥æ˜¯foo(x, y)ã€‚ ç”¨æˆ·æ ¡éªŒimport functoolsclass User(object): def __init__(self, username, email): self.username = username self.email = emailclass AnonymousUser(User): def __init__(self): self.username = None self.email = None def __nonzero__(self): return Falsedef require_user(func): @functools.wraps(func) def inner(user, *args, **kwargs): if user and isinstance(user, User): return func(user, *args, **kwargs) else: raise ValueError('A valid user is required to run this.') return inner@require_userdef foo(user): if user.username and user.email: print user.username + ',' + user.email else: print 'None'if __name__ == '__main__': user = User('Tom','tom.smith@tom.com') a_user = AnonymousUser() foo(user) foo(a_user)# outputTom,tom.smith@tom.comTraceback (most recent call last): File \"F:/Test/PyTest/decorators/user.py\", line 39, in &lt;module&gt; foo(a_user) File \"F:/Test/PyTest/decorators/user.py\", line 25, in inner raise ValueError('A valid user is required to run this.')ValueError: A valid user is required to run this. æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªUserç±»ï¼Œä¸€ä¸ªAnonymousUserç±»é›†æˆUserç±»ï¼Œæ³¨æ„ï¼Œåœ¨AnonymousUserä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†nonzeroæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰äº†å¯¹ç±»çš„å®ä¾‹è°ƒç”¨bool()æ—¶çš„è¡Œä¸ºï¼Œå³åœ¨require_userçš„inneræ–¹æ³•ä¸­ï¼Œif user and isinstance(user, User)æ—¶çš„if userï¼Œç›¸å½“äºif bool(user)ï¼Œå› ä¸ºåœ¨AnonymousUserä¸­æˆ‘ä»¬å®šä¹‰äº†nonzeroè¿”å›Falseï¼Œæ‰€ä»¥è¿™é‡Œå°±æ²¡æœ‰åŠæ³•é€šè¿‡ifæ£€æŸ¥ï¼Œä»è€Œrasieäº†å¼‚å¸¸ã€‚ æ ¼å¼åŒ–è¾“å‡ºé™¤äº†ä¸ºå‡½æ•°çš„è¾“å…¥æ¸…ç†æ•°æ®ï¼Œè£…é¥°å™¨çš„å¦ä¸€ä¸ªä½œç”¨å°±æ˜¯æ¸…ç†/æ ¼å¼åŒ–è¾“å‡ºæ•°æ®ã€‚æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›å‡½æ•°çš„è¾“å‡ºä»¥JSONæ ¼å¼ï¼Œåœ¨æ¯ä¸ªç›¸å…³çš„å‡½æ•°çš„æœ€åæ‰‹åŠ¨å»æ ¼å¼åŒ–è¾“å‡ºä¸ºJSONæ˜¾å¾—ç‰¹åˆ«å†—ä½™å’Œç¬¨é‡ã€‚æ­¤æ—¶ï¼Œè£…é¥°å™¨å°±ç«™å‡ºæ¥äº†ã€‚ import functoolsimport jsonclass JSONOutputError(Exception): def __init__(self, message): self._message = message def __str__(self): return self._messagedef json_output(decorated): \"\"\"Run the decorated function, serialize the result of that function to JSON, and return the JSON string. \"\"\" @functools.wraps(decorated) def inner(*args, **kwargs): try: result = decorated(*args, **kwargs) except JSONOutputError as ex: result = &#123; 'status': 'error', 'message': str(ex), &#125; return json.dumps(result) return inner@json_outputdef do_nothing(): return &#123;'status': 'done'&#125;@json_outputdef error(): raise JSONOutputError('This function is erratic')@json_outputdef other_error(): raise ValueError('The grass is always greener..')if __name__ == '__main__': # print do_nothing() print error()# output&#123;\"status\": \"error\", \"message\": \"This function is erratic\"&#125; æ‰“å°æ—¥å¿—æœ€åä¸€ä¸ªä¾‹å­ï¼Œæ‰“å°æ—¥å¿—ï¼Œè®°å½•è°ƒç”¨äº†å“ªä¸ªæ–¹æ³•ã€ä»€ä¹ˆæ—¶é—´è°ƒç”¨ã€æ–¹æ³•æ‰§è¡Œæ—¶é•¿ä»¥åŠæ–¹æ³•çš„è¿”å›å€¼ï¼šimport functoolsimport loggingimport timelogging.basicConfig(evel=logging.DEBUG)LOG = logging.getLogger(__name__)def logged(method): @functools.wraps(method) def inner(*args, **kwargs): start = time.time() return_value = method(*args, **kwargs) end = time.time() delta = end - start LOG.warn('Called method %s at %.02f; execution time %.02f ' 'seconds; result %r.' % (method.__name__, start, delta, return_value)) return return_value return inner@loggeddef sleep_and_return(return_value): time.sleep(2) return return_valueif __name__ == '__main__': print sleep_and_return(27)# output WARNING:__main__:Called method sleep_and_return at 1505889774.61; execution time 2.00 seconds; result 27.27 å°èŠ‚ç»“è¯­æœ¬ç¯‡æ–‡ç« çš„é‡ç‚¹æ˜¯ç®€å•çš„è®¤è¯†ä¸€ä¸‹è£…é¥°å™¨ï¼Œäº†è§£ä¸€ä¸‹è£…é¥°å™¨çš„ç®€å•åº”ç”¨ã€‚ ç›®å‰ä¸Šé¢çš„ä¾‹å­ï¼Œè£…é¥°å™¨é™¤äº†è¢«è£…é¥°çš„å‡½æ•°ä½œä¸ºå‚æ•°ä¹‹å¤–ï¼Œéƒ½ä¸æ¥æ”¶å…¶ä»–çš„å‚æ•°ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè£…é¥°å™¨æœ¬èº«æ¥æ”¶å…¶ä»–å‚æ•°æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚æˆ‘ä»¬åé¢å†å±•å¼€ã€‚","tags":[{"name":"Python","slug":"Python","permalink":"http://elbarco.cn/tags/Python/"},{"name":"decorator","slug":"decorator","permalink":"http://elbarco.cn/tags/decorator/"}]},{"title":"Pythonä¸­çš„ç”Ÿæˆå™¨å’Œyieldå…³é”®å­—","date":"2017-09-18T08:49:46.000Z","path":"2017/09/18/python-generators-and-yield-keyword/","text":"å‰è¨€æˆ‘ä»¬éƒ½çŸ¥é“yieldè¯­å¥ç”¨äºå®šä¹‰ç”Ÿæˆå™¨ï¼Œæ›¿ä»£å‡½æ•°çš„returnè¯­å¥æ¥å‘å…¶è°ƒç”¨è€…æä¾›ç»“æœï¼Œå¹¶ä¸”ä¸ç ´åå±€éƒ¨å˜é‡ã€‚ä¸å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶ï¼Œç”Ÿæˆå™¨ä¼šä»¥æ–°çš„å˜é‡é›†å¼€å§‹ï¼Œç»§ç»­æ‰§è¡Œå®ƒè¢«å…³é—­çš„æ‰§è¡Œã€‚ å…³äºPythonç”Ÿæˆå™¨Pythonä¸­çš„ç”Ÿæˆå™¨çš„ç›®çš„æ˜¯èƒ½å¤Ÿå³æ—¶çš„æŒ‰ç…§æˆ‘ä»¬çš„è¦æ±‚é€ä¸ªè®¡ç®—ä¸€ç³»åˆ—ç»“æœã€‚ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œç”Ÿæˆå™¨å¯ä»¥ç”¨ä½œåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ä¼šåœ¨ç”¨åˆ°çš„æ—¶å€™çš„æ–¹å¼è¢«è®¡ç®—ï¼ˆlazilyï¼‰ï¼š&gt;&gt;&gt; # å®šä¹‰åˆ—è¡¨&gt;&gt;&gt; the_list = [2**i for i in range(5)]&gt;&gt;&gt; # ç±»å‹æ£€æŸ¥ï¼Œç¡®å®æ˜¯ä¸€ä¸ªåˆ—è¡¨&gt;&gt;&gt; type(the_list)&lt;type 'list'&gt;&gt;&gt;&gt; for j in the_list:... print j... 124816&gt;&gt;&gt; # åˆ—è¡¨é•¿åº¦ä¸º5&gt;&gt;&gt; len(the_list)5&gt;&gt;&gt; # å®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œæ³¨æ„æ˜¯'()'è€Œä¸æ˜¯'[]'&gt;&gt;&gt; the_gen = (x+x for x in range(5))&gt;&gt;&gt; # ç±»å‹æ£€æŸ¥ï¼Œç¡®å®æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨&gt;&gt;&gt; type(the_gen)&lt;type 'generator'&gt;&gt;&gt;&gt; # éå†ç”Ÿæˆå™¨ä¸­çš„å…ƒç´ ï¼Œå¹¶æ‰“å°&gt;&gt;&gt; for j in the_gen:... print j... 02468&gt;&gt;&gt; # çœ‹èµ·æ¥å¥½åƒè·Ÿåˆ—è¡¨ä¼¼çš„ï¼Œé‚£å¦‚æœæˆ‘ä»¬æ¥æ£€æŸ¥ä¸€ä¸‹é•¿åº¦â€¦â€¦&gt;&gt;&gt; len(the_gen)Traceback (most recent call last): File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;TypeError: object of type 'generator' has no len()&gt;&gt;&gt; ä»ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œéå†åˆ—è¡¨å’Œéå†ç”Ÿæˆå™¨æ˜¯ä¸€æ ·çš„ã€‚ä¸è¿‡ï¼Œå°½ç®¡ç”Ÿæˆå™¨å¯éå†çš„ï¼Œä½†æ˜¯å´ä¸æ˜¯ä¸€ä¸ªæ•°æ®é›†åˆï¼Œå› æ­¤æ²¡æœ‰é•¿åº¦çš„å±æ€§ã€‚æ•°æ®é›†åˆï¼ˆæ¯”å¦‚åˆ—è¡¨ã€å…ƒç»„ã€é›†åˆç­‰ï¼‰å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ—¶å°±å¯ä»¥è·å¾—ï¼›ç”Ÿæˆå™¨å³æ—¶çš„è®¡ç®—ç»“æœï¼Œç„¶åä¸‹ä¸€æ¬¡è¿­ä»£æ—¶å°±æŠŠä¸Šä¸€æ¬¡ç»“æœâ€œå¿˜æ‰äº†â€ï¼Œæ‰€ä»¥ç”Ÿæˆå™¨æ²¡æœ‰å¯¹è‡ªå·±ç»“æœé›†çš„ä»»ä½•æ¦‚è¿°ã€‚ æ­£å› ä¸ºç”Ÿæˆå™¨æœ‰è¿™ä¸ªç‰¹æ€§â€”â€”ä¸éœ€è¦åŒæ—¶åœ¨å†…å­˜ä¸­ä¿ç•™æ•°æ®é›†åˆä¸­çš„å…¨éƒ¨å…ƒç´ â€”â€”æ‰€ä»¥éå¸¸é€‚åˆå†…å­˜æ•æ„Ÿçš„ä»»åŠ¡ã€‚å½“æˆ‘ä»¬ä¸éœ€è¦å®Œæ•´çš„ç»“æœæ—¶ï¼Œé€ä¸ªçš„è®¡ç®—ç»“æœå€¼çš„åšæ³•å°±æ˜¾å¾—ååˆ†æœ‰ç”¨ï¼Œå¯¹è°ƒç”¨è€…å³æ—¶çš„è¿”å›ä¸­é—´ç»“æœï¼Œç›´åˆ°æ»¡è¶³ä¸€äº›è¦æ±‚ç„¶ååœæ­¢å¤„ç†ã€‚ ä½¿ç”¨Pythonçš„yieldå…³é”®å­—è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå°±æ˜¯å½“æˆ‘ä»¬åœ¨æœç´¢æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç­‰æ‰€æœ‰çš„ç»“æœéƒ½è¢«æŸ¥æ‰¾å‡ºæ¥ã€‚æ¯”å¦‚åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢æ—¶ï¼Œç”¨æˆ·æ›´å¸Œæœ›èƒ½å³æ—¶çš„çœ‹åˆ°ç»“æœï¼Œè€Œä¸æ˜¯ç­‰æœç´¢å·¥å…·éå†æ¯ä¸ªæ–‡ä»¶ï¼Œç„¶åè¿”å›æ‰€æœ‰çš„ç»“æœã€‚å†æ¯”å¦‚ï¼Œç”¨Googleæœç´¢çš„ç”¨æˆ·ä¼šä¸€ç›´ç¿»åˆ°æœ€åä¸€é¡µå—ï¼Ÿ è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨yieldå…³é”®å­—/è¯­å¥æ¥å®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨ã€‚yieldæŒ‡ä»¤åº”å½“æ”¾åœ¨ç”Ÿæˆå™¨ç«‹å³è¿”å›ç»“æœç»™è°ƒç”¨è€…å¹¶ä¸”ç­‰å¾…ä¸‹æ¬¡è°ƒç”¨å‘ç”Ÿçš„åœ°æ–¹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªç”¨äºåœ¨å¤§æ–‡ä»¶ä¸­é€è¡Œæœç´¢å…³é”®å­—çš„ç”Ÿæˆå™¨ï¼šdef search(keyword, filename): print 'Generator started' f = open(filename,'r') for line in f: if keyword in line: yield line f.close()# åœ¨data.txtä¸­æœç´¢yieldå…³é”®å­—the_gen = search('yield', 'data.txt')# æ£€æŸ¥the_gençš„ç±»å‹print type(the_gen)# ä¹Ÿå¯ä»¥ç”¨the_gen.next()æˆ–next(the_gen)éå†for i in the_gen: print i æœ€ç»ˆï¼Œæˆ‘ä»¬å¾—åˆ°çš„the_gençš„ç±»å‹æ˜¯&lt;type &#39;generator&#39;&gt;ï¼Œéå†the_genå¾—åˆ°data.txtä¸­åŒ…å«yieldå…³é”®å­—çš„æ¯ä¸€è¡Œï¼Œè¾“å‡ºç»“æœä¸ºï¼š&lt;type &apos;generator&apos;&gt;Generator startedUsing the Python &quot;yield&quot; keywordThe yield instruction should be put into a place... Since the yield keyword is only used with generators... æ›´å¤šçš„ä¾‹å­ç”Ÿæˆå™¨çš„åº”ç”¨æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æ‰®æ¼”ä¼ é€å¸¦çš„è§’è‰²ï¼Œä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¾‹å­å³ç¼“å†²åŒºï¼šè·å–å¤§é‡çš„æ•°æ®å¹¶å°†å…¶ä»¥å°æ•°æ®å—è¿›è¡Œå¤„ç†ï¼šdef buffered_read(): while True: buffer = fetch_big_chunk() for small_chunk in buffer: yield small_chunk æœ€åæˆ‘ä»¬å†çœ‹ä¸€ä¸ªç»å…¸ä¾‹å­â€”â€”ç»™å®šæ•°å­—Nï¼Œä½¿ç”¨ç”Ÿæˆå™¨ç»™å‡ºå‰Nä¸ªæ–æ³¢é‚£å¥‘åºåˆ—ï¼ˆFibonacciï¼‰æ•°å­—ï¼šdef fibonacci(n): curr = 1 prev = 0 counter = 0 while counter &lt; n: yield curr prev, curr = curr, prev + curr counter += 1f = fibonacci(6) for i in f: print i112358 ç›´åˆ°counter = nï¼Œåœæ­¢whileå¾ªç¯ã€‚ å‚è€ƒ[1].Python generators and the yield keyword[2].What does the â€œyieldâ€ keyword do?","tags":[{"name":"Python","slug":"Python","permalink":"http://elbarco.cn/tags/Python/"},{"name":"yield","slug":"yield","permalink":"http://elbarco.cn/tags/yield/"}]},{"title":"OpenStack DBaaSç»„ä»¶Troveç®€ä»‹","date":"2017-07-25T08:02:28.000Z","path":"2017/07/25/introduction-to-trove/","text":"Troveæ¶æ„TroveåŒ…å«ä¸‹é¢å‡ ä¸ªä¸»è¦ç»„ä»¶ï¼š API Server Message Bus Task Manager Guest Agent Conductor API ServerAPI endpointï¼ˆtrove-apiï¼‰æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªHTTPçš„WebæœåŠ¡ï¼Œå…·å¤‡å¤„ç†é‰´æƒã€æˆæƒã€ä¸æ•°æ®å­˜å‚¨ç›¸å…³çš„åŸºæœ¬å‘½ä»¤å’Œæ§åˆ¶åŠŸèƒ½ã€‚æ ¹æ®æ•°æ®åº“ä¸åŒï¼ŒAPIè¿˜æœ‰ä¸€äº›ä¸åŒçš„æ‰©å±•ã€‚ API Serverä¸ä¸¤ä¸ªç³»ç»Ÿæ²Ÿé€šâ€”â€”ä¸Task Manageræ²Ÿé€šï¼Œæ¥å¤„ç†å¤æ‚çš„å¼‚æ­¥ä»»åŠ¡ï¼›ç›´æ¥ä¸Guest Agentæ²Ÿé€šæ¥å¤„ç†ç®€å•çš„ä»»åŠ¡æ¯”å¦‚è·å–MySQLç”¨æˆ·åˆ—è¡¨ç­‰ï¼Œè¿™éƒ¨åˆ†æ“ä½œå‡æ˜¯åŒæ­¥çš„ã€‚API Serverä¸åšä»»ä½•é‡å¤§/å¤æ‚çš„äº‹æƒ…ï¼Œå®ƒçš„ä»»åŠ¡å°±æ˜¯æ¥æ”¶è¯·æ±‚ï¼Œå°†å…¶è½¬åŒ–ä¸ºæ¶ˆæ¯ï¼Œæ ¡éªŒå®ƒä»¬ï¼Œå¹¶å°†è¿™äº›æ¶ˆæ¯è½¬å‘åˆ°ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTask Managerï¼‰å’Œè®¿å®¢ä»£ç†ï¼ˆGuest Agentï¼‰ã€‚ ä¸€ä¸ªRESTfulé£æ ¼çš„ç»„ä»¶ å…¥å£ - Trove/bin/trove-api ä½¿ç”¨WSGI launcherï¼Œç”±Trove/etc/trove/api-paste.inié…ç½® å®šä¹‰äº†è¿‡æ»¤å™¨ç®¡é“ã€ä»¤ç‰Œè®¤è¯ã€é€Ÿç‡é™åˆ¶ç­‰ å®šä¹‰äº†app_factoryä¸ºtrove.common.api:app_factoryæä¾›ç»™troveåº”ç”¨ API ç±»ï¼ˆWSGI Routerï¼‰å°†RESTè·¯å¾„è¿æ¥åˆ°ç›¸åº”çš„Controllerä¸Š Controllerçš„å®ç°åœ¨ç›¸å…³çš„æ¨¡å—ä¸‹ï¼ˆå¦‚versions/instance/flavor/limitsï¼‰çš„service.pyä¸­ Controlleré€šå¸¸å°†å®ç°é‡å®šå‘åˆ°models.pyä¸­çš„ä¸€ä¸ªç±» å¦ä¸€äº›ç»„ä»¶ï¼ˆTask Managerï¼ŒGuest Agentï¼‰çš„apiæ¨¡å—é€šè¿‡RabbitMQå‘é€è¯·æ±‚ Message Busè¿™éƒ¨åˆ†ç»„ä»¶ä»¿ç…§äº†Novaæ¶æ„ã€‚Message Buså…¶å®å°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚ ä¸€ä¸ªå…¸å‹çš„æ¶ˆæ¯ä¼ é€’äº‹ä»¶ä»APIæœåŠ¡å™¨æ¥æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚å¼€å§‹ã€‚APIæœåŠ¡å™¨è®¤è¯ç”¨æˆ·ç¡®ä¿ç”¨æˆ·å…·å¤‡æ‰§è¡Œå“åº”å‘½ä»¤çš„æƒé™ã€‚å¯¹è¯·æ±‚ä¸­æ¶‰åŠåˆ°çš„å¯¹è±¡çš„å¯ç”¨æ€§è¿›è¡Œè¯„ä¼°ï¼Œå¦‚æœå¯ç”¨ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ç›¸å…³Workerçš„æ’é˜Ÿå¼•æ“ã€‚Workersä¸æ–­æ ¹æ®è‡ªå·±çš„è§’è‰²ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå½“è¿™ç§ç›‘å¬äº§ç”Ÿä¸€ä¸ªå·¥ä½œè¯·æ±‚æ—¶ï¼ŒWorkerå°†å¯¹è¯¥ä»»åŠ¡è¿›è¡Œä»»åŠ¡åˆ†é…å¹¶å¼€å§‹æ‰§è¡Œã€‚å®Œæˆä»»åŠ¡åï¼ŒWorkerå°†å“åº”å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”±APIæœåŠ¡å™¨æ¥å—å¹¶ä¸­ç»§åˆ°å§‹å‘ç”¨æˆ·çš„é˜Ÿåˆ—ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°æ®åº“è®°å½•æ ¹æ®éœ€è¦ä¼šè¢«æŸ¥è¯¢ã€æ·»åŠ æˆ–è€…åˆ é™¤ã€‚ Task ManagerTask Managerï¼ˆtrove-taskmanagerï¼‰å°±æ˜¯å¹²ç²—æ´»ç´¯æ´»çš„å®¶ä¼™ï¼Œæ¯”å¦‚é…ç½®ä¸€å°å®ä¾‹ï¼Œç®¡ç†å®ä¾‹ç”Ÿå‘½å‘¨æœŸå’Œåœ¨å®ä¾‹ä¸Šè¿›è¡Œæ“ä½œã€‚ä»»åŠ¡ç®¡ç†å™¨æ¥æ”¶æ¥è‡ªAPI Serverçš„æ¶ˆæ¯ï¼Œé€šè¿‡åŒæ„æ¶ˆæ¯è¿›è¡Œå“åº”ï¼Œå¹¶å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚æœ‰å‡ ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œæ¯”å¦‚é‡æ–°åˆ†é…æ•°æ®åº“è§„æ ¼å’Œåˆ›å»ºå®ä¾‹ç­‰ï¼Œä»–ä»¬å‡éœ€è¦é€šè¿‡HTTPè¯·æ±‚è°ƒç”¨OpenStackçš„æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦è½®è¯¢æœåŠ¡ï¼ŒçŸ¥é“å®ä¾‹å˜ä¸ºæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”è¿˜å‘å®¢æˆ·ä»£ç†å‘é€æ¶ˆæ¯ã€‚ä»»åŠ¡ç®¡ç†å™¨å¤„ç†åœ¨å¤šä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘ç”Ÿçš„è¿›ç¨‹æµã€‚ ä»»åŠ¡ç®¡ç†å™¨æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå®ƒåœ¨å…¶ç³»ç»Ÿå†…éƒ¨è¿è¡Œå¤æ‚çš„æµç¨‹ã€‚å¦‚æœåœ¨çŠ¶æ€å¤„ç†æœŸé—´ä»»åŠ¡ç®¡ç†å™¨èŠ‚ç‚¹è„±æœºï¼Œåˆ™æ“ä½œå°†å¤±è´¥ã€‚ä»»åŠ¡æµç³»ç»Ÿå°†æœ€ç»ˆå®ç°ä¸ºé•¿æ—¶é—´è¿è¡Œè¿è¡Œçš„ä»»åŠ¡ã€‚ï¼ˆThe Task Flow system will be eventually implemented for long running tasks.ï¼‰ è¿™æ˜¯ä¸€ä¸ªç›‘å¬RabbitMQ topicçš„æœåŠ¡ å…¥å£ - Trove/bin/trove-taskmanager ä½œä¸ºä¸€ä¸ªRpcServiceè¿è¡Œï¼Œé€šè¿‡Trove/etc/trove/trove-taskmanager.conf.sampleé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œå®šä¹‰äº†trove.taskmanager.manager.Managerä½œä¸ºmanagerï¼ŒåŸºæœ¬ä¸Šè¿™æ˜¯é€šè¿‡é˜Ÿåˆ—åˆ°è¾¾çš„è¯·æ±‚çš„å…¥å£ç‚¹ å¦‚ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨TaskManagerçš„apiæ¨¡å—ï¼Œä½¿ç”¨_cast()æˆ–è€…_call()ï¼ˆåŒæ­¥/å¼‚æ­¥ï¼‰å°†å¯¹è¯¥ç»„ä»¶çš„è¯·æ±‚ä»å¦ä¸€ä¸ªç»„ä»¶æ¨é€åˆ°MQä¸­ï¼Œå¹¶æ”¾ç½®æ–¹æ³•å‘½ä½œä¸ºä¸€ä¸ªå‚æ•° Trove/openstack/common/rpc/dispatcher.py ä¸­çš„RpcDispatcher.dispatch()é€šè¿‡åå°„çš„æ–¹å¼è°ƒç”¨Managerä¸­åˆé€‚çš„æ–¹æ³• ç„¶åï¼ŒManagerå°†è¯¥å¤„ç†é‡å®šå‘åˆ°models.pyæ¨¡å—ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä½¿ç”¨contextå’Œinstance_idä»ç›¸å…³ç±»åŠ è½½ä¸€ä¸ªå¯¹è±¡ å®é™…çš„å¤„ç†ä¸€èˆ¬åœ¨models.pyä¸­å®Œæˆ Guest Agentå®¢æˆ·ä»£ç†ï¼ˆGuest Agentï¼Œtrove-guestagentï¼‰è¿è¡Œåœ¨å®¢æˆ·å®ä¾‹å†…éƒ¨ï¼Œè´Ÿè´£ç®¡ç†å’Œæ‰§è¡Œæ•°æ®å­˜å‚¨æœ¬èº«çš„æ“ä½œã€‚å®ƒè´Ÿè´£ä½¿æ•°æ®å­˜å‚¨åœ¨çº¿ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡ã€‚çƒ­æ”¯æŒï¼ˆHeat supportï¼‰å°†æ¥å°†æˆä¸ºTroveçš„é»˜è®¤é…ç½®å’Œä»ªå™¨å¼•æ“ï¼Œä»è€Œå‡å°‘äº†å°†æ•°æ®å­˜å‚¨åº“è”æœºçš„ä»»åŠ¡ã€‚Guest Agentè¿˜é€šè¿‡Conductorï¼ˆæŒ‡æŒ¥å™¨ï¼‰å‘API Serverå‘é€å¿ƒè·³ä¿¡æ¯ã€‚ æ¯ä¸ªæ•°æ®å­˜å‚¨å™¨éƒ½å®ç°æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ä»£ç†ï¼Œè´Ÿè´£ä¸ºè¯¥æ•°æ®å­˜å‚¨å™¨æ‰§è¡Œç‰¹å®šäººç‰©ã€‚æ¯”å¦‚Redisçš„å®¢æˆ·ä»£ç†è¡Œä¸ºä¸MySQLçš„å®¢æˆ·ä»£ç†è¡Œä¸ºå°±ä¼šä¸åŒã€‚ä¸è¿‡ä»–ä»¬å¿…é¡»å±¥è¡Œè¯¸å¦‚åˆ›å»ºå’Œè°ƒæ•´è§„æ ¼çš„åŸºç¡€æ“ä½œã€‚ ä¸Task Managerç±»ä¼¼ï¼ŒæœåŠ¡è¿è¡Œèµ·æ¥ç›‘å¬RabbitMQ topic Guest Agentåœ¨æ¯ä¸ªæ•°æ®åº“å®ä¾‹ä¸­è¿è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨ä¸“æœ‰çš„RabbitMQ topicï¼ˆé€šè¿‡å®ä¾‹IDæ¥æ ‡è¯†ï¼‰ å…¥å£ - Trove/bin/trove-guestagent ä½œä¸ºä¸€ä¸ªRpcServiceè¿è¡Œï¼Œé€šè¿‡Trove/etc/trove/trove-guestagent.conf.sampleé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œå®šä¹‰äº†trove.guestagent.manager.Managerä½œä¸ºmanagerï¼ŒåŸºæœ¬ä¸Šè¿™æ˜¯é€šè¿‡é˜Ÿåˆ—åˆ°è¾¾çš„è¯·æ±‚çš„å…¥å£ç‚¹ å¦‚ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨Guest Agentçš„apiæ¨¡å—ï¼Œä½¿ç”¨_cast()æˆ–è€…_call()ï¼ˆåŒæ­¥/å¼‚æ­¥ï¼‰å°†å¯¹è¯¥ç»„ä»¶çš„è¯·æ±‚ä»å¦ä¸€ä¸ªç»„ä»¶æ¨é€åˆ°MQä¸­ï¼Œå¹¶æ”¾ç½®æ–¹æ³•å‘½ä½œä¸ºä¸€ä¸ªå‚æ•° Trove/openstack/common/rpc/dispatcher.py ä¸­çš„RpcDispatcher.dispatch()é€šè¿‡åå°„çš„æ–¹å¼è°ƒç”¨Managerä¸­åˆé€‚çš„æ–¹æ³• ç„¶åï¼ŒManagerå°†å¯¹å¯¹è±¡çš„å¤„ç†é‡å®šå‘åˆ°dbaas.pyä¸­ å®é™…å¤„ç†ä¸€èˆ¬åœ¨dbaas.pyä¸­å®Œæˆ ConductoræŒ‡æŒ¥å™¨ï¼ˆConductorï¼‰æ˜¯è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„é¥¿ä¸€ä¸ªæœåŠ¡ï¼Œè´Ÿè´£æ¥æ”¶å®¢æˆ·å®ä¾‹ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶åœ¨å®¿ä¸»æœºä¸Šæ›´æ–°ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œå®ä¾‹çš„çŠ¶æ€å’Œå½“å‰å¤‡ä»½çš„çŠ¶æ€ã€‚æœ‰äº†æŒ‡æŒ¥å™¨ï¼Œç”¨æˆ·çš„å®ä¾‹ä¸éœ€è¦ç›´æ¥è¿æ¥åˆ°å®¿ä¸»æœºçš„æ•°æ®åº“ã€‚æŒ‡æŒ¥å™¨é€šè¿‡Message Busç›‘å¬RPCæ¶ˆæ¯ï¼Œå¹¶æ‰§è¡Œç›¸å…³çš„æ“ä½œã€‚æŒ‡æŒ¥å™¨ä¸å®¢æˆ·ä»£ç†æœ‰äº›ç±»ä¼¼ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç›‘å¬RabbitMQä¸»é¢˜çš„æœåŠ¡ï¼Œä¸åŒçš„æ˜¯Conductorè¿è¡Œåœ¨å®¿ä¸»æœºä¸Šï¼Œè€Œéå®¢æˆ·å®ä¾‹å†…éƒ¨ã€‚å®¢æˆ·ä»£ç†é€šè¿‡å°†æ¶ˆæ¯æ”¾å…¥é…ç½®çš„æ¶ˆæ¯é˜Ÿåˆ—â€”â€”conductor_queueï¼Œé»˜è®¤ä¸ºtrove-conductorâ€”â€”æ¥ä¸æŒ‡æŒ¥å™¨è¿›è¡Œä¿¡æ¯äº¤äº’ã€‚ å…¥å£ - Trove/bin/trove-conductor ä½œä¸ºä¸€ä¸ªRpcServiceè¿è¡Œï¼Œé€šè¿‡Trove/etc/trove/trove-conductor.conf.sampleé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œå®šä¹‰äº†trove.conductor.manager.Managerä½œä¸ºManager å¦‚ä¸Šé¢çš„å®¢æˆ·ä»£ç†ç±»ä¼¼ï¼Œè¯·æ±‚é€šè¿‡å…¶ä»–ç»„ä»¶ä½¿ç”¨_cast()ï¼ˆå¼‚æ­¥çš„ï¼‰æ¨é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä¸€èˆ¬æ¥è®²ï¼Œæ¶ˆæ¯æ ¼å¼ä¸º{&quot;method&quot;: &quot;&lt;method_name&gt;&quot;, &quot;args&quot;: {&lt;arguments&gt;}} å®é™…çš„æ•°æ®åº“æ›´æ–°æ“ä½œç”±trove/conductor/manager.pyå®Œæˆ â€œheartbeatâ€æ“ä½œæ›´æ–°å®ä¾‹çš„çŠ¶æ€ï¼Œé€šå¸¸ç”±Guest Agentæ¥æŠ¥å‘Šå®ä¾‹çŠ¶æ€ï¼Œå¦‚ä»NEWåˆ°BUILDINGåˆ°ACTIVEç­‰ç­‰ â€œupdate_backupâ€æ–¹æ³•ä¿®æ”¹å¤‡ä»½çš„è¯¦æƒ…ï¼ŒåŒ…æ‹¬å®ƒçš„å½“å‰çŠ¶æ€ã€å¤‡ä»½å¤§å°ã€ç±»å‹å’Œæ ¡éªŒç ï¼ˆchecksumï¼‰ ä»£ç ä»“åº“ Trove Server (https://github.com/openstack/trove) Trove Integration (https://github.com/openstack/trove-integration) Trove Client (https://github.com/openstack/python-troveclient) å®‰è£…éƒ¨ç½² How to install trove as part of devstack: trove/installation How to use trove-integration: trove/trove-integration How to set up unit tests to run with tox: trove/unit-testing How to set up a testing environment and run redstack tests after installation: trove/integration-testing How to set up your Mac dev environment to debug: trove/dev-env Releasing python-troveclient trove/release-python-troveclient Creating release notes with Reno trove/create-release-notes-with-reno è¯´æ˜ç¿»è¯‘è‡ªTrove wiki","tags":[{"name":"OpenStack","slug":"OpenStack","permalink":"http://elbarco.cn/tags/OpenStack/"},{"name":"Trove","slug":"Trove","permalink":"http://elbarco.cn/tags/Trove/"},{"name":"Translation","slug":"Translation","permalink":"http://elbarco.cn/tags/Translation/"}]},{"title":"ç”±ä¸€æ¬¡æœåŠ¡è¿æ¥MongoDBè¶…æ—¶å¼•å‘çš„æ€è€ƒ","date":"2017-06-28T09:12:28.000Z","path":"2017/06/28/mongodb-connecttimeout-and-sockettimeout/","text":"èµ·å› ä»Šå¤©æŸä¸ªä¸šåŠ¡æ“ä½œçªç„¶æ‰§è¡Œå¤±è´¥ï¼ŒæŸ¥è¯¢æœåŠ¡æ—¥å¿—å‘ç°ï¼ŒæœåŠ¡åœ¨äº›å†™æ•°æ®çš„æ—¶å€™ï¼Œè¿æ¥è¢«é‡ç½®ï¼Œå’ŒMongoTimeoutExceptionï¼Œæˆªå–éƒ¨åˆ†æ—¥å¿—å¦‚ä¸‹ï¼šCaused by: com.mongodb.MongoException$Network: Operation on server xx.xx.xx.xx:27017 failed at com.mongodb.DBTCPConnector.doOperation(DBTCPConnector.java:215) ~[mongo-java-driver-2.13.0.jar:na] ... 63 common frames omittedCaused by: java.net.SocketException: Connection reset at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:118) ~[na:1.7.0_80] ... 72 common frames omitted..........Caused by: com.mongodb.MongoTimeoutException: Timed out after 0 ms while waiting for a server that matches &#123;serverSelectors=[ReadPreferenceServerSelector&#123;readPreference=primary&#125;, LatencyMinimizingServerSelector&#123;acceptableLatencyDifference=15 ms&#125;]&#125;. Client view of cluster state is &#123;type=ReplicaSet, servers=[&#123;address=xx.xx.xx.xx:27017, type=ReplicaSetArbiter, averageLatency=1.3 ms, state=Connected&#125;, &#123;address=xx.xx.xx.xx:27017, type=Unknown, state=Connecting&#125;, &#123;address=xx.xx.xx.xx:27017, type=ReplicaSetSecondary, averageLatency=1.1 ms, state=Connected&#125;] at com.mongodb.BaseCluster.getServer(BaseCluster.java:82) ~[mongo-java-driver-2.13.0.jar:na] ... 49 common frames omitted å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æœåŠ¡åœ¨è¿æ¥MongoDBæ—¶è¶…æ—¶â€”â€”æ²¡æ‰¾åˆ°primaryèŠ‚ç‚¹ï¼Œåœ¨0msåTimeoutï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå³ä¸‹é¢è¿™æ®µå¼‚å¸¸æ‰æ˜¯æš´éœ²é—®é¢˜çš„åœ°æ–¹ï¼šCaused by: com.mongodb.MongoTimeoutException: Timed out after 0 ms while waiting for a server that matches ...Client view of cluster state is...&#123;address=xx.xx.xx.xx:27017, type=Unknown, state=Connecting&#125;...] åˆ†æé¦–å…ˆï¼Œé€šè¿‡åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°æœ€å…³é”®çš„é‚£ä¸€éƒ¨åˆ†ï¼Œåˆ†æå¾—å‡ºå½“æ—¶ä¸šåŠ¡å¼‚å¸¸çš„é—®é¢˜æ˜¯ä¸šåŠ¡serveråˆ°MongoDB MasterèŠ‚ç‚¹ç½‘ç»œç¨å¾®æœ‰äº›æŠ–åŠ¨/å»¶è¿Ÿï¼Œè€Œæˆ‘ä»¬é…ç½®çš„connectTimeout=0msï¼Œæ‰€ä»¥ä¸šåŠ¡serveræ²¡æœ‰å–å¾—replica setä¸­çš„primaryèŠ‚ç‚¹ï¼Œä¸çŸ¥é“è¯¥å¦‚ä½•å†™å…¥æ•°æ®ï¼Œæ‰ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚ è¿™é‡Œéœ€è¦å°†connectTimeouté€‚å½“è°ƒæ•´å³å¯ã€‚ æ¢ç©¶åœ¨æˆ‘ä»¬çš„ä¸Šå±‚ï¼Œæ— è®ºä½•æ—¶åˆ›å»ºMongoClientï¼Œdriverä¼šå»ºç«‹å’Œserviceçš„è¿æ¥ï¼Œåº”ç”¨å»ºç«‹è¿æ¥çš„ç­‰å¾…æ—¶é•¿å’Œå®¢æˆ·ç«¯è¯·æ±‚åç­‰å¾…æœåŠ¡å™¨å“åº”çš„æ—¶é•¿ï¼Œå–å†³äºæˆ‘ä»¬çš„connection timeoutå’Œsocket timeoutä¸¤ä¸ªå‚æ•°ã€‚ Connection timeoutè¿™ä¸ªå‚æ•°å†³å®šäº†æˆ‘ä»¬çš„å®¢æˆ·ç«¯ç­‰å¾…å»ºç«‹ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªè¿æ¥çš„æœ€é•¿æ—¶é—´ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¸Œæœ›è¿æ¥è¶…æ—¶æ—¶é—´è¶³å¤Ÿé•¿ï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨å³ä½¿åœ¨é¢å¯¹è¾ƒå¤§çš„æœåŠ¡å™¨è´Ÿè½½æˆ–è€…æ–­æ–­ç»­ç»­çš„ç½‘ç»œå»¶è¿Ÿçš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è¾ƒä¸ºå¯é çš„ä¸æœåŠ¡å™¨ç«¯å»ºç«‹èµ·ä¸€ä¸ªè¿æ¥ï¼Œä½†æ˜¯ï¼Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬åˆä¸å¸Œæœ›è¿™ä¸ªå€¼è¿‡å¤§ï¼Œå¦åˆ™åº”ç”¨ä¼šhangä½ï¼Œåœ¨æœåŠ¡å™¨æš‚æ—¶ä¸å¯è®¿é—®çš„æƒ…å†µä¸‹ï¼Œè¿‡åº¦çš„æµªè´¹æ—¶é—´åœ¨ç­‰å¾…æœåŠ¡å™¨çš„è¿æ¥ä¸Šã€‚ æ‰€ä»¥è®¾ç½®è¿™ä¸ªå€¼çš„å¤§å°ä¾¿æ˜¯ä»è€…è§ä»æ™ºè€…è§æ™ºçš„äº‹æƒ…äº†ã€‚ è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ï¼Œåœ¨Javaçš„dirverä¸­ï¼Œcom.mongodb.MongoClientOptions.Builder#connectTimeoutçš„é»˜è®¤å€¼æ˜¯1000*10msï¼Œå³10sã€‚ é‚£åœ¨ä¸Šé¢æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œè®¾ç½®ä¸º0msæ˜¾ç„¶æ˜¯ä¸å¯ç†çš„ï¼Œç½‘ç»œå»¶è¿Ÿæ˜¯ä¸å¯èƒ½ä¸å­˜åœ¨çš„ã€‚ Socket timeoutè¿™ä¸ªå‚æ•°å†³å®šäº†æˆ‘ä»¬çš„å®¢æˆ·ç«¯ç­‰å¾…æœåŠ¡ç«¯å“åº”çš„æœ€é•¿æ—¶é—´ï¼Œè¿™ä¸ªtimeoutå‚æ•°æ§åˆ¶äº†æ‰€æœ‰ç±»å‹çš„è¯·æ±‚â€”â€”queryã€writeã€commandsã€authenticationç­‰ç­‰ã€‚ å¦‚æœæˆ‘ä»¬å°†æ•°å€¼è®¾ç½®ä¸º30sï¼Œåˆ™å®¢æˆ·ç«¯ä¸ä¼šç­‰æœåŠ¡ç«¯å“åº”è¶…è¿‡30sé’Ÿã€‚æ‰€ä»¥é€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬æ˜¯ä¸ä¼šé™åˆ¶è¿™ä¸ªæ—¶é—´çš„ï¼Œè¿™æ ·å¯ä»¥ä½¿æ•°æ®åº“çš„æ“ä½œå“åº”æ¯”è¾ƒè‡ªç”±ã€‚ åœ¨å¤§å¤šæ•°çš„driverä¸­ï¼Œè¿™ä¸ªå‚æ•°éƒ½æ˜¯æ— é™å¤§ï¼ˆæˆ–è€…æ²¡æœ‰é™åˆ¶çš„ï¼‰ã€‚è¿™ä¸ªå‚æ•°åœ¨Javaçš„driverä¸­ï¼Œcom.mongodb.MongoClientOptions.Builder#socketTimeoutå€¼æ˜¯0,ç”¨äºè¡¨ç¤ºä¸é™åˆ¶ã€‚ å‚è€ƒ[1].Do you want a timeout?[2].mongodb connection timed out error[3].Class MongoClientOptions","tags":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://elbarco.cn/tags/MongoDB/"}]},{"title":"Got signal:6 (Aborted) å¼•èµ·çš„MongoDBå´©æºƒåˆ†æè§£å†³","date":"2017-06-23T01:51:41.000Z","path":"2017/06/23/mongodb-crashed-with-the-Got-signal-6-Aborted/","text":"ä¸€ã€èƒŒæ™¯è¿‘æ—¥ï¼ŒåŒäº‹åœ¨å¯¹MongoDBçš„è¯»å†™å‹åŠ›è¿›è¡Œæµ‹è¯•ï¼Œå†æ’å…¥å¤§é‡æ•°æ®æ—¶ï¼Œå¸¸ä¼šé‡åˆ°MongoDBæœåŠ¡è«åå´©æºƒã€‚äºæ˜¯ï¼Œè¿™è¾¹å¯¹æ—¥å¿—è¿›è¡Œäº†åˆ†æâ€”â€”å‘ç°ï¼Œåœ¨æ—¥å¿—ä¸­ï¼Œæœ‰å¦‚ä¸‹çš„ä¸€æ®µbacktraceï¼š2017-06-21T11:59:31.290+0800 F - [conn963] Got signal: 6 (Aborted). 0xf5e669 0xf5dce2 0xf5e096 0x3221032660 0x32210325e5 0x3221033dc5 0xda0c59 0x8dd622 0x8de181 0x8b31d7 0x8d1a17 0x8d34d6 0x9bdc64 0x9bebed 0x9bf8fb 0xb9340a 0xaa3480 0x7e99fd 0xf1badb 0x3221407aa1 0x32210e8aad----- BEGIN BACKTRACE -----&#123;&quot;backtrace&quot;:[&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;B5E669&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;B5DCE2&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;B5E096&quot;&#125;,&#123;&quot;b&quot;:&quot;3221000000&quot;,&quot;o&quot;:&quot;32660&quot;&#125;,&#123;&quot;b&quot;:&quot;3221000000&quot;,&quot;o&quot;:&quot;325E5&quot;&#125;,&#123;&quot;b&quot;:&quot;3221000000&quot;,&quot;o&quot;:&quot;33DC5&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;9A0C59&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;4DD622&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;4DE181&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;4B31D7&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;4D1A17&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;4D34D6&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;5BDC64&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;5BEBED&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;5BF8FB&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;79340A&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;6A3480&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;3E99FD&quot;&#125;,&#123;&quot;b&quot;:&quot;400000&quot;,&quot;o&quot;:&quot;B1BADB&quot;&#125;,&#123;&quot;b&quot;:&quot;3221400000&quot;,&quot;o&quot;:&quot;7AA1&quot;&#125;,&#123;&quot;b&quot;:&quot;3221000000&quot;,&quot;o&quot;:&quot;E8AAD&quot;&#125;],&quot;processInfo&quot;:&#123; &quot;mongodbVersion&quot; : &quot;3.0.6&quot;, &quot;gitVersion&quot; : &quot;1ef45a23a4c5e3480ac919b28afcba3c615488f2&quot;, &quot;uname&quot; : &#123; &quot;sysname&quot; : &quot;Linux&quot;, &quot;release&quot; : &quot;2.6.32-642.6.2.el6.x86_64&quot;, &quot;version&quot; : &quot;#1 SMP Wed Oct 26 06:52:09 UTC 2016&quot;, &quot;machine&quot; : &quot;x86_64&quot; &#125;, &quot;somap&quot; : [ &#123; &quot;elfType&quot; : 2, &quot;b&quot; : &quot;400000&quot; &#125;, &#123; &quot;b&quot; : &quot;7FFC4BCCC000&quot;, &quot;elfType&quot; : 3 &#125;, &#123; &quot;path&quot; : &quot;/lib64/libpthread.so.0&quot;, &quot;elfType&quot; : 3 &#125;, &#123; &quot;path&quot; : &quot;/lib64/librt.so.1&quot;, &quot;elfType&quot; : 3 &#125;, &#123; &quot;path&quot; : &quot;/lib64/libdl.so.2&quot;, &quot;elfType&quot; : 3 &#125;, &#123; &quot;path&quot; : &quot;/usr/lib64/libstdc++.so.6&quot;, &quot;elfType&quot; : 3 &#125;, &#123; &quot;path&quot; : &quot;/lib64/libm.so.6&quot;, &quot;elfType&quot; : 3 &#125;, &#123; &quot;path&quot; : &quot;/lib64/libgcc_s.so.1&quot;, &quot;elfType&quot; : 3 &#125;, &#123; &quot;path&quot; : &quot;/lib64/libc.so.6&quot;, &quot;elfType&quot; : 3 &#125;, &#123; &quot;path&quot; : &quot;/lib64/ld-linux-x86-64.so.2&quot;, &quot;elfType&quot; : 3 &#125; ] &#125;&#125; mongod(_ZN5mongo15printStackTraceERSo+0x29) [0xf5e669] mongod(+0xB5DCE2) [0xf5dce2] mongod(+0xB5E096) [0xf5e096] libc.so.6(+0x32660) [0x3221032660] libc.so.6(gsignal+0x35) [0x32210325e5] libc.so.6(abort+0x175) [0x3221033dc5] mongod(_ZN5mongo12SecureRandom6createEv+0x1B9) [0xda0c59] mongod(_ZN5mongo31SaslSCRAMSHA1ServerConversation10_firstStepERSt6vectorISsSaISsEEPSs+0x16F2) [0x8dd622] mongod(_ZN5mongo31SaslSCRAMSHA1ServerConversation4stepERKNS_10StringDataEPSs+0x2F1) [0x8de181] mongod(_ZN5mongo31NativeSaslAuthenticationSession4stepERKNS_10StringDataEPSs+0x27) [0x8b31d7] mongod(+0x4D1A17) [0x8d1a17] mongod(+0x4D34D6) [0x8d34d6] mongod(_ZN5mongo12_execCommandEPNS_16OperationContextEPNS_7CommandERKSsRNS_7BSONObjEiRSsRNS_14BSONObjBuilderEb+0x34) [0x9bdc64] mongod(_ZN5mongo7Command11execCommandEPNS_16OperationContextEPS0_iPKcRNS_7BSONObjERNS_14BSONObjBuilderEb+0xC1D) [0x9bebed] mongod(_ZN5mongo12_runCommandsEPNS_16OperationContextEPKcRNS_7BSONObjERNS_11_BufBuilderINS_16TrivialAllocatorEEERNS_14BSONObjBuilderEbi+0x28B) [0x9bf8fb] mongod(_ZN5mongo8runQueryEPNS_16OperationContextERNS_7MessageERNS_12QueryMessageERKNS_15NamespaceStringERNS_5CurOpES3_+0x77A) [0xb9340a] mongod(_ZN5mongo16assembleResponseEPNS_16OperationContextERNS_7MessageERNS_10DbResponseERKNS_11HostAndPortE+0xB10) [0xaa3480] mongod(_ZN5mongo16MyMessageHandler7processERNS_7MessageEPNS_21AbstractMessagingPortEPNS_9LastErrorE+0xDD) [0x7e99fd] mongod(_ZN5mongo17PortMessageServer17handleIncomingMsgEPv+0x34B) [0xf1badb] libpthread.so.0(+0x7AA1) [0x3221407aa1] libc.so.6(clone+0x6D) [0x32210e8aad]----- END BACKTRACE ----- é™¤äº†Got signal: 6 (Aborted)è¿˜æœ‰ç‚¹æ„ä¹‰ï¼Œä¸‹é¢çš„è¿™äº›traceï¼Œå®Œå…¨ä¸çŸ¥æ‰€äº‘ã€‚ äºŒã€æŸ¥è¯¢åˆ†ææ‰¾åˆ°å…³é”®è¯ä¹‹åï¼ŒæŸ¥è¯¢è¿™ä»¶äº‹æƒ…å°±å¾ˆç®€å•çš„äº†ï¼ŒGoogleä¸€ä¸‹ï¼Œå‘ç°åœ¨MongoDBçš„JIRAä¸Šï¼Œæœ‰äººæé—®ç›¸åŒçš„é—®é¢˜ï¼Œ&gt;&gt;ä¼ é€é—¨ï¼Œåœ¨ä¸‹é¢çš„å›å¤ä¸­ï¼Œæåˆ°äº†ï¼ŒåŸå› æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œæ‰“å¼€çš„æ–‡ä»¶æ•°é‡è¶…è¿‡äº†æ“ä½œç³»ç»Ÿçš„ulimitä¸­çš„é…ç½®ï¼Œå¹¶ç»™å‡ºäº†é…ç½®çš„æ–‡æ¡£è¯´æ˜ï¼Œ&gt;&gt;&gt;ä¼ é€é—¨ï¼Œä¸‹é¢ç®€å•çš„æ€»ç»“ä¸€ä¸‹â€”â€” å¤§å¤šæ•°ç±»Unixçš„æ“ä½œç³»ç»Ÿï¼Œå¦‚Linuxå’ŒMac OS Xï¼Œæä¾›äº†ä¸€äº›é™åˆ¶å’Œæ§åˆ¶ç³»ç»Ÿèµ„æºä½¿ç”¨çš„æœºåˆ¶ï¼Œè¿™é‡Œçš„ç³»ç»Ÿèµ„æºæ¯”å¦‚è¯´ï¼šçº¿ç¨‹ã€æ–‡ä»¶ã€ç½‘ç»œè¿æ¥æ•°ç­‰ç­‰ã€‚è¿™ä¸ªæ§åˆ¶å³ulimitï¼Œç”¨äºé¿å…å•ç”¨æˆ·ä½¿ç”¨è¿‡å¤šçš„ç³»ç»Ÿèµ„æºï¼Œå½“ç„¶ï¼Œæœ‰äº›æ—¶å€™ulimitçš„ä¸€äº›é»˜è®¤å€¼ç›¸å¯¹è¾ƒä½ï¼Œæ‰€ä»¥ä¼šå½±å“ä¸€äº›æ­£å¸¸çš„MongoDBæ“ä½œã€‚ ç®€å•çš„çœ‹ä¸€ä¸‹å¦‚ä½•è®¾ç½®èµ„æºé™åˆ¶â€”â€”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ulimitå‘½ä»¤æ¥æ£€æŸ¥ç›®å‰çš„é…ç½®ï¼Œä¾‹å¦‚ï¼š[root@mongodb-master ~]# ulimit -acore file size (blocks, -c) 0data seg size (kbytes, -d) unlimitedscheduling priority (-e) 0file size (blocks, -f) unlimitedpending signals (-i) 63706max locked memory (kbytes, -l) 64max memory size (kbytes, -m) unlimitedopen files (-n) 1024pipe size (512 bytes, -p) 8POSIX message queues (bytes, -q) 819200real-time priority (-r) 0stack size (kbytes, -s) 10240cpu time (seconds, -t) unlimitedmax user processes (-u) 63706virtual memory (kbytes, -v) unlimitedfile locks (-x) unlimited åœ¨ä½¿ç”¨ulimitä¿®æ”¹å…·ä½“æŸä¸ªé…ç½®é¡¹çš„å€¼æ—¶ï¼Œä¾‹å¦‚ä¿®æ”¹open fileæ—¶ï¼Œè¯­æ³•ä¸ºulimit -n &lt;value&gt;ã€‚ä¿®æ”¹æ—¶è¿˜è¦æ³¨æ„ï¼Œæœ‰hardå’Œsoftä¸¤ä¸ªé€‰é¡¹ï¼š é€‰é¡¹ å«ä¹‰ ä¾‹å­ -H è®¾ç½®ç¡¬èµ„æºé™åˆ¶ï¼Œä¸€æ—¦è®¾ç½®ä¸èƒ½å¢åŠ  ulimit -Hs 64ï¼Œé™åˆ¶ç¡¬èµ„æºï¼Œçº¿ç¨‹æ ˆå¤§å°ä¸º64K -S è®¾ç½®è½¯èµ„æºé™åˆ¶ï¼Œè®¾ç½®åå¯ä»¥å¢åŠ ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡ç¡¬èµ„æºè®¾ç½® ulimit -Sn 32ï¼Œé™åˆ¶è½¯èµ„æºï¼Œ32ä¸ªæ–‡ä»¶æè¿°ç¬¦ MongoDBå®˜æ–¹æ‰‹å†Œä¸­ç»™å‡ºçš„mongodå’Œmongosçš„è®¾ç½®æ¨èå€¼ä¸ºï¼š -f (file size): unlimited -t (cpu time): unlimited -v (virtual memory): unlimited -n (open files): 64000 -m (memory size): unlimited -u (processes/threads): 64000 æ‰€ä»¥å¯¹ç…§æ¨èå€¼ï¼Œä¿®æ”¹æˆ‘ä»¬mongodb-masterçš„ulimité…ç½®å³å¯ã€‚å…·ä½“é…ç½®çš„è¯­æ³•ï¼Œæ ¹æ®ä¸åŒçš„Linuxå‘è¡Œç‰ˆæœ¬å¯èƒ½ä¸åŒï¼Œå¯ä»¥é˜…è¯»æ‰‹å†Œè·å¾—å¸®åŠ©ã€‚ æ³¨ï¼šä¿®æ”¹åéœ€è¦å¯¹åº”é‡å¯mongodæœåŠ¡ã€‚ ä¸‰ã€å»¶ä¼¸ulimitä½œä¸ºå¯¹èµ„æºä½¿ç”¨é™åˆ¶çš„ä¸€ç§æ–¹å¼ï¼Œæ˜¯æœ‰å…¶ä½œç”¨èŒƒå›´çš„ï¼Œå®ƒçš„ä½œç”¨å¯¹è±¡æ˜¯å½“å‰shellè¿›ç¨‹ä»¥åŠå…¶æ´¾ç”Ÿçš„å­è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢æˆ‘ä»¬é…ç½®å®Œopen fileçš„å€¼åï¼Œå¦‚æœå†æ‰“å¼€ä¸€ä¸ªshellç»ˆç«¯ï¼Œå†æ¬¡æŸ¥çœ‹ulimit -aä¼šå‘ç°open fileçš„å€¼çœ‹èµ·æ¥åƒâ€œæ¢å¤åŸçŠ¶â€ï¼ˆrevertï¼‰ä¸€æ ·ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåˆšæ‰æˆ‘ä»¬çš„è®¾ç½®æ˜¯å¦ç”Ÿæ•ˆè¿˜å¦‚ä½•æ£€æŸ¥å‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“ä¿®æ”¹åé‡å¯çš„mongodæœåŠ¡çš„PIDï¼Œç„¶åä½¿ç”¨å‘½ä»¤ï¼šcat /proc/&lt;PID&gt;/limitsæ¥æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ulimité…ç½®ï¼š[root@mongodb-master ~]# ps -ef | grep mongoroot 4802 1 42 Jun21 ? 20:52:00 /root/mongodb-linux-x86_64-3.0.6/bin/mongod -f /root/mongodb-linux-x86_64-3.0.6/master.confroot 29337 28455 0 15:17 pts/0 00:00:00 grep mongo[root@mongodb-master ~]# cat /proc/4802/limitsLimit Soft Limit Hard Limit Units Max cpu time unlimited unlimited seconds Max file size unlimited unlimited bytes Max data size unlimited unlimited bytes Max stack size 10485760 unlimited bytes Max core file size 0 unlimited bytes Max resident set unlimited unlimited bytes Max processes 63706 63706 processes Max open files 64000 64000 files Max locked memory 65536 65536 bytes Max address space unlimited unlimited bytes Max file locks unlimited unlimited locks Max pending signals 63706 63706 signals Max msgqueue size 819200 819200 bytes Max nice priority 0 0 Max realtime priority 0 0 Max realtime timeout unlimited unlimited us å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬çš„é…ç½®æ˜¯ç”Ÿæ•ˆçš„ï¼Œå¦‚æœæœåŠ¡é‡å¯åï¼Œå¯¹åº”æ˜¯å¦ç”Ÿæ•ˆï¼Œè¿˜éœ€è¦æ£€æŸ¥å’ŒéªŒè¯ã€‚ é‚£ä¹ˆï¼Œæ˜¯å¦æœ‰é’ˆå¯¹æŸä¸ªå…·ä½“ç”¨æˆ·çš„èµ„æºåŠ ä»¥é™åˆ¶çš„æ–¹æ³•å‘¢ï¼Ÿå¯¹äºCentOS6æ¥è¯´ï¼Œå¯ä»¥ä¿®æ”¹ç³»ç»Ÿçš„/etc/security/limits.confé…ç½®æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š&lt;domain&gt; &lt;type&gt; &lt;item&gt; &lt;value&gt; å…¶ä¸­ï¼Œ&lt;domain&gt;è¡¨ç¤ºç”¨æˆ·æˆ–è€…ç»„çš„åå­—ï¼Œè¿˜å¯ä»¥ä½¿ç”¨*ä½œä¸ºé€šé…ç¬¦ï¼Œä¸è¿‡é€šé…ç¬¦å¯¹rootç”¨æˆ·å¯æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œåˆ‡è®°ã€‚ ä¸è¿‡æˆ‘å°è¯•å„ç§è½¯ç¡¬ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œå¹¶æ²¡æœ‰å‘ç°ulimit -aæœ‰ä¸æ¯«çš„å˜åŒ–ï¼ŒçœŸçš„æ˜¯æ‰é“äº†ï¼Œè€å¿ƒï¼Œä¹Ÿè®¸å› ä¸ºæˆ‘ç”¨çš„æ˜¯rootç”¨æˆ·ï¼Ÿæ¬¢è¿é‚®ä»¶äº¤æµï¼šzh.f@outlook.com å››ã€å‚è€ƒ[1].Mongodb Crashed with the Got signal: 6 (Aborted)[2].Unix ulimit Settings[3].How do I change the number of open files limit in Linux?[4].Linux ulimitå‘½ä»¤[5].ulimit -n not changing - values limits.conf has no effect","tags":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://elbarco.cn/tags/MongoDB/"}]},{"title":"Pythonä¸­çš„å…ƒç»„å’ŒPacking/Unpacking","date":"2017-03-30T03:02:31.000Z","path":"2017/03/30/packing-and-unpacking-tuples/","text":"ä»€ä¹ˆæ˜¯å…ƒç»„å…ƒç»„ï¼ˆTupleï¼‰æ˜¯ä¸åˆ—è¡¨ç±»ä¼¼çš„æ•°æ®ç»“æ„ï¼Œåªå¯è¢«åˆ›å»ºï¼Œä¸å¯è¢«ä¿®æ”¹ï¼Œç”¨ä¸€å¯¹åœ†æ‹¬å·()åŒ…èµ·æ¥ï¼Œå¦‚ï¼š&gt;&gt;&gt; x = ('a','b','c') #å…·æœ‰ä¸‰ä¸ªå…ƒç´ çš„å…ƒç»„&gt;&gt;&gt; y = ('a',) #åªæœ‰ä¸€ä¸ªå…ƒç´ çš„å…ƒç»„ï¼Œæ³¨æ„ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªé€—å·æ¥æ ‡è¯†&gt;&gt;&gt; z = () #ç©ºå…ƒç»„ å…ƒç»„çš„æ“ä½œè·Ÿåˆ—è¡¨éå¸¸ç±»ä¼¼ï¼Œå¦‚+ï¼Œ*ï¼Œåˆ‡ç‰‡ç­‰ï¼Œåœ¨å…ƒç»„ä¸­åŒæ ·é€‚ç”¨ï¼š&gt;&gt;&gt; a = (1,2,3)&gt;&gt;&gt; a[:2](1, 2)&gt;&gt;&gt; a * 1(1, 2, 3)&gt;&gt;&gt; a + (4,5)(1, 2, 3, 4, 5) å…ƒç»„çš„Packing/UnpackingPythonä¸­å…è®¸å…ƒç»„å‡ºç°åœ¨èµ‹å€¼è¿ç®—ç¬¦çš„å·¦ä¾§ï¼Œè¿™æ ·å…ƒç»„ä¸­çš„æ¯ä¸ªå˜é‡å°±å¯ä»¥è¢«èµ‹å€¼ä¸ºå³ä¾§å¯¹åº”ä½ç½®çš„å€¼ï¼Œå¦‚ï¼š&gt;&gt;&gt; (a,b,c,d) = (1,2,3,4)&gt;&gt;&gt; a1&gt;&gt;&gt; c3 ä¸Šé¢çš„å†™æ³•è¿˜å¯ä»¥ç®€åŒ–ä¸º:&gt;&gt;&gt; a,b,c,d = 1,2,3,4 è¿™ä¸ªç”¨æ³•è¿˜å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®Œæˆäº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ï¼š&gt;&gt;&gt; var1, var2 = var2, var1 åœ¨Python3ä¸­ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªæ‰©å±•çš„unpackingç‰¹æ€§â€”â€”ä½¿ç”¨*æ¥æ ‡æ³¨å…ƒç´ æ¥å¸æ”¶ä¸å…¶ä»–å…ƒç´ ä¸åŒ¹é…çš„ä»»ä½•æ•°é‡çš„å…ƒç´ ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š&gt;&gt;&gt; x = (1,2,3,4)&gt;&gt;&gt; a, b, *c = x&gt;&gt;&gt; a, b, c(1, 2, [3, 4])&gt;&gt;&gt; a, *b, c = x&gt;&gt;&gt; a, b, c(1, [2, 3], 4)&gt;&gt;&gt; *a, b, c = x&gt;&gt;&gt; a, b, c([1, 2], 3, 4)&gt;&gt;&gt; a, b, c, d, *e = x&gt;&gt;&gt; a, b, c, d, e(1, 2, 3, 4, []) è¢«æ ‡æ˜Ÿçš„å…ƒç´ æ¥æ”¶å¤šä½™çš„å…ƒç´ ä½œä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œå¦‚æœæ²¡æœ‰å¤šä½™çš„å…ƒç´ ï¼Œåˆ™ä¼šæ¥æ”¶ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ Pythonä¸­çš„Packing/Unpackingåº”ç”¨Pythonä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨*ï¼ˆå¯¹å…ƒç»„æ¥è¯´ï¼‰å’Œ**ï¼ˆå¯¹å­—å…¸æ¥è¯´ï¼‰çš„Packingå’ŒUnpackingå‡½æ•°çš„å‚æ•°ã€‚ * for tuplesä»ä¸‹é¢è¿™ä¸ªä¾‹å­è¯´èµ·ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°fun()æ¥æ”¶å››ä¸ªå‡½æ•°ï¼Œå¹¶æ‰“å°å‡ºæ¥ï¼šdef fun(a, b, c, d): print(a, b, c, d) å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªlistï¼š&gt;&gt;&gt; my_list = [1, 2, 3, 4] è°ƒç”¨å‡½æ•°fun()ï¼š&gt;&gt;&gt; my_list = [1,2,3,4]&gt;&gt;&gt; fun(my_list)Traceback (most recent call last): File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;TypeError: fun() missing 3 required positional arguments: 'b', 'c', and 'd'&gt;&gt;&gt; ä¼šå¾—åˆ°æŠ¥é”™ä¿¡æ¯ï¼Œå‡½æ•°è®¤ä¸ºæˆ‘ä»¬çš„my_listæ˜¯å•ç‹¬çš„ä¸€ä¸ªå‚æ•°ï¼Œè€Œå‡½æ•°è¿˜éœ€è¦é¢å¤–çš„ä¸‰ä¸ªå‚æ•°ã€‚ è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨*æ¥è§£åŒ…ï¼ˆUnpackingï¼‰åˆ—è¡¨ï¼Œä½¿ä¹‹ä½œä¸ºå››ä¸ªå‚æ•°ï¼š&gt;&gt;&gt; fun(*my_list)1 2 3 4 è¿™é‡Œè¿˜æœ‰å¦ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨å†…ç½®çš„range()å‡½æ•°ï¼Œæ¥æ¼”ç¤ºè§£åŒ…åˆ—è¡¨çš„æ“ä½œï¼š æ³¨ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯Python3.xï¼Œrange(3,7)ä¸ä¼šç›´æ¥æ‰“å°åŒºé—´çš„æ‰€æœ‰å€¼ &gt;&gt;&gt; list(range(3,7))[3, 4, 5, 6]&gt;&gt;&gt; args = [3,7]&gt;&gt;&gt; list(range(args))Traceback (most recent call last): File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;TypeError: 'list' object cannot be interpreted as an integer&gt;&gt;&gt; list(range(*args))[3, 4, 5, 6] å½“æˆ‘ä»¬ä¸çŸ¥é“ç©¶ç«Ÿè¦ä¼ é€’å¤šå°‘å‚æ•°ç»™å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‰“åŒ…ï¼ˆPackingï¼‰æŠŠæ‰€æœ‰çš„å‚æ•°æ‰“åŒ…åˆ°ä¸€ä¸ªå…ƒç»„ä¸­ï¼Œç”¨ä¸‹é¢çš„ä¾‹å­æ¥æ¼”ç¤ºæ‰“åŒ…æ“ä½œã€‚ æˆ‘ä»¬æœ‰å‡½æ•°iSum()æ¥åšæ±‚å’Œæ“ä½œdef iSum(*args): sum=0 print(args) #æŠŠargsæ‰“å°å‡ºæ¥ï¼Œçœ‹æ˜¯å¦è¢«æ‰“åŒ…ä¸ºä¸€ä¸ªå…ƒç»„ for i in range(0, len(args)): sum = sum + args[i] return sum æµ‹è¯•æ—¶ï¼Œä¼ å‚ä¸ªæ•°ä¸ç­‰ï¼Œå¾—åˆ°çš„è¾“å‡ºå¦‚ä¸‹ï¼š&gt;&gt;&gt; print(iSum(1,2,3,4,5))(1, 2, 3, 4, 5)15&gt;&gt;&gt; print(iSum(10,20,30))(10, 20, 30)60 å¯ä»¥çœ‹åˆ°å…¥å‚ç¡®å®è¢«æ‰“åŒ…æˆäº†ä¸€ä¸ªå…ƒç»„ï¼Œç„¶åå¾ªç¯éå†å…ƒç»„æ±‚å’Œã€‚ å¦‚æœæ‰“åŒ…åæˆ‘ä»¬æƒ³ä¿®æ”¹å‚æ•°ï¼Œç”±äºå…ƒç»„ä¸å¯ä¿®æ”¹ï¼Œæ‰€ä»¥éœ€è¦å…ˆè½¬æ¢æˆåˆ—è¡¨ã€‚ä¸‹é¢å±•ç¤ºä¸€ä¸ªæ‰“åŒ…å’Œè§£åŒ…æ··åˆä½¿ç”¨çš„ä¾‹å­ã€‚æˆ‘ä»¬æœ‰å‡½æ•°func1()ç”¨äºæ‰“å°å…¥å‚ï¼Œfunc2()ç”¨æˆ·ä¿®æ”¹å…¥å‚çš„å€¼ï¼š&gt;&gt;&gt; def func1(a,b,c):... print(a,b,c)... &gt;&gt;&gt; def func2(*args):... args = list(args)... args[0] = 'elbarco.cn'... args[1] = 'awesome'... func1(*args)... è°ƒç”¨func2()ï¼Œä¼ é€’çš„ä¸‰ä¸ªå‚æ•°ï¼Œé¦–å…ˆæ‰“åŒ…ä¸ºä¸€ä¸ªå…ƒç»„ï¼Œç„¶åå°†å…ƒç»„è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œå¹¶ä¿®æ”¹å‰ä¸¤ä¸ªå…ƒç´ çš„å€¼ï¼Œå†è§£åŒ…ä¸ºä¸‰ä¸ªå‚æ•°ï¼Œæ‰“å°å‡ºç»“æœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&gt;&gt;&gt; func2('Hello','nice','visitors')elbarco.cn awesome visitors ** for dictionarieså¯¹äºå­—å…¸ï¼ˆDictionaryï¼‰ï¼ŒPacking/Unpackingæ“ä½œä½¿ç”¨**ã€‚ è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„func1()ï¼Œå¦‚æœè¦æ‰“å°å­—å…¸çš„å€¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨**æ¥è§£åŒ…ï¼š&gt;&gt;&gt; dict = &#123;&apos;a&apos;:1,&apos;b&apos;:3,&apos;c&apos;:5&#125;&gt;&gt;&gt; func1(**dict)1 3 5 ä¸‹é¢æ¥ä¸€ä¸ªæ‰“åŒ…çš„ä¾‹å­ï¼š&gt;&gt;&gt; def func3(**elbarco):... print(type(elbarco))... for key in elbarco:... print(&quot;%s = %s&quot; % (key, elbarco[key]))... ä¼ å‡ ä¸ªå‚æ•°ï¼Œç”¨func3()å°†å…¥å‚æ‰“åŒ…ä¸ºå­—å…¸ï¼Œç„¶ååœ¨å‡½æ•°ä¸­æŠŠkeyå’Œvalueè¾“å‡ºå‡ºæ¥ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š&gt;&gt;&gt; func3(name='elbarco', location='Beijing', language='Java/Python')&lt;class 'dict'&gt;name = elbarcolocation = Beijinglanguage = Java/Python ä»¥ä¸Šã€‚ å‚è€ƒ1.The Quick Python Book 2nd Edition.Chaptor 5.7.32.Packing and Unpacking Arguments in Python3.Packing and Unpacking Arguments in Python4.Pythonâ€™s range() Function Explained","tags":[{"name":"Python","slug":"Python","permalink":"http://elbarco.cn/tags/Python/"},{"name":"Tuple","slug":"Tuple","permalink":"http://elbarco.cn/tags/Tuple/"}]},{"title":"ä»Pythonä¸­å†…åµŒåˆ—è¡¨å¤åˆ¶è¯´èµ·","date":"2017-03-29T02:00:31.000Z","path":"2017/03/29/nested-lists-and-deep-copies/","text":"å†™åœ¨å‰é¢åœ¨å­¦ä¹ Python3æ—¶ï¼Œçœ‹åˆ°äº†åˆ—è¡¨çš„æ‹·è´ï¼Œäºæ˜¯æŠŠè¿™ä¸ªå°è¯¾é¢˜æ•´ç†åœ¨è¿™é‡Œï¼Œä»¥ä½œè®°å½•ã€‚ å†…åµŒåˆ—è¡¨å’Œåˆ—è¡¨æ‹·è´ä¸­çš„é—®é¢˜Pythonä¸­çš„åˆ—è¡¨æ˜¯å¯ä»¥åµŒå…¥åˆ—è¡¨çš„ï¼Œè¿™ä¸ªç‰¹æ€§çš„åº”ç”¨åœºæ™¯ä¹‹ä¸€ä¾¿æ˜¯ç”¨äºè¡¨ç¤ºäºŒç»´çŸ©é˜µã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š&gt;&gt;&gt; m = [[0, 1, 2], [10, 11, 12], [20, 21, 22]]&gt;&gt;&gt; m[0][0, 1, 2]&gt;&gt;&gt; m[0][1]1&gt;&gt;&gt; m[2][20, 21, 22]&gt;&gt;&gt; m[2][2]22 å½“ç„¶ï¼Œè¿™ä¸€ç‰¹æ€§å¯ä»¥ç”¨äºæŒ‰ç…§æˆ‘ä»¬è‡ªå·±çš„æ–¹å¼æ‰©å±•åˆ°æ›´å¤šç»´çš„çŸ©é˜µã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå†…åµŒåˆ—è¡¨å¦‚æœåªæ˜¯è¿™æ ·ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å…³å¿ƒçš„ä¹Ÿå°±åˆ°æ­¤ä¸ºæ­¢äº†ã€‚ä½†æ˜¯å› ä¸ºæœ‰å˜é‡å¼•ç”¨å¯¹è±¡ï¼Œè€Œå¯¹è±¡æœ¬èº«åˆæ˜¯å¯è¢«ä¿®æ”¹çš„æƒ…å†µï¼Œæ¯”å¦‚åˆ—è¡¨ä¸­å†…åµŒåˆ—è¡¨ï¼Œè€Œå†…åµŒåˆ—è¡¨æœ¬èº«æ˜¯å¯è¢«ä¿®æ”¹çš„ï¼Œæˆ‘ä»¬è¿˜ä¼šé‡åˆ°ä¸‹é¢æåˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥æ¼”ç¤ºã€‚ åˆ›å»ºä¸€ä¸ªå«æœ‰å†…åµŒåˆ—è¡¨çš„åˆ—è¡¨originalï¼š&gt;&gt;&gt; nested = [0]&gt;&gt;&gt; original = [nested, 1]&gt;&gt;&gt; original[[0], 1] åˆ—è¡¨originalçš„ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘äº†åˆ—è¡¨nestedï¼Œå¦‚å›¾æ‰€ç¤ºï¼š åˆ—è¡¨nestedçš„ä¿®æ”¹å¯ä»¥é€šè¿‡ç›´æ¥ä¿®æ”¹å…¶æœ¬èº«ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹åˆ—è¡¨originalæ¥å®ç°ï¼Œå³ï¼š&gt;&gt;&gt; nested[0] = 'zero'&gt;&gt;&gt; original[['zero'], 1]&gt;&gt;&gt; original[0][0] = 0&gt;&gt;&gt; nested[0]&gt;&gt;&gt; original[[0], 1] å¦‚æœæˆ‘ä»¬å°†nestedèµ‹å€¼ä¸ºå…¶ä»–åˆ—è¡¨ï¼Œåˆ™nestedå’Œoriginalä¹‹é—´çš„è¿æ¥å°±ä¼šæ–­æ‰ï¼Œå³ï¼š&gt;&gt;&gt; nested = [2]&gt;&gt;&gt; original[[0], 1] å¦‚å›¾æ‰€ç¤ºï¼š é™¤äº†ä¸Šé¢æåˆ°çš„ç›´æ¥èµ‹å€¼çš„æ–¹å¼ï¼Œåˆ—è¡¨çš„æ‹·è´æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨â€”â€” å…¨åˆ‡ç‰‡(full slice) &gt;&gt;&gt; x = [0, 1, 2]&gt;&gt;&gt; y = x[:]&gt;&gt;&gt; y[0, 1, 2] +æˆ–*è¿ç®—ç¬¦ &gt;&gt;&gt; x = [0, 1, 2]&gt;&gt;&gt; y = x + []&gt;&gt;&gt; y[0, 1, 2]&gt;&gt;&gt; z = x * 1&gt;&gt;&gt; z[0, 1, 2] ä½†æ˜¯æ— è®ºä¸Šé¢å“ªç§å¤åˆ¶æ–¹å¼ï¼Œåªè¦åˆ—è¡¨ä¸­å­˜åœ¨åµŒå…¥åˆ—è¡¨ï¼Œå°±ä¼šå­˜åœ¨è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠè¿™ç§å¤åˆ¶ç§°ä¹‹ä¸ºâ€œæµ…æ‹·è´â€ï¼Œå³shallow copyï¼Œä¸ä¹‹ç›¸å¯¹çš„ï¼Œæ˜¯â€œæ·±æ‹·è´â€ï¼Œå³deep copyã€‚ å¯¹åˆ—è¡¨çš„æ·±æ‹·è´å¯¹äºå«æœ‰å†…åµŒåˆ—è¡¨çš„åˆ—è¡¨æ¥è®²ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŠŠå†…åµŒåˆ—è¡¨ä¹Ÿä¸€å¹¶æ‹·è´ï¼Œåˆ™éœ€è¦ä½¿ç”¨copyæ¨¡å—çš„deepcopyåŠŸèƒ½ã€‚ &gt;&gt;&gt; original = [[0], 1]&gt;&gt;&gt; shallow = original[:]&gt;&gt;&gt; import copy&gt;&gt;&gt; deep = copy.deepcopy(original) å¤åˆ¶åä¸¤ä¸ªåˆ—è¡¨çš„æ„æˆå…¶å®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨å¾—åˆ°åˆ—è¡¨shallowå’Œåˆ—è¡¨deepåï¼Œæˆ‘ä»¬å»å°è¯•ä¿®æ”¹åˆ—è¡¨ä¸­çš„å€¼å’Œå†…åµŒåˆ—è¡¨çš„å€¼ï¼Œå¹¶çœ‹çœ‹æ•ˆæœå¦‚ä½•ï¼š&gt;&gt;&gt; shallow[1]=2 #æ›´æ”¹åˆ—è¡¨ä¸­éå†…åµŒåˆ—è¡¨çš„å€¼ï¼ŒåŸåˆ—è¡¨å€¼ä¸å˜&gt;&gt;&gt; shallow[[0], 2]&gt;&gt;&gt; original[[0], 1]&gt;&gt;&gt; shallow[0][0]='zero' #æ›´æ”¹å†…åµŒåˆ—è¡¨çš„å€¼ï¼ŒåŸåˆ—è¡¨å†…åµŒåˆ—è¡¨å€¼æ”¹å˜&gt;&gt;&gt; shallow[['zero'], 2]&gt;&gt;&gt; original[['zero'], 1]&gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; deep[0][0]=5 #å¯¹äºdeep copyçš„åˆ—è¡¨ï¼Œå³ä½¿ä¿®æ”¹å†…åµŒåˆ—è¡¨çš„å€¼ä¹Ÿä¸ä¼šå½±å“åŸåˆ—è¡¨&gt;&gt;&gt; deep[[5], 1]&gt;&gt;&gt; original[['zero'], 1]&gt;&gt;&gt; æ­¤å¤–ï¼Œå¯¹äºPythonæ¥è®²ï¼Œä»»ä½•åˆ—è¡¨ä¸­åµŒå…¥çš„å¯¹è±¡æ˜¯å¯ä¿®æ”¹çš„ï¼Œå¦‚å­—å…¸ï¼Œéƒ½ä¼šå­˜åœ¨è¿™æ ·çš„é—®é¢˜ã€‚ æ€»ç»“å’Œå¼•ç”³æ€è€ƒé¦–å…ˆï¼Œæ˜ç¡®ä¸€ç‚¹ï¼Œdeep copyå’Œshallow copyå¹¶ä¸æ˜¯Pythonä¸­ç‰¹æœ‰çš„æ¦‚å¿µï¼Œè€Œæ˜¯ä¸€ä¸ªä¸å¤åˆ¶å¯¹è±¡æ—¶å¯¹è±¡çš„æˆå‘˜æ˜¯å¦è¢«å¤åˆ¶æœ‰å…³çš„é€šç”¨çš„æ¦‚å¿µã€‚ æ ¹æ®ç»´åŸºç™¾ç§‘ä¸­çš„Object copyingä¸­çš„æè¿°ï¼Œæˆ‘ä»¬æ€»ç»“å¦‚ä¸‹ï¼š æˆ‘ä»¬æœ‰å˜é‡Aå’Œå˜é‡BæŒ‡å‘ä¸åŒçš„å†…å­˜åœ°å€ï¼Œå½“Bè¢«èµ‹å€¼ä¸ºAæ—¶ï¼Œä¸¤ä¸ªå˜é‡æŒ‡å‘äº†åŒæ ·çš„å†…å­˜åœ°å€ï¼Œä¹‹åæ— è®ºæ˜¯ä¿®æ”¹Aè¿˜æ˜¯Bçš„å†…å®¹ï¼Œéƒ½ä¼šåœ¨å¦ä¸€ä¸ªå˜é‡ä¸­ç«‹å³ä½“ç°å‡ºæ¥ï¼Œå› ä¸ºä¸¤è€…å…±äº«å†…å®¹ã€‚ æˆ‘ä»¬æœ‰å˜é‡Aå’ŒBæŒ‡å‘äº†ä¸åŒçš„å†…å®¹åœ°å€ï¼Œå½“Bè¢«èµ‹å€¼ä¸ºAæ—¶ï¼ŒæŒ‡å‘Aå†…å­˜åœ°å€çš„å†…å®¹è¢«å¤åˆ¶åˆ°Bçš„å†…å­˜ä¸­ï¼Œä¹‹åæ— è®ºæ˜¯ä¿®æ”¹Aè¿˜æ˜¯Bçš„å†…å®¹ï¼ŒAå’ŒBéƒ½æ˜¯ä¿æŒç‹¬ç«‹çš„ï¼Œå› ä¸ºä¸¤è€…ä¸å…±äº«å†…å­˜ï¼Œå³ä¸å…±äº«å†…å®¹ã€‚ å…¶ä»–è¯­è¨€ï¼Œå¦‚Javaï¼Œå¯ä»¥å‚è§StackOverFlowä¸Šçš„è¿™ä¸€ä¸ªè®¨è®ºï¼šHow do I copy an object in Javaï¼Œåé¢æœ‰æœºä¼šå†è¯¦ç»†çš„æ¢³ç†ä¸€ä¸‹ã€‚ å‚è€ƒ1.Whatâ€™s the difference between a deep copy and a shallow copy2.Object copying3.Shallow and deep copy4.The Quick Python Book, 2nd Edition. Chapter 5.6","tags":[{"name":"Python","slug":"Python","permalink":"http://elbarco.cn/tags/Python/"},{"name":"Deep Copy","slug":"Deep-Copy","permalink":"http://elbarco.cn/tags/Deep-Copy/"},{"name":"Shallow Copy","slug":"Shallow-Copy","permalink":"http://elbarco.cn/tags/Shallow-Copy/"}]},{"title":"å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¹‹Actoræ¨¡å‹","date":"2017-01-21T09:30:30.000Z","path":"2017/01/21/introduction-to-actor-model/","text":"ä¸Šä¸€ç¯‡æ–‡ç« ã€Šå‡ ä¸ªæ¦‚å¿µï¼šå¹¶å‘ã€å¹¶è¡Œã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹ã€‹ä¸­ï¼Œå¯¹å¹¶å‘å’Œå¹¶è¡Œçš„æ¦‚å¿µåšäº†ä¸€ä¸ªç®€å•çš„è§£é‡Šï¼Œè€Œæœ¬æ–‡ä¸­åˆ™ä»ä¸¤ç§å¹¶å‘ç¼–ç¨‹æ¨¡å‹è®²èµ·ï¼Œç®€å•çš„ä»‹ç»ä¸€ä¸‹Actoræ¨¡å‹ã€‚ ä¸¤ç§å¹¶å‘ç¼–ç¨‹æ¨¡å‹å¹¶å‘ç¼–ç¨‹ä¸­æœ‰ä¸¤ç±»å¸¸è§çš„æ¨¡å‹ï¼šå…±äº«å†…å­˜å’Œæ¶ˆæ¯ä¼ é€’ã€‚ å…±äº«å†…å­˜æ¨¡å‹ åœ¨å¹¶å‘ç¼–ç¨‹çš„å…±äº«å†…å­˜æ¨¡å‹ä¸­ï¼Œå„ç»„ä»¶é€šè¿‡è¯»å†™å†…å­˜ä¸­çš„å…±äº«å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚ å…±äº«å†…å­˜æ¨¡å‹çš„å…¶ä»–ç¤ºä¾‹ï¼š Aã€Bä¸¤ä¸ªåœ¨åŒä¸€ä¸ªç”µè„‘ä¸­çš„å¤„ç†å™¨ï¼ˆæˆ–è€…åŒä¸€ä¸ªå¤„ç†å™¨çš„ä¸¤ä¸ªæ ¸ï¼‰å…±äº«åŒä¸€ç‰©ç†å†…å­˜ Aã€Bä¸¤ä¸ªè¿è¡Œåœ¨åŒä¸€ç”µè„‘ä¸Šçš„ç¨‹åºï¼Œå…±äº«åŒä¸€æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä¸­æ–‡ä»¶å¯ä»¥è¯»å†™ Aã€Bæ˜¯åŒä¸€Javaç¨‹åºä¸­çš„ä¸¤ä¸ªçº¿ç¨‹ï¼Œå…±äº«ç›¸åŒçš„Javaå¯¹è±¡ã€‚ æ¶ˆæ¯ä¼ é€’æ¨¡å‹ åœ¨æ¶ˆæ¯ä¼ é€’æ¨¡å‹ä¸­ï¼Œå¹¶å‘æ¨¡å—é€šè¿‡é€šä¿¡ä¿¡é“å°†æ¶ˆæ¯å‘é€åˆ°å½¼æ­¤è¿›è¡Œäº¤äº’ã€‚å‘å‡ºçš„æ¶ˆæ¯ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ã€‚ æ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„ç¤ºä¾‹è¿˜æœ‰ï¼š Aå’ŒBæ˜¯é€šç½‘ç»œä¸­çš„ä¸¤å°è®¡ç®—æœºï¼Œé€šè¿‡ç½‘ç»œé€šè®¯ Aæ˜¯ä¸€ä¸ªæµè§ˆå™¨ï¼ŒBæ˜¯ä¸€ä¸ªwebæœåŠ¡å™¨ï¼ŒAæ‰“å¼€è¿æ¥è¯·æ±‚ç½‘é¡µï¼ŒBå‘é€é¡µé¢æ•°æ®ç»™A Actoræ¨¡å‹è®¤è¯†Actoræ¨¡å‹ä¸Šé¢æˆ‘ä»¬è®¤è¯†äº†ä¸¤ç§å¹¶å‘æ¨¡å‹ï¼Œactoræ¨¡å‹å°±å±äºæ¶ˆæ¯ä¼ é€’æ¨¡å‹ã€‚actoræ¨¡å‹çš„åŸºæœ¬æ€æƒ³æ˜¯ä½¿ç”¨actorä½œä¸ºå¹¶å‘åŸºå…ƒï¼Œå¯ä»¥æ ¹æ®æ¥æ”¶çš„æ¶ˆæ¯åšå‡ºä¸åŒçš„å“åº”ï¼ˆæˆ–åŠ¨ä½œã€è¡Œä¸ºï¼‰ï¼š å°†æœ‰é™æ•°é‡çš„æ¶ˆæ¯ä¼ é€’ç»™å…¶ä»–çš„actor äº§ç”Ÿæœ‰é™æ•°é‡çš„æ–°çš„actor å½“ä¸‹ä¸€ä¸ªä¼ å…¥çš„æ¶ˆæ¯è¢«å¤„ç†æ—¶ï¼Œæ”¹å˜è‡ªå·±çš„å†…éƒ¨è¡Œä¸º actoræ¨¡å‹ä½¿ç”¨å¼‚æ­¥æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ã€‚ç‰¹åˆ«è¦æŒ‡å‡ºï¼Œactorä¹‹é—´ä¸é€‚ç”¨ä»»ä½•ä¸­é—´å®ä½“ï¼Œæ¯”å¦‚é€šé“ï¼Œç›¸åçš„ï¼Œæ¯ä¸ªactoræ‹¥æœ‰å¯ä»¥è¢«å¯»å€çš„ä¿¡ç®±ã€‚ä¸è¦æŠŠåœ°å€å’Œèº«ä»½ä¿¡æ¯å¼„æ··æ·†ï¼Œæ¯ä¸ªactorå¯ä»¥æœ‰é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªåœ°å€ã€‚å½“ä¸€ä¸ªactorå‘é€ä¿¡æ¯æ—¶ï¼Œå®ƒå¿…é¡»çŸ¥é“æ¥æ”¶æ–¹çš„åœ°å€ã€‚æ­¤å¤–ï¼Œactorå¯ä»¥ç»™è‡ªå·±å‘ä¿¡æ¯ï¼Œè¿™æ ·ä»–ä»¬å°±å¯ä»¥è‡ªå·±æ¥å—ä¿¡æ¯å¹¶ä¸”ç¨åè¿›è¡Œå¤„ç†ã€‚æ³¨æ„ï¼Œè¿™é‡Œæåˆ°çš„é‚®ç®±å¹¶ä¸æ˜¯æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€ä¸ªç‰¹æ€§çš„å®ç°ï¼Œ actoræ¨¡å‹å¯ä»¥ç”¨äºå¹¶å‘ç³»ç»Ÿçš„å»ºæ¨¡ï¼Œæ­£æ˜¯å› ä¸ºæ¯ä¸ªactorä¸å…¶ä»–actorå®Œå…¨ç‹¬ç«‹ï¼Œæ²¡æœ‰å…±äº«çŠ¶æ€ï¼Œåˆ™å°±æ²¡æœ‰äº†ç«äº‰çŠ¶æ€ï¼ˆrace conditionï¼‰ï¼Œactorä¹‹é—´çš„é€šè®¯å’Œäº¤äº’å®Œå…¨é€šè¿‡å¼‚æ­¥æ¶ˆæ¯ã€‚ æ”¯æŒactoræ¨¡å‹çš„ç¼–ç¨‹è¯­è¨€æœ‰Elixirã€Erlangã€Scalaç­‰ï¼ŒJavaè¯­è¨€å±‚é¢å¹¶ä¸æ”¯æŒï¼Œä½†æ˜¯å¯ä»¥å¼•å…¥Akkaï¼Œä¸€ä¸ªç”¨Scalaç¼–å†™çš„åº“ï¼Œç”¨äºç®€åŒ–ç¼–å†™å®¹é”™çš„ã€é«˜å¯ä¼¸ç¼©æ€§çš„Javaå’ŒScalaçš„actoræ¨¡å‹åº”ç”¨ã€‚ å†™åœ¨åé¢æœ¬æ–‡é‡ç‚¹å…³æ³¨å¹¶å‘ç¼–ç¨‹çš„ä¸¤ç§æ¨¡å‹åŠå¯¹Actoræ¨¡å‹åšä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼ŒAkkaçš„å­¦ä¹ ä¼šæ”¾åˆ°åé¢ï¼Œç”±äºå¯¹Scalaä¸äº†è§£ï¼Œç½‘ä¸Šçœ‹åˆ°çš„ä¾‹å­æ²¡æœ‰åŠæ³•è´´åˆ°è¿™é‡Œä¸å¤§å®¶ä¸€èµ·åˆ†æã€‚ å‚è€ƒèµ„æ–™[1].MIT.6.005.Reading 17:Concurrency[2].Wikipedia.Actor Model[3].Ruben Vermeersch.Concurrency in Erlang and Scala[4].Marko DveÄko.Introduction to Concurrent Programming","tags":[{"name":"Concurrency","slug":"Concurrency","permalink":"http://elbarco.cn/tags/Concurrency/"},{"name":"Actor Model","slug":"Actor-Model","permalink":"http://elbarco.cn/tags/Actor-Model/"}]},{"title":"å‡ ä¸ªæ¦‚å¿µï¼šå¹¶å‘ã€å¹¶è¡Œã€è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹","date":"2017-01-20T02:11:19.000Z","path":"2017/01/20/general-concepts-concurrency-parallelism-process-thread-coroutine/","text":"â€œæœ‰äº†åç¨‹æ¡†æ¶å†ä¹Ÿä¸ç”¨å…³æ³¨çº¿ç¨‹æ± è°ƒåº¦é—®é¢˜â€ï¼Œåœ¨é˜¿é‡ŒåŒåä¸€ç”µå­ä¹¦ã€Šä¸ä¸€æ ·çš„æŠ€æœ¯åˆ›æ–°ã€‹ä¸­çœ‹åˆ°è¿™æ ·ä¸€å¥è¯ã€‚çœ‹åˆ°è¿™å¥è¯çš„æ—¶å€™ï¼Œå†…å¿ƒæ´»åŠ¨æ˜¯è¿™æ ·çš„â€”â€”å½“æˆ‘ä»¬è¿˜åœ¨ç©çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œé˜¿é‡Œçš„çˆ¸çˆ¸ä»¬å·²ç»åœ¨ç ”ç©¶è°ƒåº¦é—®é¢˜å¹¶æœ‰è§£å†³æ–¹æ¡ˆäº†ã€‚æ‰€ä»¥ä¿æŒå¯¹è¿™å¥è¯çš„è´¨ç–‘å’Œæ€è€ƒï¼Œæœ‰äº†ä»Šå¤©çš„æ•´ç†å’Œå­¦ä¹ ï¼Œä¸ºè¿›ä¸€æ­¥å­¦ä¹ åç¨‹æ¡†æ¶ï¼Œå¦‚Akkaèµ·ä¸€ä¸ªå¤´ã€‚ å¹¶å‘å’Œå¹¶è¡Œåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œå¹¶å‘ï¼ˆConcurrencyï¼‰å’Œå¹¶è¡Œï¼ˆParallelismï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µæ—¶å¸¸ä¼šè¢«æåˆ°ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ¦‚å¿µå´ä¸æ˜¯ä¸€ä¸ªæ„æ€ã€‚ å¹¶å‘ï¼ˆConcurrencyï¼‰å¹¶å‘æŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œå¤šä¸ªä»»åŠ¡éƒ½èƒ½åŒæ—¶å–å¾—è¿›å±•ã€‚ æ¯”å¦‚åƒé¥­çš„æ—¶å€™ï¼Œç”µè¯æ¥äº†ï¼Œåœä¸‹æ‰‹å’Œå˜´å»æ¥ç”µè¯ï¼Œæ‰“å®Œç”µè¯ç»§ç»­åƒé¥­ï¼Œè¿™å«å¹¶å‘ã€‚ å¹¶è¡Œï¼ˆParallelismï¼‰å¹¶è¡ŒæŒ‡çš„æ˜¯åº”ç”¨å¯ä»¥å°†ä»»åŠ¡æ‹†æˆæ›´å°çš„å­ä»»åŠ¡ï¼Œè€Œè¿™äº›å­ä»»åŠ¡å¯ä»¥åŒæ—¶å¹³è¡Œç€è¢«å¤„ç†ã€‚ æ¯”å¦‚åƒé¥­çš„åŒæ—¶ï¼Œæˆ‘è¿˜èƒ½æ‰“ç”µè¯ï¼Œè¿™å°±æ˜¯å¹¶è¡Œã€‚ å¯¹æ¯”ç”±ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå¹¶å‘ä¾èµ–äºåº”ç”¨å¦‚ä½•å¤„ç†å¤šä»»åŠ¡ã€‚åº”ç”¨åŒæ—¶åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œå¤„ç†å®Œåœ¨è¿›è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™å«é¡ºåºåœ°ï¼ˆSequentiallyï¼‰æ‰§è¡Œï¼›å¦‚æœåº”ç”¨åŒæ—¶èƒ½å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œè¿™å°±å«å¹¶å‘åœ°ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¹¶è¡Œï¼Œåˆ™ä¾èµ–äºåº”ç”¨å¦‚ä½•å¤„ç†æ¯ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ã€‚åº”ç”¨å¯ä»¥é¡ºåºçš„å°†ä»»åŠ¡ä»å¤´è‡³å°¾çš„æ‰§è¡Œå®Œï¼Œä¹Ÿå¯ä»¥å°†ä»»åŠ¡åˆ†è§£æˆå­ä»»åŠ¡ï¼Œè€Œå­ä»»åŠ¡å¯ä»¥å¹³è¡Œæ‰§è¡Œã€‚ å¹¶å‘ä¸é¡ºåºç›¸å¯¹ï¼Œè€Œå¹¶è¡Œæ˜¯å¹¶å‘çš„å­é›†ã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ›´å½¢è±¡çš„ä¾‹å­ï¼š è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ã€‚åœ¨å½“ä»£é¢å‘çº¿ç¨‹è®¾è®¡çš„è®¡ç®—æœºç»“æ„ä¸­ï¼Œè¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ã€‚ç¨‹åºæ˜¯æŒ‡ä»¤ã€æ•°æ®åŠå…¶ç»„ç»‡å½¢å¼çš„æè¿°ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„å®ä½“ã€‚ çº¿ç¨‹ï¼ˆThreadï¼‰çº¿ç¨‹ï¼Œæœ‰æ—¶è¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹(Lightweight Processï¼ŒLWPï¼‰ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒã€‚ä¸€ä¸ªæ ‡å‡†çš„çº¿ç¨‹ç”±çº¿ç¨‹IDï¼Œå½“å‰æŒ‡ä»¤æŒ‡é’ˆ(PCï¼‰ï¼Œå¯„å­˜å™¨é›†åˆå’Œå †æ ˆç»„æˆã€‚ åç¨‹ï¼ˆCoroutine, Fiberï¼‰åç¨‹ï¼Œåˆç§°ä¸ºå¾®çº¿ç¨‹ï¼Œåœ¨Luaã€Pythonã€Goä¸­æœ‰æ‰€ä½“ç°ã€‚è¿™é‡Œå‚è€ƒå»–é›ªå³°çš„æ–‡ç« ï¼Œä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæœ‰ä¸¤ä¸ªå­ç¨‹åºAå’ŒBï¼šdef A(): print '1' print '2' print '3'def B(): print 'x' print 'y' print 'z' å¯¹äºè¿™ä¸¤ä¸ªå­ç¨‹åºï¼Œä¸€æ¬¡è°ƒç”¨ï¼Œä¸€æ¬¡è¿”å›ï¼Œè¿”å›ç»“æœå¾ˆæœ‰å¯èƒ½æ˜¯ï¼š123xyz è€Œåç¨‹çœ‹ä¸Šå»è™½ç„¶ä¹Ÿæ˜¯å­ç¨‹åºï¼Œä½†æ˜¯åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåœ¨å­ç¨‹åºå†…éƒ¨å¯ä»¥ä¸­æ–­ï¼Œç„¶åè½¬è€Œæ‰§è¡Œåˆ«çš„å­ç¨‹åºï¼Œåœ¨é€‚å½“çš„æ—¶å€™åœ¨è¿”å›æ¥æ¥ç€æ‰§è¡Œã€‚æ¯”å¦‚ä¸Šé¢çš„ä¸¤ä¸ªå­ç¨‹åºå‡è®¾ç”±åç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆå†æ‰§è¡ŒAçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥éšæ—¶ç»ˆç«¯ï¼Œå»æ‰§è¡ŒBï¼ŒBä¹Ÿæœ‰å¯èƒ½åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸­æ–­å†å»æ‰§è¡ŒAï¼Œç»“æœæœ‰å¯èƒ½æ˜¯ï¼š12xy3z æœ‰äº›ç±»ä¼¼å¤šçº¿ç¨‹ï¼Œä½†æ˜¯åç¨‹çš„ç‰¹ç‚¹å®åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚å…¶ä¼˜åŠ¿å°±æ˜¯å…·æœ‰æé«˜çš„æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸éœ€è¦å¿åŸåˆ‡æ¢ï¼Œå‡å°‘äº†CPUåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ã€‚å¦ä¸€æ–¹é¢ï¼Œé¿å…äº†å¤šçº¿ç¨‹çš„é”æœºåˆ¶ï¼Œä¸ä¼šå­˜åœ¨åŒæ—¶çš„å†™å†²çªã€‚ Javaä¸åç¨‹Javaè¯­è¨€æœ¬èº«ä¸æ”¯æŒåç¨‹ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹çš„åº“ã€åç¨‹æ¡†æ¶å¯ä»¥å®ç°ï¼Œå¦‚æ³¨æ˜çš„akkaï¼Œkilimç­‰ã€‚","tags":[{"name":"Concurrency","slug":"Concurrency","permalink":"http://elbarco.cn/tags/Concurrency/"},{"name":"Parallelism","slug":"Parallelism","permalink":"http://elbarco.cn/tags/Parallelism/"},{"name":"Coroutine","slug":"Coroutine","permalink":"http://elbarco.cn/tags/Coroutine/"}]},{"title":"Galera Cluster for MySQLä»‹ç»","date":"2016-12-28T06:27:53.000Z","path":"2016/12/28/introduction-to-galera-cluster-for-mysql/","text":"å…³äºæ•°æ®åº“å¤åˆ¶æ•°æ®åº“çš„å¤åˆ¶ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯åœ¨æ•°æ®åº“é›†ç¾¤ä¸­ï¼Œæ•°æ®åœ¨ä¸€ä¸ªæ•°æ®åº“æœåŠ¡èŠ‚ç‚¹æ‹·è´åˆ°å¦ä¸€ä¸ªæ•°æ®åº“èŠ‚ç‚¹ã€‚å¸¸è§çš„RDBMSçš„å¤åˆ¶æ–¹å¼æœ‰ä¸¤ç§â€”â€” Master/Slave Replication Multi-master Replication å¯¹äºä¸»ä»æ–¹å¼çš„å¤åˆ¶æ–¹å¼ï¼ŒmasterèŠ‚ç‚¹ä¸Šçš„å†™æ“ä½œä¼šé€šè¿‡æ•°æ®åº“æ—¥å¿—ï¼ˆå¦‚MySQäº†çš„binary logï¼‰è®°å½•ï¼Œå¹¶é€šè¿‡ç½‘ç»œä¼ é€’ç»™slaveèŠ‚ç‚¹ï¼Œç„¶åç”±slaveèŠ‚ç‚¹æ ¹æ®masterèŠ‚ç‚¹ä¼ é€’çš„æ—¥å¿—æ‰§è¡Œè¿™äº›å˜æ›´ã€‚è€Œå¯¹äºå¤šä¸»çš„å¤åˆ¶æ–¹å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯æ‰§è¡Œå†™æ“ä½œï¼Œç„¶åå°†å†™æ“ä½œåŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚ æ— è®ºæ˜¯å“ªç§æ–¹å¼ï¼Œæ ¹æ®äº‹åŠ¡åœ¨é›†ç¾¤ä¸­ä¼ é€’çš„æ–¹å¼ï¼Œæˆ‘ä»¬åˆå°†å¤åˆ¶åˆ†ä¸ºä¸¤ç±»â€”â€” Synchronous Replication - åŒæ­¥å¤åˆ¶ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹åœ¨ä¸€ä¸ªå•ä¸€äº‹åŠ¡ä¸­å®ŒæˆåŒæ­¥ï¼Œå³ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡æäº¤æ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹æœ‰ç›¸åŒçš„å€¼ã€‚ Asynchronous Replication - å¼‚æ­¥å¤åˆ¶ï¼Œä¸»èŠ‚ç‚¹çš„å†™æ“ä½œï¼Œå¼‚æ­¥çš„æ›´æ–°åˆ°å…¶ä»–èŠ‚ç‚¹ä¸­ï¼Œå³ï¼Œå½“ä¸»èŠ‚ç‚¹äº‹åŠ¡æäº¤æ—¶ï¼Œåœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼Œæœ‰äº›èŠ‚ç‚¹çš„å€¼ä¸ç›´æ¥ç‚¹ä¸ä¸€è‡´ã€‚ ç›®å‰ï¼Œæˆ‘ä»¬çš„MySQLé›†ç¾¤éƒ¨ç½²æ–¹å¼æ˜¯åŒä¸»ï¼Œä½†æ˜¯åŒä¸€æ—¶åˆ»æ‰€æœ‰çš„è¯»å†™å‹åŠ›åªåœ¨å¯åŠ¨ä¸€å°ä¸Šï¼Œå¹¶æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šå®ç°èµ„æºçš„åˆç†åˆ©ç”¨ï¼Œå³ï¼Œä»…ä¿è¯äº†é«˜å¯ç”¨ï¼Œä½†æ˜¯æ²¡æœ‰ä¿è¯è´Ÿè½½å‡è¡¡ã€‚ ä¸ºäº†å®ç°çœŸæ­£çš„æ•°æ®åº“é›†ç¾¤çš„è´Ÿè½½å‡è¡¡åŠé«˜å¯ç”¨ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªä¸é”™çš„MySQLé›†ç¾¤çš„è§£å†³æ–¹æ¡ˆï¼Œå³Galera Cluster for MySQLã€‚å®ƒå°†å¤šä¸ªæ•°æ®åº“èŠ‚ç‚¹ç»„ç»‡æˆä¸€ä¸ªclusterï¼Œå¹¶æä¾›ä»¥ä¸‹ç‰¹æ€§ï¼š åŒæ­¥å¤åˆ¶ï¼Œä¸»å¤‡æ— å»¶è¿Ÿ æ”¯æŒå¤šä¸»åŒæ—¶è¯»å†™ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹ä¿å­˜å…¨é‡æ•°æ® èŠ‚ç‚¹æ·»åŠ æˆ–åˆ é™¤ï¼Œé›†ç¾¤å…·å¤‡è‡ªåŠ¨ç›‘æµ‹å’Œé…ç½® è¡Œçº§é”å¹¶è¡Œå¤åˆ¶ ä¸éœ€è¦å†™binlog Galera Cluster for MySQLæ¶æ„ä½¿ç”¨äº†Galeraä¹‹åï¼Œå®¢æˆ·ç«¯å’ŒGaleraèŠ‚ç‚¹ä¹‹é—´äº¤äº’çš„æ—¶åºå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š å½“å®¢æˆ·ç«¯æ‰§è¡ŒCOMMITå‘½ä»¤ï¼Œä½†å®é™…æäº¤æœªå‘ç”Ÿå‰ï¼Œæ‰€æœ‰çš„æ•°æ®åº“åŒä¸€äº‹åŠ¡ä¸­çš„å˜æ›´å’Œå˜æ›´è¡Œçš„ä¸»é”®ä¼šè¢«æ”¶é›†åˆ°ä¸€ä¸ªwrite-setä¸­ï¼Œç´§æ¥ç€ï¼Œæ•°æ®åº“èŠ‚ç‚¹å°±ä¼šå°†write-setå‘é€åˆ°æ‰€æœ‰çš„å…¶ä»–èŠ‚ç‚¹ã€‚ ä¹‹åï¼Œwrite-setä¼šä½¿ç”¨ä¸»é”®æ‰§è¡Œä¸€æ¬¡éªŒè¯ï¼Œè¿™ä¸ªæ“ä½œåœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šè¿›è¡Œï¼ŒéªŒè¯æ“ä½œå†³å®šäº†æ˜¯å¦å¯ä»¥åº”ç”¨write-setã€‚å¦‚æœéªŒè¯æœªé€šè¿‡ï¼Œåˆ™èŠ‚ç‚¹ä¸¢æ‰write-setå¹¶ä¸”é›†ç¾¤å›æ»šï¼›å¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™äº‹åŠ¡æäº¤ï¼Œå¹¶ä¸”write-setä¼šè¢«åº”ç”¨åˆ°é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹ã€‚ ä¸Šé¢è¿™ä¸­å¤åˆ¶æ–¹å¼åˆç§°ä¸ºâ€œåŸºäºè®¤è¯çš„å¤åˆ¶â€ï¼ˆCertification Based Replicationï¼‰ã€‚ é‚£ä¹ˆGalera Clusterå†…éƒ¨åˆæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒGalera Clusteræœ‰å››ä¸ªç»„ä»¶ç»„æˆï¼š DBMS - Galera Clusteræ”¯æŒMySQLã€MariaDBå’ŒPercona XtraDB wsrep API Galera Replication Plugin Group Communication plugins è¿™é‡Œå°±ä¸ä¸€ä¸€å±•å¼€å…·ä½“è§£é‡Šäº†ï¼Œè¯¦ç»†çš„å¯ä»¥å‚è§Replication API éƒ¨åˆ†å…³é”®å­—è§£é‡ŠPrimary Componeté™¤äº†å•ä¸€èŠ‚ç‚¹æ•…éšœä¹‹å¤–ï¼Œé›†ç¾¤å¯èƒ½ä¼šç”±äºç½‘ç»œåŸå› åˆ†è£‚æˆå‡ ä¸ªç»„ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†é¿å…å†²çªï¼Œåªæœ‰ä¸€ä¸ªç»„ä»¶å¯ä»¥ç»§ç»­ä¿®æ”¹æ•°æ®åº“çŠ¶æ€ï¼Œè€Œè¿™ä¸ªç»„ä»¶ï¼Œå°±ç§°ä¸ºPrimary Componentã€‚ Primary Componentå…¶å®æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œå½“å‘ç”Ÿé›†ç¾¤åˆ†è£‚çš„æ—¶å€™ï¼ŒGalera Clusterä¼šæ‰§è¡Œä¸€ä¸ªç‰¹æ®Šçš„æƒé‡ç®—æ³•ï¼Œæ¥é€‰ä¸¾ä¸€ä¸ªç»„ä»¶ä½œä¸ºPrimary Componentï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚æœé›†ç¾¤å…·æœ‰å¶æ•°ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ä¼šå­˜åœ¨è„‘è£‚çš„é£é™©ã€‚å¦‚æœç”±äºç½‘ç»œå¯¼è‡´é›†ç¾¤è¢«åˆ†è£‚æˆæ°å¥½æ•°é‡ç›¸ç­‰çš„ä¸¤ä¸ªclusterï¼Œåˆ™æ¯ä¸ªclusteréƒ½æœ‰å¯èƒ½ä¿æŒè‡ªå·±çš„æƒé‡ï¼Œå¹¶ä¸”ä¸¤ä¸ªéƒ½ä¼šå˜æˆnon-primaryçŠ¶æ€ã€‚ æ‰€ä»¥ä¸ºäº†èƒ½å¤Ÿå®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œéœ€è¦è‡³å°‘ä¸‰ä¸ªèŠ‚ç‚¹â€”â€” å•äº¤æ¢å™¨çš„é›†ç¾¤åº”è¯¥è‡³å°‘å…·å¤‡3ä¸ªèŠ‚ç‚¹ è·¨äº¤æ¢æœºçš„é›†ç¾¤åº”è¯¥è‡³å°‘å…·å¤‡3ä¸ªäº¤æ¢æœº è·¨ç½‘ç»œçš„é›†ç¾¤åº”è¯¥è‡³å°‘å…·å¤‡3ä¸ªç½‘ç»œ è·¨æ•°æ®ä¸­å¿ƒçš„é›†ç¾¤åº”è¯¥è‡³å°‘å…·å¤‡3ä¸ªæ•°æ®ä¸­å¿ƒ Replication Configuration wsrep_cluster_name - é›†ç¾¤åç§°ï¼Œæ‰€æœ‰é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼Œåç§°å¿…é¡»ä¸€è‡´ã€‚ wsrep_cluster_address - å®šä¹‰é›†ç¾¤ä¸­çš„èŠ‚ç‚¹IPåœ°å€ï¼Œå¤šä¸ªåœ°å€ä½¿ç”¨é€—å·åˆ†å‰²ã€‚ wsrep_node_name - èŠ‚ç‚¹åç§°ã€‚ wsrep_node_address - æ¯ä¸ªèŠ‚ç‚¹è‡ªå·±çš„IPåœ°å€ã€‚ wsrep_provider - å®šä¹‰Galera Replication Pluginçš„è·¯å¾„ï¼Œå®‰è£…ä¹‹åä¸ç¡®å®šåœ¨å“ªé‡Œçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡find / -name libgalera_smm.so æ¥æŸ¥æ‰¾ã€‚ wsrep_provider_options - å®šä¹‰èŠ‚ç‚¹ä¼ é€’ç»™wsrep providerçš„ä¸€äº›å¯é€‰é…ç½®ï¼Œå¦‚ï¼šgcache.sizeï¼Œè¡¨ç¤ºèŠ‚ç‚¹ç¼“å­˜write-setsé›†åˆçš„ç£ç›˜ç©ºé—´ï¼Œé»˜è®¤å€¼æ˜¯128Mï¼›gcache.page_sizeè¡¨ç¤ºé¡µå­˜å‚¨ä¸­å•é¡µå¤§å°ï¼Œæ•´ä½“é¡µé¢å­˜å‚¨çš„ä¸Šé™æ˜¯ç£ç›˜çš„å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯128Mã€‚ wsrep_method - å®šä¹‰äº†èŠ‚ç‚¹åœ¨å•ä¸ªçŠ¶æ€å¿«ç…§ä¼ è¾“ï¼ˆState Snapshot Transferï¼ŒæŒ‡å®Œæ•´çš„æ•°æ®ä»ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹â€”â€”åˆç§°ä¸ºdonorâ€”â€”æ‹·è´åˆ°ä¸€ä¸ªæ–°åŠ å…¥çš„èŠ‚ç‚¹â€”â€”åˆç§°ä¸ºjoinerâ€”â€”çš„è¿‡ç¨‹ï¼‰ä¸­ä½¿ç”¨çš„æ–¹æ³•æˆ–è€…è„šæœ¬ï¼Œæ”¯æŒçš„æ–¹æ³•æœ‰mysqldumpå’Œrsyncä¸¤ç§ï¼Œåœ¨å¤§æ•°æ®é›†çš„åœºæ™¯ä¸­ï¼Œåè€…æ¯”å‰è€…æ›´å¿«ã€‚ ä¸Šé¢æ˜¯æˆ‘ä»¬/etc/my.cnf.d/wsrep.cnfæ–‡ä»¶ä¸­å‡ ä¸ªé…ç½®é¡¹çš„è§£é‡Šï¼Œæ›´å¤šçš„è¯¦ç»†å†…å®¹ï¼Œè¯·å‚è§http://galeracluster.com/documentation-webpages/reference.htmlã€‚","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://elbarco.cn/tags/MySQL/"},{"name":"Galera Cluster","slug":"Galera-Cluster","permalink":"http://elbarco.cn/tags/Galera-Cluster/"},{"name":"DB","slug":"DB","permalink":"http://elbarco.cn/tags/DB/"}]},{"title":"ç®€è¿°StringBuilderå’ŒStringBufferçš„åŒºåˆ«","date":"2016-09-05T06:36:37.000Z","path":"2016/09/05/difference-between-stringbuilder-and-stringbuffer/","text":"ä»StringBuilderå’ŒStringBufferçš„ä¸åŒè¯´èµ·æœ€è¿‘åœ¨æ¬ç –çš„æ—¶å€™ï¼Œå‘ç°åœ¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œæœ‰äººä¹ æƒ¯ä½¿ç”¨StringBufferï¼Œæœ‰äººä¹ æƒ¯ä½¿ç”¨StringBuilderï¼Œäºæ˜¯æƒ³åˆ°äº†ä¹‹å‰åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°çš„è¿™ä¸ªè®¨è®ºï¼šå›½å†…Javaé¢è¯•æ€»æ˜¯é—®StringBufferï¼ŒStringBuilderåŒºåˆ«æ˜¯å•¥ï¼Ÿæ¡£æ¬¡ä¸ºä»€ä¹ˆè¿™ä¹ˆä½ï¼Œæœç„¶è¿™åœ¨é¢è¯•ä¸­åªæ˜¯ä¸€é“é¢„çƒ­ç­›é€‰é¢˜å˜›ï¼Œä¸è¿‡ä¸€ä¸‹å­è®©æˆ‘ç­”ï¼Œå´å¹¶ä¸èƒ½ç«‹åˆ»å›ç­”ä¸Šæ¥åŒºåˆ«ï¼Œäºæ˜¯é¡ºæ‰‹Googleäº†ä¸€ä¸‹ï¼Œåœ¨StringBuilderå’ŒStringBufferçš„API(JDK1.7)é‡Œæ‰¾åˆ°äº†ç­”æ¡ˆã€‚ä¸‹é¢å°±åšä¸€ä¸‹ç®€è¿°â€”â€” é¦–å…ˆï¼ŒStringBufferå’ŒStringBuilderéƒ½æ˜¯å¯å˜å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å‰è€…æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºåœ¨è°ƒç”¨StringBufferçš„æ“ä½œæ—¶æ˜¯åŒæ­¥çš„ï¼Œåœ¨æºä»£ç ä¸­çœ‹åˆ°çš„å°±æ˜¯æ–¹æ³•ä¸ŠåŠ äº†synchronizedå…³é”®å­—ï¼š...public synchronized StringBuffer append(String str) &#123; super.append(str); return this;&#125;... è€Œåœ¨StringBuilderçš„æºç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ˜¯è¿™æ ·çš„ï¼špublic StringBuilder append(String str) &#123; super.append(str); return this; &#125; ä¸Šé¢ä»…æˆªå–éƒ¨åˆ†ä»£ç ï¼Œæ›´å¤šçš„ä»£ç å¤§å®¶å¯è‡ªè¡ŒæŸ¥çœ‹ã€‚ åœ¨StringBufferçš„APIè¯´æ˜ä¸­ï¼Œæåˆ°ï¼Œåœ¨JDK5ä¸­ï¼Œå¼€å§‹æä¾›äº†åŠŸèƒ½ç›¸åŒï¼Œä½†æ˜¯éçº¿ç¨‹å®‰å…¨ã€ä¸ä½¿ç”¨synchronizedã€æ€§èƒ½æ›´å¥½çš„ç±»StringBuilderï¼Œåœ¨StringBuilderAPIè¯´æ˜ä¸­ï¼Œæœ‰æåˆ°è¿™ä¹ˆä¸€å¥è¯ï¼š Instances of StringBuilder are not safe for use by multiple threads. If such synchronization is required then it is recommended that StringBuffer be used. å³åªæœ‰åœ¨åŒæ­¥æ˜¯å¿…è¦çš„æƒ…å†µä¸‹ï¼Œæ‰å»ºè®®ä½¿ç”¨StringBufferã€‚ å†è®ºæ‹¼æ¥å­—ç¬¦ä¸²çš„ä¸åŒæ–¹æ³•å’Œæ•ˆç‡è‡³æ­¤ï¼ŒåŒºåˆ«å°±ç®€è¿°å®Œäº†ã€‚ä»€ä¹ˆï¼Œè¿™å°±å®Œäº†ï¼Ÿæ‘”â€¦â€¦æŒ‰ç…§é¢è¯•å¥—è·¯ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯è¿›å…¥ä¸‹ä¸€è¯é¢˜äº†ï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯è¦ç»§ç»­ï¼Œç°åœ¨å°±æŠ›å‡ºä¸€ä¸ªéå¸¸åŸºç¡€å¸¸è§çš„å¥—è·¯é—®é¢˜â€”â€” é—®ï¼šå¸¸è§çš„æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šStringçš„concatæ–¹æ³•ã€+æ“ä½œç¬¦ï¼›StringBufferå’ŒStringBuilderçš„appendæ–¹æ³•ã€‚ å†é—®ï¼šä¸Šé¢å‡ ç§æ–¹æ³•æ•ˆç‡å¦‚ä½•ï¼Ÿ ç­”æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œå½“ç„¶æ˜¯StringBuilder&gt;StringBuffer&gt;concatæˆ–+æ“ä½œç¬¦ã€‚ å›ç­”å®Œæ˜¯ä»€ä¹ˆä¹‹åï¼Œæˆ‘ä»¬å†é—®é—®ä¸ºä»€ä¹ˆã€‚é¦–å…ˆï¼ŒStringBufferçš„æ¯ä¸ªappendæ“ä½œéƒ½æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥æ¯”StringBuilderè¦æ…¢ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆéƒ½æ¯”concatæˆ–è€…+æ•ˆç‡æå‘¢ï¼Ÿäºæ˜¯åˆGoogleä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†è¿™ä¸ªè®¨è®ºï¼ˆGoogleå¤§æ³•å¥½ï¼Stackoverflowå¤§æ³•å¥½ï¼Orz..ï¼‰ï¼Œé‡Œé¢æåˆ°ï¼Œåœ¨JDK1.6ä¹‹åï¼Œä½¿ç”¨â€+â€æ“ä½œç¬¦æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨StringBuilderå°†ä¸¤ä¸ªå­—ç¬¦appendåˆ°ä¸€èµ·ï¼Œæ¯”å¦‚æˆ‘ä»¬ä»£ç é‡Œæ˜¯è¿™æ ·å†™çš„ï¼šString one = \"abc\";String two = \"xyz\";String three = one + two; åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼ŒString threeä¼šè¢«ç¼–è¯‘æˆï¼šString three = new StringBuilder().append(one).append(two).toString(); ä¹ä¸€çœ‹ï¼Œæ˜¯æ•ˆç‡äº†å¾ˆå¤šï¼Œä½†æ˜¯å¦‚æœåœ¨å¾ªç¯ä¸­è¿™æ ·å¹²ï¼šString out = \"\";for( int i = 0; i &lt; 10000 ; i++ ) &#123; out = out + i;&#125;return out; é‚£ä¹ˆåœ¨ç¼–è¯‘æ—¶ï¼Œå¯èƒ½å¾—åˆ°çš„å†…å®¹å°±æ˜¯è¿™æ ·å­çš„ï¼šString out = \"\";for( int i = 0; i &lt; 10000; i++ ) &#123; out = new StringBuilder().append(out).append(i).toString();&#125;return out; æ­¤æ—¶ï¼Œæˆ‘ä»¬å…¶å®éƒ½çŸ¥é“åº”è¯¥è¿™æ ·å†™ï¼šStringBuilder out = new StringBuilder();for( int i = 0 ; i &lt; 10000; i++ ) &#123; out.append(i);&#125;return out.toString(); è¿™ä¹Ÿåæ˜ äº†ï¼Œç¼–è¯‘å™¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–ï¼Œä½†æ˜¯å†™å‡ºé«˜æ•ˆçš„ä»£ç ï¼Œè¿˜éœ€è¦æˆ‘ä»¬è‡ªå·±ã€‚ å¦ä¸€ä¸ªè§’åº¦è¾ƒçœŸå„¿çš„éªŒè¯ä¸Šé¢çš„ä»£ç æ˜¯13å¹´ç­”ä¸»åœ¨JDK1.6ä¸­æµ‹è¯•çš„ç»“æœï¼Œåˆæœ‰ä¸€ä½è¾ƒçœŸå„¿çš„æœ‹å‹ï¼Œåœ¨ä¸åŒçš„JDKç‰ˆæœ¬ä¸­è¿›è¡Œäº†æµ‹è¯•ï¼Œå…¨æ–‡è§Java StringBuilder myth debunkedï¼Œæœ€ç»ˆå¾—åˆ°äº†ä¸‹é¢çš„å›¾è¡¨ï¼š ä½¿ç”¨+æ“ä½œç¬¦ ä½¿ç”¨StringBuilder ä½¿ç”¨StringBuilderçš„åŸºå‡† è¿™ä½ç«¥é‹è´´å¿ƒçš„æŠŠæµ‹è¯•ç”¨çš„ä»£ç æ‰˜ç®¡åœ¨Githubä¸Šï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹ä¸€ä¸‹ã€‚æœ€ç»ˆè¿™ç¯‡æ–‡ç« å¾—å‡ºçš„ç»“è®ºå°±æ˜¯â€”â€”é€šè¿‡å¯¹å­—èŠ‚ç çš„åˆ†æï¼Œæˆ‘ä»¬å¾—åˆ°äº†ç­”æ¡ˆï¼Œæ˜¾è€Œæ˜“è§çš„æ˜¯ï¼Œä½¿ç”¨StringBuilderæ˜¯å¯ä»¥æé«˜æ€§èƒ½çš„ã€‚æ–‡ç« å¼€ç¯‡è¿˜æåˆ°è¿™ä¹ˆä¸€å¥è¯â€”â€” Concatenating two Strings with the plus operator is the source of all evil â€” Anonymous Java dev ä¸å¤§å®¶å…±å‹‰ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://elbarco.cn/tags/Java/"}]},{"title":"ä½¿ç”¨Logrotateç®¡ç†MongoDBæ—¥å¿—-åè®°","date":"2016-07-01T07:23:11.000Z","path":"2016/07/01/ä½¿ç”¨Logrotateç®¡ç†MongoDBæ—¥å¿—-åè®°/","text":"å‘ç°é—®é¢˜æ˜¨å¤©å®Œæˆäº†Logrotateç®¡ç†MongoDBæ—¥å¿—çš„é…ç½®å·¥ä½œï¼Œæ‰‹åŠ¨æ‰§è¡ŒéªŒè¯é€šè¿‡ï¼Œä½†æ˜¯ä»Šå¤©æŸ¥çœ‹æ—¥å¿—åˆ‡æ¢æƒ…å†µï¼Œå´æ²¡æœ‰å¦‚æœŸå¾…çš„ä¸€èˆ¬â€”â€”åœ¨æ—¥å¿—ç›®å½•ä¸‹ä»…æœ‰ä¸€ä¸ªmongodb.logæ–‡ä»¶â€”â€”æ—¥å¿—æ²¡æœ‰åˆ‡æ¢ï¼Ÿï¼ åˆ†æç¡®å®šæ‰§è¡Œæƒ…å†µä¸ºäº†ç¡®å®šé…ç½®çš„æ¯å¤©æ‰§è¡Œçš„MongoDBæ—¥è‡³åˆ‡æ¢æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œæˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹/var/log/cronï¼Œä¸‹é¢æ˜¯æˆªå–äº†éƒ¨åˆ†å†…å®¹ï¼š ...Jul 1 03:01:02 localhost anacron[19152]: Will run job &apos;cron.daily&apos; in 49 min.Jul 1 03:01:02 localhost anacron[19152]: Jobs will be executed sequentially...Jul 1 03:50:02 localhost anacron[19152]: Job &apos;cron.daily&apos; started...Jul 1 03:50:02 localhost run-parts(/etc/cron.daily)[19251]: starting logrotateJul 1 03:50:02 localhost run-parts(/etc/cron.daily)[19267]: finished logrotate...Jul 1 03:53:49 localhost anacron[19152]: Job &apos;cron.daily&apos; terminatedJul 1 03:53:49 localhost anacron[19152]: Normal exit (1 job run) å¯ä»¥çœ‹åˆ°ï¼Œåœ¨7æœˆ1æ—¥å‡Œæ™¨3ç‚¹50å·¦å³ç¡®å®æ‰§è¡Œäº†æ¯æ—¥çš„è®¡åˆ’ä»»åŠ¡ï¼Œå¹¶ä¸”cron.dailyæ­£å¸¸é€€å‡ºã€‚ä½†æ˜¯Logrotateæœ‰æ²¡æœ‰å‡ºé”™è¿˜è¦ç»§ç»­åˆ†æã€‚ æŸ¥çœ‹/var/log/messageï¼Œåœ¨åŒæ ·çš„æ—¶é—´æ®µï¼Œå‘ç°äº†è¿™æ ·ä¸€æ¡é”™è¯¯ä¿¡æ¯ï¼šJul 1 03:50:02 localhost logrotate: ALERT exited abnormally with [1] è€Œè¿™æ®µé”™è¯¯ä¿¡æ¯ï¼Œæ­£æ˜¯Logrotateæ¯æ—¥æ‰§è¡Œçš„è®¡åˆ’ä»»åŠ¡è„šæœ¬ä¸­æ‰§è¡Œå¼‚å¸¸é€€å‡ºçš„æç¤ºä¿¡æ¯ï¼š[root@localhost ~]# cat /etc/cron.daily/logrotate #!/bin/sh/usr/sbin/logrotate /etc/logrotate.conf &gt;/dev/null 2&gt;&amp;1EXITVALUE=$?if [ $EXITVALUE != 0 ]; then /usr/bin/logger -t logrotate &quot;ALERT exited abnormally with [$EXITVALUE]&quot;fiexit 0 åŸå› æ¢ç©¶åŸå› æ¢ç©¶çš„è¿‡ç¨‹éå¸¸ç®€å•â€”â€”Googleï¼Œæ‰€ä»¥ç•¥ã€‚ å™—â€¦â€¦å‹è°Šçš„å°èˆ¹è¯´ç¿»å°±ç¿»ï¼ï¼ˆâ•¯ï¼_ï¼ï¼‰â•¯â•§â•§ å›åˆ°æ­£é¢˜ã€‚ å¼•èµ·è¯¥é—®é¢˜çš„åŸå› ä¸SELinuxæœ‰å…³ã€‚ä½¿ç”¨getenforceæŸ¥è¯¢SELinuxçŠ¶æ€ï¼š[root@localhost ~]# getenforceEnforcing å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å½“å‰çš„SELinuxå¤„äºEnforcingæ¨¡å¼ä¸‹ï¼Œæ­¤æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ä¹‹å‰MongoDBè½®æ¢é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨äº†é™¤äº†/var/log/ä¹‹å¤–çš„è·¯å¾„ï¼Œé‚£ä¹ˆï¼š SELinux was restricting the access to logrotate on log files in directories which does not have the required SELinux file context type. â€œ/var/logâ€ directory has â€œvar_log_tâ€ file context, and logrotate was able to do the needful. å³ï¼Œ/var/logç›®å½•å…·æœ‰var_log_tæ–‡ä»¶ä¸Šä¸‹æ–‡ï¼Œå¦‚æœè¦ä½¿ç”¨Logrotateï¼Œæˆ‘ä»¬çš„æ—¥å¿—ç›®å½•ä¹Ÿåº”è¯¥å…·å¤‡è¿™ä¸ªå‘ä¸‹é—®ã€‚æ‰€ä»¥è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸ºé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨çš„æ—¥å¿—ç›®å½•è®¾ç½®æ–‡ä»¶ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤åšåˆ°ï¼šsemanage fcontext -a -t var_log_t &lt;directory/logfile&gt;restorecon -v &lt;directory/logfile&gt; ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºè®¾ç½®ä¸Šä¸‹æ–‡ï¼Œç¬¬äºŒä¸ªå‘½ä»¤ç”¨äºå¯¹äºéœ€è¦è®¾ç½®ä¸Šä¸‹æ–‡çš„ç›®å½•æ´»æ–‡ä»¶ï¼Œé€’å½’çš„è®¾ç½®ã€‚ è§£å†³è¿‡ç¨‹æ£€æŸ¥å®‰è£…æƒ…å†µæ‰§è¡Œman semanageæˆ–semanage -hæ£€æŸ¥æ˜¯å¦å®‰è£…semanage:[root@localhost ~]# man semanageNo manual entry for semanage[root@localhost ~]# semanage -h-bash: semanage: command not found è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå‘½ä»¤ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ç›¸å…³è½¯ä»¶ï¼Œå¦‚æœå·²å®‰è£…ï¼Œåˆ™è·³è¿‡è¿™ä¸€æ­¥ã€‚ å®‰è£…æ‰¾åˆ°æ˜¯ä»€ä¹ˆè½¯ä»¶æä¾›äº†semanageå‘½ä»¤ï¼š[root@localhost ~]# yum provides */semanageLoaded plugins: fastestmirror, refresh-packagekit, securityLoading mirror speeds from cached hostfile * base: mirrors.yun-idc.com * extras: mirrors.yun-idc.com * updates: mirrors.yun-idc.comlibsemanage-devel-2.0.43-5.1.el6.x86_64 : Header files and libraries used to build policy manipulation toolsRepo : baseMatched from:Filename : /usr/include/semanagelibsemanage-devel-2.0.43-5.1.el6.i686 : Header files and libraries used to build policy manipulation toolsRepo : baseMatched from:Filename : /usr/include/semanagepolicycoreutils-python-2.0.83-29.el6.x86_64 : SELinux policy core python utilitiesRepo : baseMatched from:Filename : /usr/sbin/semanagepolicycoreutils-python-2.0.83-29.el6.x86_64 : SELinux policy core python utilitiesRepo : installedMatched from:Filename : /usr/sbin/semanage è¿™é‡Œï¼Œæˆ‘ä»¬æ‰‹åŠ¨å®‰è£…ä¸€ä¸‹policycoreutils-pythonå³å¯ï¼š[root@localhost ~]# yum -y install policycoreutils-python æ‰§è¡Œå‘½ä»¤å®‰è£…å®Œæ¯•ï¼Œæ‰§è¡Œå‘½ä»¤:[root@localhost ~]# semanage fcontext -a -t var_log_t &apos;/mongoData/mongodb_log/mongodb.log&apos;[root@localhost ~]# restorecon -Frvv /mongoData/mongodb_log/mongodb.log è®¾ç½®å®Œfile contextä¹‹åï¼Œè®°å½•ä¼šè¢«æŒä¹…åŒ–åˆ°/etc/selinux/targeted/contexts/files/file_contexts.localä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥ä¸€ä¸‹ï¼š[root@localhost ~]# cat /etc/selinux/targeted/contexts/files/file_contexts.local# This file is auto-generated by libsemanage# Do not edit directly./mongoData/mongodb_log/mongodb.log system_u:object_r:var_log_t:s0 æ­¤æ—¶ï¼Œè¡¥é”…å·¥ä½œç»“æŸã€‚ æ›´å¤šè¯¦ç»†å†…å®¹ï¼Œç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹å‚è€ƒæ–‡ç« ","tags":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://elbarco.cn/tags/MongoDB/"},{"name":"Logrotate","slug":"Logrotate","permalink":"http://elbarco.cn/tags/Logrotate/"}]},{"title":"ä½¿ç”¨Logrotateç®¡ç†MongoDBæ—¥å¿—","date":"2016-06-30T07:26:03.000Z","path":"2016/06/30/ä½¿ç”¨Logrotateç®¡ç†MongoDBæ—¥å¿—/","text":"ç—›ç‚¹å‰æ®µæ—¶é—´éœ€è¦æŸ¥è¯¢MongoDBæ—¥å¿—ï¼ŒæƒŠè§‰MongoDBçš„æ—¥å¿—å¹¶æ²¡æœ‰é…ç½®è‡ªåŠ¨åˆ‡æ¢è½®è½¬ï¼Œè¿™ä¼šå¯¼è‡´åœ¨ç¹å¿™çš„ä¸šåŠ¡ä¸‹ï¼Œæ—¥å¿—å¢é•¿é‡æƒŠäººã€‚é¢å¯¹æµ·é‡çš„MongoDBæ—¥å¿—ï¼Œå¼€å‘å’Œè¿ç»´äººå‘˜æŸ¥çœ‹æ—¥å¿—å˜çš„ååˆ†ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥éœ€è¦å¯»æ±‚ä½¿æ—¥å¿—è‡ªåŠ¨åˆ‡æ¢è½®è½¬çš„æ–¹å¼ã€‚ é€‰å‹é€šè¿‡æŸ¥çœ‹MongoDBå®˜æ–¹æ–‡æ¡£ï¼ŒçŸ¥æ‚‰MongoDBæä¾›äº†å‡ ç§è½®è½¬æ—¥å¿—æ–‡ä»¶çš„ç­–ç•¥ï¼Œè¯¦è§è¿™é‡Œï¼ˆæ®è¯´æ–°ç‰ˆæœ¬çš„MongoDBå·²ç»å®Œæˆäº†è‡ªåŠ¨çš„æ—¥å¿—è½®è½¬åŠŸèƒ½ï¼Ÿï¼‰ã€‚å…¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨MongoDBæä¾›çš„logRotateå‘½ä»¤æˆ–è€…é€šè¿‡å‘mongodè¿›ç¨‹å‘é€SIGUSR1ä¿¡å·æ¥å®ç°ã€‚ ç„¶è€Œçœ‹å¾ˆå¤šæ–‡ç« ä¸­å‡è¡¨ç¤ºï¼ŒMongoDBæœ¬èº«æä¾›çš„logRotateæœºåˆ¶å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚ç”±äºå…¶ä¸ç¨³å®šæ€§ï¼Œä¼šé€ æˆæ—¥å¿—è½®æ¢ä¸­mongodbè¿›ç¨‹ç»ˆæ­¢ï¼Œä¸æä¾›æ—§æ—¥å¿—çš„å‹ç¼©ï¼Œå³ä½¿è½®è½¬åˆ‡æ¢æ—¥å¿—ï¼Œè¿˜æ˜¯å ç”¨äº†å¾ˆå¤šç£ç›˜ç©ºé—´ï¼›æ—¥å¿—æ–‡ä»¶é‡å‘½åæ ¼å¼mongodb.log.2016-10-22T17-44-44ä¸å‹å¥½ç­‰ç­‰ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨é€‰æ‹©æ—¶å°±ä¼šå˜å¾—å¾ˆå°å¿ƒï¼Œå°½é‡é¿å…ä½¿ç”¨å…¶å†…ç½®logRotateã€‚ è¢«å¹¿æ³›è®¤å¯çš„æ–¹æ¡ˆæ˜¯é€šè¿‡Logrotateè¿›è¡Œæ—¥å¿—ç®¡ç†ï¼Œå…¶ä¸­å¯ä»¥æ‰§è¡Œè„šæœ¬å®ç°å‘mongodè¿›ç¨‹å‘é€SIGUSR1ä¿¡å·ã€‚ Logrotateç®€ä»‹Logrotateå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†æ—¥å¿—æ–‡ä»¶ã€‚æ¯”å¦‚å‘¨æœŸæ€§çš„è¯»å–æ—¥å¿—ã€å‹ç¼©æ—¥å¿—ã€å¤‡ä»½æ—¥å¿—ã€åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ç­‰ï¼ŒåŸºæœ¬ä¸Šä½ å¸Œæœ›åšçš„ï¼Œéƒ½èƒ½å®ç°ã€‚é€šå¸¸æ¥è®²ï¼Œå¸¸è¢«ç”¨äºæ¥é¿å…å•ä¸ªæ—¥å¿—æ–‡ä»¶å¢é•¿ä¸ºéš¾ä»¥å¤„ç†çš„å¤§å°ã€‚ä¹Ÿå¸¸è¢«ç”¨äºåˆ é™¤æ—§çš„æ—¥å¿—æ–‡ä»¶æ¥é‡Šæ”¾ç£ç›˜ç©ºé—´ã€‚ é€šå¸¸æ¥è®²ï¼Œé»˜è®¤çš„Logrotateä¼šä½œä¸º/etc/cron.daily/ä¸­çš„ä¸€ä¸ªè®¡åˆ’ä»»åŠ¡æ¯å¤©æ‰§è¡Œä¸€æ¬¡ã€‚[root@localhost etc]# ls /etc/cron.daily/cups logrotate makewhatis.cron mlocate.cron é…ç½®è¯´æ˜é…ç½®Logrotateé€šè¿‡ç¼–è¾‘ä¸¤å¤„é…ç½®æ–‡ä»¶æ¥å®Œæˆï¼š /etc/logrotate.conf /etc/logrotate.d/ä¸‹é¢çš„ä¸åŒæœåŠ¡ç‰¹å®šçš„é…ç½® logrotate.confåŒ…å«äº†é€šç”¨çš„é…ç½®ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé»˜è®¤é…ç½®ï¼š # see &quot;man logrotate&quot; for details# rotate log files weeklyweekly# keep 4 weeks worth of backlogsrotate 4# create new (empty) log files after rotating old onescreate# use date as a suffix of the rotated filedateext# uncomment this if you want your log files compressed#compress# RPM packages drop log rotation information into this directoryinclude /etc/logrotate.d# no packages own wtmp and btmp -- we&apos;ll rotate them here/var/log/wtmp &#123; monthly create 0664 root utmp minsize 1M rotate 1&#125;/var/log/btmp &#123; missingok monthly create 0600 root utmp rotate 1&#125;# system-specific logs may be also be configured here. ä¸Šé¢çš„é€šç”¨é…ç½®æˆ‘ä»¬ä¸ç”¨è¿‡å¤šå…³å¿ƒï¼Œå› ä¸ºæˆ‘ä»¬å…·ä½“æœåŠ¡çš„å…·ä½“é…ç½®åœ¨ç›®å½•/etc/logrotate.d/ä¸‹ã€‚åœ¨è¿™ä¸ªç›®å½•é‡Œï¼Œè®¸å¤šåº”ç”¨åœ¨å®‰è£…åå·²ç»è®¾ç½®äº†Logrotateï¼Œæ¯”å¦‚httpdï¼Œnginxç­‰ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ‹¿nginxçš„é…ç½®åšä¸€ä¸ªç®€è¦çš„è¯´æ˜ï¼š [root@localhost ~]# cd /etc/logrotate.d/[root@localhost logrotate.d]# lltotal 44-rw-r--r--. 1 root root 185 Aug 2 2013 httpd-rw-r--r--. 1 root root 871 Jun 22 2015 mysqld-rw-r--r--. 1 root root 302 Apr 26 23:10 nginx-rw-r--r--. 1 root root 219 Nov 23 2013 sssd-rw-r--r--. 1 root root 210 Aug 15 2013 syslog-rw-r--r--. 1 root root 100 Feb 22 2013 yum[root@localhost logrotate.d]# cat nginx /var/log/nginx/*.log &#123; daily missingok rotate 52 compress delaycompress notifempty create 640 nginx adm sharedscripts postrotate [ -f /var/run/nginx.pid ] &amp;&amp; kill -USR1 `cat /var/run/nginx.pid` endscript&#125; é¦–å…ˆç¬¬ä¸€è¡Œï¼Œé…ç½®äº†è¦è‡ªåŠ¨è½®æ¢çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„/var/log/nginx/*.logï¼Œå³é’ˆå¯¹åœ¨/var/log/nginxä¸‹çš„*.logæ–‡ä»¶è¿›è¡Œè½®æ¢ã€‚ dailyï¼šæ¯å¤©è½®æ¢æ—¥å¿—ã€‚å¯é€‰é€‰é¡¹æœ‰dailyï¼Œweeklyï¼Œmonthlyå’Œyearly missingokï¼šæ‰¾ä¸åˆ°*.logæ–‡ä»¶ä¹Ÿæ˜¯okçš„ï¼Œä¸è¦æ–¹â€¦â€¦ rotate 52ï¼šä¿ç•™52ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå…¶ä»–æ›´è€æ—§çš„æ—¥å¿—æ–‡ä»¶åˆ æ‰ï¼ˆåœ¨è¿™é‡Œè¦é…åˆdailyä½¿ç”¨ï¼Œå³ä¿ç•™52å¤©çš„æ—¥å¿—æ–‡ä»¶ï¼‰ compressï¼šå‹ç¼©æ—¥å¿—æ–‡ä»¶ï¼ˆé»˜è®¤gzipæ ¼å¼ï¼‰ delaycompressï¼šå»¶è¿Ÿå‹ç¼©ä»»åŠ¡ç›´åˆ°ç¬¬äºŒæ¬¡è½®æ¢æ—¥å¿—æ‰è¿›è¡Œã€‚ç»“æœä¼šå¯¼è‡´ä½ ä¼šæœ‰å½“å‰çš„æ—¥å¿—æ–‡ä»¶ï¼Œä¸€ä¸ªè¾ƒæ—§çš„æ²¡æœ‰è¢«å‹ç¼©è¿‡çš„æ—¥å¿—æ–‡ä»¶å’Œä¸€äº›å‹ç¼©è¿‡çš„æ—¥å¿—æ–‡ä»¶ compresscmdï¼šè®¾ç½®ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤æ¥è¿›è¡Œå‹ç¼©ï¼Œé»˜è®¤æ˜¯gzip uncompresscmdï¼šè®¾ç½®è§£å‹çš„å‘½ä»¤ï¼Œé»˜è®¤æ˜¯gunzipã€‚ notifemptyï¼šä¸è½®è½¬ç©ºæ–‡ä»¶ create 640 nginx admï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶è®¾ç½®æƒé™permissions/owner/groupã€‚æœ¬ä¾‹ä¸­ï¼Œä½¿ç”¨ç”¨æˆ·ngxinå’Œç”¨æˆ·ç»„admåˆ›å»ºäº†ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæ–‡ä»¶æƒé™ä¸º640.åœ¨å¾ˆå¤šç³»ç»Ÿä¸­ï¼Œownerå’Œgroupä¸€èˆ¬éƒ½ä¼šæ˜¯rootã€‚ sharedscriptsï¼šåœ¨æ‰€æœ‰çš„æ—¥å¿—è½®æ¢å®Œæ¯•åæ‰§è¡Œpostrotateè„šæœ¬ã€‚å¦‚æœè¯¥é¡¹æ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä¼šåœ¨æ¯ä¸ªåŒ¹é…çš„æ–‡ä»¶è½®æ¢åæ‰§è¡Œpostrotateè„šæœ¬ã€‚ postrotateï¼šè½®æ¢æ—¥å¿—å®Œæˆåè¿è¡Œçš„è„šæœ¬ã€‚ æ›´å¤šçš„é€‰é¡¹ï¼Œå‚è§è¿™é‡Œã€‚ ä½¿ç”¨Logrotateç®¡ç†MongoDBæ—¥å¿—ç»è¿‡ä¸Šé¢å¯¹Logrotateçš„ç®€å•è¯´æ˜ï¼Œè¿™æ˜¯æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä½¿ç”¨å®ƒæ¥ç®¡ç†MongoDBæ—¥å¿—äº†ã€‚ æ‰¾åˆ°æ—¥å¿—æ–‡ä»¶åŠPIDè®°å½•æ–‡ä»¶é¦–å…ˆï¼Œæˆ‘ä»¬çš„MongoDBå¯åŠ¨é…ç½®ä¸­ï¼ŒæŒ‡å®šäº†logpathå’Œpidfilepathï¼š logpath=/mongoData/mongodb_log/mongodb.log pidfilepath=/mongoData/mongodb.pid mongod.pidå’Œæ–‡ä»¶/mongoData/mongodb_data/mongod.lockä¸­éƒ½å­˜æœ‰mongodçš„PIDï¼Œç”¨è¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½å¯ä»¥è·å–PIDï¼Œä»»é€‰å…¶ä¸€å³å¯ã€‚ ç¼–å†™é…ç½®æ–‡ä»¶é€šè¿‡man logrotateæŸ¥çœ‹è¯¦ç»†å‚æ•°ï¼Œç»“åˆä¸šåŠ¡éœ€æ±‚ï¼Œç¼–å†™çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š /mongoData/mongodb_log/mongodb.log &#123; daily missingok rotate 30 copytruncate dateext compress notifempty create 644 root root sharedscripts postrotate /bin/kill -SIGUSR1 &apos;cat /mongoData/mongodb.pid 2&gt; /dev/null&apos; 2&gt; /dev/null || true endscript&#125; è¿™é‡Œåšä¸€ä¸‹ç®€å•è¯´æ˜ï¼š copytruncate è¿™ä¸ªå‘½ä»¤å¾ˆé‡è¦ï¼Œæ„æ€æ˜¯åœ¨åˆ›å»ºå‰¯æœ¬åï¼Œå°†åŸæ–‡ä»¶æ¸…ç©ºï¼Œè€Œä¸æ˜¯å°†åŸæ–‡ä»¶é‡å‘½åå¹¶åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚è¿™æ ·å¯ä»¥é¿å…æœ‰äº›åº”ç”¨ç»§ç»­å‘åŸæ—¥å¿—æ–‡ä»¶ä¸­è¾“å‡ºï¼Œè€Œä¸æ˜¯æ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚åœ¨æ²¡æœ‰é…ç½®è¿™ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œmongodbä¸€ç›´å‘è½®æ¢åçš„å¸¦æ—¶é—´æˆ³çš„æ—§æ–‡ä»¶ä¸­è¾“å‡ºæ—¥å¿—ã€‚ dateext ç”¨äºåˆ‡æ¢æ—¥å¿—æ–‡ä»¶æ—¶å‘½åæˆä¸ºmongodb.log-YYYYMMDDæ ¼å¼ã€‚ create 644 root root 644æƒé™ï¼Œå³-rw-r--r--ä¸ä¹‹å‰çš„æ—¥å¿—æ–‡ä»¶ä¿æŒä¸€ç›´çš„æƒé™å³å¯ã€‚ éªŒè¯ç¼–å†™å®Œé…ç½®æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å°†æ–‡ä»¶æ‹·è´åˆ°/etc/logrotate.d/ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤logrotate -f -v /etc/logrotate.d/&lt;YOUR_CONFIG_FILE_NAME&gt;æ¥éªŒè¯æ—¥å¿—æ˜¯å¦è¢«è½®æ¢äº†ï¼Œç¤ºä¾‹æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š root@localhost mongodb_log]# logrotate -f -v /etc/logrotate.d/mongologrotatereading config file /etc/logrotate.d/mongologrotatereading config info for /mongoData/mongodb_log/mongodb.logHandling 1 logsrotating pattern: /mongoData/mongodb_log/mongodb.log forced from command line (30 rotations)empty log files are not rotated, old logs are removedconsidering log /mongoData/mongodb_log/mongodb.log log needs rotatingrotating log /mongoData/mongodb_log/mongodb.log, log-&gt;rotateCount is 30dateext suffix &apos;-20160630&apos;glob pattern &apos;-[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]&apos;glob finding old rotated logs failedcopying /mongoData/mongodb_log/mongodb.log to /mongoData/mongodb_log/mongodb.log-20160630set default create contexttruncating /mongoData/mongodb_log/mongodb.logrunning postrotate scriptcompressing log with: /bin/gzip[root@localhost mongodb_log]# lltotal 69604-rw-r--r--. 1 root root 37092 Jun 30 13:24 mongodb.log-rw-r--r--. 1 root root 1047190 Jun 30 13:24 mongodb.log-20160630.gz ç‰¹åˆ«æŒ‡å‡ºç”±äºæˆ‘ä»¬çš„æœåŠ¡æœŸå¼€å¯äº†SELinuxï¼Œå¹¶ä¸”æ˜¯Enforcingæ¨¡å¼ä¸‹ï¼Œä¼šé€ æˆé/var/log/ç›®å½•ä¸‹çš„logrotateæ“ä½œå¤±è´¥ï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š[root@localhost ~]# semanage fcontext -a -t var_log_t &apos;/mongoData/mongodb_log/mongodb.log&apos;[root@localhost ~]# restorecon -Frvv /mongoData/mongodb_log/mongodb.log ä¸Šé¢çš„ç¬¬ä¸€æ¡å‘½ä»¤ç”¨æ¥å®šä¹‰mongodb.logè¿™ä¸ªæ–‡ä»¶çš„ä¸Šä¸‹æ–‡ï¼Œè®°å½•ä¼šè¢«æŒä¹…åŒ–åˆ°/etc/selinux/targeted/contexts/files/file_contexts.localé‡Œï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹ã€‚[root@localhost ~]# cat /etc/selinux/targeted/contexts/files/file_contexts.local# This file is auto-generated by libsemanage# Do not edit directly./mongoData/mongodb_log/mongodb.log system_u:object_r:var_log_t:s0 ä¸Šé¢çš„ç¬¬äºŒæ¡å‘½ä»¤ï¼Œå¯ä»¥é€’å½’çš„è®¾ç½®ä¸Šä¸‹æ–‡ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œåˆ™ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•åŠæ–‡ä»¶éƒ½ä¼šè¢«é€’å½’çš„ç»Ÿä¸€è®¾ç½®ã€‚ å…³äºè¿™ä¸ªé—®é¢˜çš„è¯´æ˜ï¼Œå¯ä»¥ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹æ›´å¤šè¯´æ˜å’Œè§£é‡Šã€‚ ç»“è¯­è‡³æ­¤ï¼Œæˆ‘ä»¬è¾¹å®Œæˆäº†ä½¿ç”¨Logrotateæ¥ç®¡ç†MongoDBæ—¥å¿—äº†ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒLogrotateååˆ†å¼ºå¤§ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡man logrotateæŸ¥çœ‹ä¸€ä¸‹å…·ä½“å‚æ•°ï¼ŒçŸ¥å…¶ç„¶å¹¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œè®©å…¶æ›´å¥½åœ°ä¸ºæˆ‘ä»¬æ‰€ç”¨ã€‚","tags":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://elbarco.cn/tags/MongoDB/"},{"name":"Logrotate","slug":"Logrotate","permalink":"http://elbarco.cn/tags/Logrotate/"}]},{"title":"MongoDBå¤åˆ¶é›†SecondaryèŠ‚ç‚¹æŒç»­RecoveringçŠ¶æ€è§£å†³åŠæ³•","date":"2016-04-26T21:51:27.000Z","path":"2016/04/27/MongoDBå¤åˆ¶é›†SecondaryèŠ‚ç‚¹æŒç»­RecoveringçŠ¶æ€è§£å†³åŠæ³•/","text":"å‰æ®µæ—¶é—´å‘ç°MongoDB Replica Setä¸­çš„æŸä¸ªSecondaryèŠ‚ç‚¹ä¸€ç›´æŒç»­RecoveringçŠ¶æ€ï¼Œæ— æ³•æ¢å¤ï¼Œä¸”ä¸Šæ¬¡æ“ä½œæ—¶é—´ï¼ˆoptimeDateï¼‰å·²ç»æ˜¯Nå¤©å‰äº†ï¼Œç»è¿‡æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¾—çŸ¥å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› åœ¨äºå¤åˆ¶é›†ä¸­ä¸»èŠ‚ç‚¹ï¼ˆPrimaryï¼‰ä¸€ç›´å†™å…¥oplogï¼Œè€Œä»èŠ‚ç‚¹ï¼ˆSecondaryï¼‰çš„å¤åˆ¶è¿‡ç¨‹è¿œè¿œè½åï¼Œèµ¶ä¸ä¸Šä¸»èŠ‚ç‚¹çš„oplogå†™å…¥ï¼Œå°±åƒèµŒæ°”çš„å­©å­è·‘æ­¥ä¸€æ ·ï¼Œèµ¶ä¸ä¸Šå‰é¢çš„å°ä¼™ä¼´ï¼Œç´¢æ€§ä¸€èµŒæ°”å°±ä¸èµ°äº†â€¦â€¦å½“é‡åˆ°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæ˜¯ä¸å¯èƒ½æŒ‡æœ›ä»èŠ‚ç‚¹è‡ªå·±æ¢å¤çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é‡æ–°åŒæ­¥ï¼ˆinitial syncï¼‰ã€‚ å®˜æ–¹ç»™å‡ºäº†ä¸¤ç§æ‰§è¡Œé‡æ–°åŒæ­¥çš„æ–¹å¼â€”â€” å®Œå…¨æ¸…ç©ºæ•°æ®ç›®å½•ç„¶åé‡å¯mongodæœåŠ¡ åœ¨å…¶ä»–æˆå‘˜çš„æ•°æ®ç›®å½•ä¸‹æ‹·è´æœ€è¿‘çš„æ•°æ®ç„¶åé‡å¯mongodæœåŠ¡ è¿™é‡Œï¼Œå·æ‡’ä¸æƒ³æ‰“åŒ…scpæ•°æ®ï¼Œç´¢æ€§é‡‡ç”¨äº†ç¬¬ä¸€ç§æ–¹å¼ï¼š åœæ­¢mongodæœåŠ¡ï¼šå¯åœ¨mongo shellä¸­æ‰§è¡Œdb.shutdownServer()æ¥å…³é—­mongodæœåŠ¡ï¼Œä¹Ÿå¯ä»¥åœ¨shellä¸­ç›´æ¥æ•²mongod --shutdownï¼Œæˆ–è€…ç®€å•ç²—æš´ç›´æ¥kill -2 &lt;PID&gt;ï¼ˆè¿™é‡Œä¸æ¨è-9ï¼Œä¼šé€ æˆä¸‹æ¬¡å¯åŠ¨ä¸èµ·æ¥çš„æƒ…å†µï¼Œéœ€è¦åˆ é™¤dbPathç›®å½•ä¸‹çš„mongo.lockå†å°è¯•é‡æ–°å¯åŠ¨ï¼‰ã€‚ å¯¹æ—§çš„dbPathçš„ç›®å½•é‡å‘½åï¼Œä»¥åšå¤‡ä»½ å¯åŠ¨mongodï¼ŒæŒ‡å‘æ–°çš„ç©ºçš„dbPathç›®å½• ç®€å•ä¸‰æ­¥ï¼ŒMongoDBå°±ä¼šé‡æ–°è¿›è¡Œåˆå§‹åŒ–åŒæ­¥ï¼Œå—é™äºæ•°æ®é‡å’Œç½‘ç»œç¯å¢ƒç­‰å› ç´ çš„å½±å“ï¼Œé‡æ–°åŒæ­¥æ—¶é—´æœ‰é•¿æœ‰çŸ­ã€‚é‡æ–°åŒæ­¥å®Œæ¯•åï¼Œæ‰“å¼€mongo shellæŸ¥çœ‹å¤åˆ¶é›†çŠ¶æ€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªä»èŠ‚ç‚¹çŠ¶æ€å°±ä¼šæ¢å¤æ­£å¸¸äº†ã€‚ç„¶åè¦åšçš„å°±æ˜¯éªŒè¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§ï¼Œç¡®ä¿æ²¡é—®é¢˜ä¹‹åï¼Œé‡å‘½åè¿‡çš„dbPathç›®å½•å¯ä»¥åˆ é™¤äº†ã€‚ ç¬¬äºŒç§æ–¹å¼ï¼Œåˆ©ç”¨å…¶å®ƒæˆå‘˜çš„æœ€è¿‘æ•°æ®è¿›è¡Œå¯åŠ¨çš„æ“ä½œå¯è§å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚","tags":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://elbarco.cn/tags/MongoDB/"}]},{"title":"ä¸ºCentOS6.5å®‰è£…Kernel3.10","date":"2016-03-12T01:08:34.000Z","path":"2016/03/12/ä¸ºCentOS6-5å®‰è£…Kernel3-10/","text":"æœ€è¿‘æœ‰æƒ³å­¦ä¹ ä¸‹Dockerï¼Œåœ¨Linuxä¸‹å®‰è£…Dockerå¯¹å†…æ ¸çš„è¦æ±‚è‡³å°‘æ˜¯3.10ä»¥ä¸Šï¼Œç„¶è€ŒCentOS 6.5å†…æ ¸ç‰ˆæœ¬æ˜¯2.6ï¼Œæ‰€ä»¥é¦–å…ˆè¦åšçš„å°±æ˜¯ä¸ºCentOS 6.5å®‰è£…3.10çš„Kernelã€‚ æˆ‘ä»¬å¹¶ä¸éœ€è¦è‡ªå·±ç¼–è¯‘å®‰è£…ï¼Œè€Œæ˜¯æœ‰å°ä¼™ä¼´åœ¨åœ¨ELRepoä¸Šä¸ºæˆ‘ä»¬å‡†å¤‡å¥½äº†ä¸€ä¸ªpackageï¼Œæˆ‘ä»¬åªå…³å¿ƒå¦‚ä½•å®‰è£…å°±å¥½äº†ã€‚ å¯ç”¨ELReporpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org rpm -Uvh http://www.elrepo.org/elrepo-release-6-6.el6.elrepo.noarch.rpm å®‰è£…Kernelyum --enablerepo=elrepo-kernel install kernel-lt é…ç½®grubéœ€è¦ç¼–è¾‘/etc/grub.confæ¥æ›´æ”¹kernelé¡ºåºï¼Œå°†é»˜è®¤çš„1æ”¹ä¸º0.æ‰€ä»¥çœ‹èµ·æ¥åº”è¯¥æ˜¯é…±å©¶å„¿çš„ï¼š default=0timeout=5splashimage=(hd0,0)/boot/grub/splash.xpm.gzhiddenmenutitle CentOS (3.10.99-1.el6.elrepo.x86_64) root (hd0,0) kernel /boot/vmlinuz-3.10.99-1.el6.elrepo.x86_64 ro root=UUID=94e4e384-0ace-437f-bc96-057dd64f42ee rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet initrd /boot/initramfs-3.10.99-1.el6.elrepo.x86_64.imgtitle CentOS (2.6.32-573.12.1.el6.x86_64) root (hd0,0) kernel /boot/vmlinuz-2.6.32-573.12.1.el6.x86_64 ro root=UUID=94e4e384-0ace-437f-bc96-057dd64f42ee rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet initrd /boot/initramfs-2.6.32-573.12.1.el6.x86_64.img... é‡å¯å¹¶æŸ¥çœ‹reboot é‡å¯åé€šè¿‡uname -aæ¥æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬[root@iZ2853cmjatZ ~]# uname -aLinux iZ2853cmjatZ 3.10.99-1.el6.elrepo.x86_64 #1 SMP Fri Mar 4 11:53:07 EST 2016 x86_64 x86_64 x86_64 GNU/Linux å¤§åŠŸå‘Šæˆï¼","tags":[{"name":"Linux","slug":"Linux","permalink":"http://elbarco.cn/tags/Linux/"},{"name":"CentOS6.5","slug":"CentOS6-5","permalink":"http://elbarco.cn/tags/CentOS6-5/"}]},{"title":"åŸºäºRedisçš„Tomcaté›†ç¾¤Sessionå…±äº«","date":"2016-03-10T08:18:06.000Z","path":"2016/03/10/åŸºäºRedisçš„Tomcaté›†ç¾¤Sessionå…±äº«/","text":"ç›®å‰çš„webåº”ç”¨é›†ç¾¤ï¼Œä½¿ç”¨Nginxåšè´Ÿè½½å‡è¡¡ï¼Œå°†upstreamé…ç½®æˆip_hashçš„æ–¹å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼ŒNginxä¼šæ ¹æ®æ¥æºIPå’Œåç«¯é…ç½®æ¥åšhashåˆ†é…ï¼Œç¡®ä¿å›ºå®šIPåªè®¿é—®ä¸€ä¸ªåç«¯ã€‚ upstream YOUR_NAME &#123; ip_hash; server 192.168.8.15:8080; server 192.168.8.17:8080;&#125; ä½†æ˜¯ï¼Œç”±äºå›ºå®šæŸä¸ªIPåªèƒ½è®¿é—®å•ç‹¬çš„ä¸€ä¸ªåç«¯ï¼Œå¦‚æœå®•æœºæˆ–è€…éœ€è¦å‡çº§ç¨‹åºæ—¶åšåœæœºé‡å¯ï¼Œæ­£åœ¨æ“ä½œçš„ç”¨æˆ·å°±ä¼šé€€å‡ºåˆ°ç™»å½•é¡µé¢ï¼Œä¸ä»…ç”¨æˆ·ä½“éªŒå¾ˆå·®ï¼Œè€Œä¸”æ­£åœ¨åšçš„æ“ä½œä¸èƒ½ä¿è¯æˆåŠŸï¼Œå®¹æ˜“äº§ç”Ÿè„æ•°æ®ç­‰ã€‚ ä»Nginx upstreamé…ç½®è¯´èµ·é¦–å…ˆï¼Œæ¥çœ‹ä¸€ä¸‹Nginx upstreamçš„å‡ ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š 1ï¼‰è½®è¯¢upstream YOUR_NAME &#123; server 192.168.8.15:8080; server 192.168.8.17:8080;&#125; 2ï¼‰æƒé‡ï¼šè¯¥ç­–ç•¥å¯è§£å†³æœåŠ¡å™¨æ€§èƒ½ä¸ç­‰çš„æƒ…å†µä¸‹è½®è¯¢æ¯”ç‡çš„è°ƒé…upstream YOUR_NAME &#123; server 192.168.8.15:8080 weight=2; server 192.168.8.17:8080 weight=3;&#125; 3ï¼‰ip_hashupstream YOUR_NAME &#123; ip_hash; server 192.168.8.15:8080; server 192.168.8.17:8080;&#125; 4ï¼‰fairï¼šéœ€è¦å®‰è£…Upstream Fair Balancer Moduleã€‚è¯¥ç­–ç•¥æ ¹æ®åç«¯æœåŠ¡çš„å“åº”æ—¶é—´æ¥åˆ†é…ï¼Œå“åº”æ—¶é—´çŸ­çš„åç«¯ä¼˜å…ˆåˆ†é…upstream YOUR_NAME &#123; server 192.168.8.15:8080; server 192.168.8.17:8080; fair;&#125; 5ï¼‰ä¸€è‡´æ€§Hashï¼šéœ€è¦å®‰è£…Upstream Consistent Hash Moduleï¼Œè¯¥ç­–ç•¥å¯ä»¥æ ¹æ®ç»™å®šçš„å­—ç¬¦ä¸²è¿›è¡ŒHashåˆ†é…ï¼Œå…·ä½“å‚è§å®˜æ–¹Wikiã€‚ ç”±æ­¤å¯è§ï¼Œæˆ‘ä»¬è¿«åˆ‡çš„éœ€è¦ä½¿ç”¨è½®è®­çš„æ–¹å¼æ¥åšè´Ÿè½½å‡è¡¡ï¼Œé‚£å¯¹äºå¤§è§„æ¨¡é›†ç¾¤éƒ¨ç½²çš„webåº”ç”¨æ¥è®²ï¼Œè½®è®­çš„æ–¹å¼å°±è¦Sessionå¿…é¡»è¿›è¡Œå…±äº«ã€‚ Sessionå…±äº«æœºåˆ¶åœ¨é›†ç¾¤ç³»ç»Ÿä¸‹å®ç°Sessionå…±äº«æœºåˆ¶ä¸€èˆ¬æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹æ¡ˆï¼š åº”ç”¨æœåŠ¡å™¨é—´çš„Sessionå¤åˆ¶å…±äº«ï¼ˆå¦‚Tomcatè‡ªå¸¦çš„Sessionå…±äº«ï¼‰ åŸºäºç¼“å­˜æ•°æ®åº“çš„Sessionå…±äº«ï¼ˆå¦‚ä½¿ç”¨Memcachedã€Redisï¼‰ åº”ç”¨æœåŠ¡å™¨é—´çš„Sessionå¤åˆ¶å…±äº«Sessionå¤åˆ¶å…±äº«ï¼Œä¸»è¦æ˜¯æŒ‡é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œå¤šå°åº”ç”¨æœåŠ¡å™¨ä¹‹é—´åŒæ­¥Sessionï¼Œä½¿å…¶ä¿æŒä¸€è‡´ï¼Œå¯¹å¤–é€æ˜ã€‚å¦‚æœå…¶ä¸­ä¸€å°æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡çš„åŸç†ï¼ŒWebæœåŠ¡å™¨ï¼ˆApache/Nginxï¼‰ä¼šéå†å¯»æ‰¾å¯ç”¨èŠ‚ç‚¹ï¼Œåˆ†å‘è¯·æ±‚ï¼Œç”±äºSessionå·²åŒæ­¥ï¼Œæ•…èƒ½ä¿è¯ç”¨æˆ·çš„Sessionä¿¡æ¯ä¸ä¼šä¸¢å¤±ã€‚ æ­¤æ–¹æ¡ˆçš„ä¸è¶³ä¹‹å¤„ï¼š æŠ€æœ¯å¤æ‚,å¿…é¡»åœ¨åŒä¸€ç§ä¸­é—´ä»¶ä¹‹é—´å®Œæˆ(å¦‚Tomcat-Tomcatä¹‹é—´). Sessionå¤åˆ¶å¸¦æ¥çš„æ€§èƒ½æŸå¤±ä¼šå¿«é€Ÿå¢åŠ .ç‰¹åˆ«æ˜¯å½“Sessionä¸­ä¿å­˜äº†è¾ƒå¤§çš„å¯¹è±¡,è€Œä¸”å¯¹è±¡å˜åŒ–è¾ƒå¿«æ—¶, æ€§èƒ½ä¸‹é™æ›´åŠ æ˜¾è‘—. è¿™ç§ç‰¹æ€§ä½¿å¾—Webåº”ç”¨çš„æ°´å¹³æ‰©å±•å—åˆ°äº†é™åˆ¶ã€‚ Sessionå†…å®¹åºåˆ—åŒ–ï¼ˆSerializeï¼‰ï¼Œä¼šæ¶ˆè€—ç³»ç»Ÿæ€§èƒ½ã€‚ Sessionå†…å®¹é€šè¿‡å¹¿æ’­åŒæ­¥ç»™æˆå‘˜ï¼Œä¼šé€ æˆç½‘ç»œæµé‡ç“¶é¢ˆï¼Œå³ä¾¿æ˜¯å†…ç½‘ç“¶é¢ˆã€‚ åŸºäºç¼“å­˜æ•°æ®åº“çš„Sessionå…±äº«åŸºäºç¼“å­˜æ•°æ®åº“çš„Sessionå…±äº«æ˜¯æŒ‡ä½¿ç”¨å¦‚Memcachedã€Redisç­‰Cache DBæ¥å­˜å–Sessionä¿¡æ¯ï¼šåº”ç”¨æœåŠ¡å™¨æ¥å—æ–°è¯·æ±‚å°†Sessionä¿¡æ¯ä¿å­˜åˆ°Cache DBä¸­ï¼Œå½“åº”ç”¨æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼ŒWebæœåŠ¡å™¨ï¼ˆApache/Nginxï¼‰ä¼šéå†å¯»æ‰¾å¯ç”¨èŠ‚ç‚¹ï¼Œåˆ†å‘è¯·æ±‚ï¼Œå½“åº”ç”¨æœåŠ¡å™¨å‘ç°Sessionä¸åœ¨æœ¬æœºå†…å­˜ï¼Œåˆ™ä¼šå»Cache DBä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™å¤åˆ¶åˆ°æœ¬æœºï¼Œè¿™æ ·å°±å®ç°äº†Sessionçš„å…±äº«å’Œé«˜å¯ç”¨ã€‚ æˆ‘é€‰ç”¨çš„æ˜¯Redisè€Œä¸æ˜¯Memcachedï¼Œæ˜¯å› ä¸ºRediså…·æœ‰æ›´ä¸°å¯Œçš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å¯ä»¥ä¸ºKeyæŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œä»è€Œä¸éœ€è¦æˆ‘ä»¬å®šæœŸçš„åˆ·æ–°ç¼“å­˜ã€‚è€ŒMemcachedåšä¸åˆ°ï¼Œæ‰€æœ‰å°±æœ‰äº†è¿™æ ·ä¸€ä¸ªåˆç†çš„æ–¹æ¡ˆâ€”â€” åœ¨GitHubæœ‰è¿™æ ·ä¸€ä¸ªå¼€æºå·¥å…·tomcat-redis-session-managerï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°åŸºäºRedisçš„Sessionå…±äº«ï¼Œç„¶è€Œç›´æ¥æ‹¿æ¥ç”¨çš„è¯ï¼ŒSessionçš„keyç›´æ¥å°±æ˜¯SessionIDï¼Œæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å‰ç¼€ï¼Œæ‰€ä»¥ç»è¿‡ä¸€äº›å°æ”¹é€ ï¼Œä»£ç å·²æ‰˜ç®¡åˆ°è¿™é‡Œï¼Œå¯ä»¥é€šè¿‡Tomcat/conf/server.xmlçš„æœ€ä¸‹é¢çš„ä¸­å¢åŠ sessionCookieNameé…ç½®ä½ æƒ³è¦çš„Redisä¸­keyçš„å‰ç¼€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š &lt;Context docBase=\"/root/YOUR_WEB_APP\" path=\"\" reloadable=\"true\" sessionCookieName=\"YOURJSessionID\" /&gt; é—²è¯å°‘è¯´ï¼Œä¸‹é¢å¼€å§‹è®²è§£å¦‚ä½•ä½¿ç”¨ï¼š1ï¼‰ä¸‹è½½æºç ç¼–è¯‘æˆJaråŒ…ï¼Œè®² tomcat-redis-session-manager-1.2.jar ã€jedis-2.6.1.jarã€commons-pool2-2.2.jaræ‹·è´åˆ°Tomcatç›®å½•ä¸‹çš„libä¸­ï¼ˆJedisã€commons-pool2ç‰ˆæœ¬ä»»æ„ï¼‰2ï¼‰åœ¨Tomcatçš„confç›®å½•ä¸‹ï¼Œç¼–è¾‘context.xmlã€‚å¦‚æœä½ æ˜¯ç”¨Rediså•ç‚¹ï¼Œåˆ™å¯ä»¥ä»¿ç…§å¦‚ä¸‹é…ç½®ï¼š&lt;Valve className=\"com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve\" /&gt;&lt;Manager className=\"com.orangefunction.tomcat.redissessions.RedisSessionManager\" host=\"192.168.8.38\" port=\"6379\" database=\"1\" maxInactiveInterval=\"60\" /&gt; å¦‚æœæ˜¯Redisé›†ç¾¤ç¯å¢ƒï¼Œåˆ™å¯ä»¿ç…§å¦‚ä¸‹é…ç½®ï¼š&lt;Valve className=\"com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve\" /&gt;&lt;Manager className=\"com.orangefunction.tomcat.redissessions.RedisSessionManager\" database=\"1\" maxInactiveInterval=\"60\" sentinelMaster=\"mymaster\" sentinels=\"192.168.8.43:26379,192.168.8.45:26379,192.168.8.47:26379\"/&gt; å‚æ•°å‡å¯é€‰ï¼Œè¯¦è§ä¸Šé¢tomcat-redis-session-managerGithubä¸­çš„è¯´æ˜ã€‚ å…³äºmaxInactiveIntervalï¼Œå³å¤±æ•ˆæ—¶é—´ï¼Œè¿™é‡Œåšä¸€äº›è¯´æ˜ï¼š å³ä½¿åœ¨è¿™é‡Œé…ç½®çš„maxInactiveIntervalæ˜¯60sï¼Œå¦‚æœweb.xmlé…ç½®äº†sessionçš„å¤±æ•ˆæ—¶é—´ï¼Œåˆ™ä»¥web.xmlä¸ºå‡†ã€‚å¦ï¼Œå¦‚æœæœ‰ä¸€ä¸‹ä¸‰å¤„é…ç½®äº†Sessionçš„å¤±æ•ˆæ—¶é—´ï¼Œåˆ™ä¸‹é¢çš„é…ç½®è¦†ç›–ä¸Šé¢çš„é…ç½®: TOMCAT_HOME/conf/web.xml WebApplication/webapp/WEB-INF/web.xml å†™åœ¨ä»£ç ä¸­çš„å€¼ : HttpSession.setMaxInactiveInterval(int) å³å®é™…ç”Ÿæ•ˆé¡ºåºæ˜¯:HttpSession.setMaxInactiveInterval(int) &gt; $WebApplication/webapp/WEB-INF/web.xml &gt; $TOMCAT_HOME/conf/web.xml å¯åŠ¨Tomcatï¼Œè®¿é—®åº”ç”¨ï¼Œå³å¯åœ¨Redisä¸­çœ‹åˆ°æ•ˆæœã€‚ å…³äºæµ‹è¯•ï¼Œå¯ä»¥å°†Nginx Upstreamé…ç½®ä¸ºè½®è¯¢åï¼Œä»…ç•™ä¸€å°åº”ç”¨æœåŠ¡å™¨å¯åŠ¨ï¼Œç™»é™†æ“ä½œï¼Œç„¶åå¯åŠ¨å¦å¤–ä¸€å°ï¼Œåœæ­¢ç¬¬ä¸€å°æœåŠ¡ï¼Œç»§ç»­æ“ä½œï¼Œå‘ç°å¹¶æœªå—ä»»ä½•å½±å“ï¼Œå³å¯ã€‚ å‚è€ƒnginx upstreamçš„å‡ ç§é…ç½®æ–¹å¼ï¼šhttp://alwaysyunwei.blog.51cto.com/3224143/1239182Load Balancing via Nginx Upstream :http://nginx.org/en/docs/http/load_balancing.htmlTomcat7åŸºäºRedisçš„Sessionå…±äº«ï¼šhttps://yq.aliyun.com/articles/1298Tomcat Session Timeout Web.xml: http://stackoverflow.com/questions/13463036/tomcat-session-timeout-web-xml","tags":[{"name":"Reids","slug":"Reids","permalink":"http://elbarco.cn/tags/Reids/"},{"name":"Tomcat","slug":"Tomcat","permalink":"http://elbarco.cn/tags/Tomcat/"}]},{"title":"å¦‚ä½•åœ¨CentOS7ä¸Šå®‰è£…å’Œé…ç½®VNCServer","date":"2016-03-09T09:22:56.000Z","path":"2016/03/09/å¦‚ä½•åœ¨CentOS7ä¸Šå®‰è£…å’Œé…ç½®VNCServer/","text":"åŸæ–‡åœ°å€ï¼šä¼ é€é—¨è½¬è½½è‡ªï¼šLinux.cn è¿™æ˜¯ä¸€ä¸ªå…³äºæ€æ ·åœ¨ä½ çš„ CentOS 7 ä¸Šå®‰è£…é…ç½® VNC æœåŠ¡çš„æ•™ç¨‹ã€‚å½“ç„¶è¿™ä¸ªæ•™ç¨‹ä¹Ÿé€‚åˆ RHEL 7 ã€‚åœ¨è¿™ä¸ªæ•™ç¨‹é‡Œï¼Œæˆ‘ä»¬å°†å­¦ä¹ ä»€ä¹ˆæ˜¯ VNC ä»¥åŠæ€æ ·åœ¨ CentOS 7 ä¸Šå®‰è£…é…ç½® VNC æœåŠ¡å™¨ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œä½œä¸ºä¸€ä¸ªç³»ç»Ÿç®¡ç†å‘˜ï¼Œå¤§å¤šæ•°æ—¶é—´æ˜¯é€šè¿‡ç½‘ç»œç®¡ç†æœåŠ¡å™¨çš„ã€‚åœ¨ç®¡ç†æœåŠ¡å™¨çš„è¿‡ç¨‹ä¸­å¾ˆå°‘ä¼šç”¨åˆ°å›¾å½¢ç•Œé¢ï¼Œå¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬åªæ˜¯ç”¨ SSH æ¥å®Œæˆæˆ‘ä»¬çš„ç®¡ç†ä»»åŠ¡ã€‚åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬å°†é…ç½® VNC æ¥æä¾›ä¸€ä¸ªè¿æ¥æˆ‘ä»¬ CentOS 7 æœåŠ¡å™¨çš„æ–¹æ³•ã€‚VNC å…è®¸æˆ‘ä»¬å¼€å¯ä¸€ä¸ªè¿œç¨‹å›¾å½¢ä¼šè¯æ¥è¿æ¥æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç½‘ç»œè¿œç¨‹è®¿é—®æœåŠ¡å™¨çš„å›¾å½¢ç•Œé¢äº†ã€‚ VNC æœåŠ¡å™¨æ˜¯ä¸€ä¸ªè‡ªç”±å¼€æºè½¯ä»¶ï¼Œå®ƒå¯ä»¥è®©ç”¨æˆ·å¯ä»¥è¿œç¨‹è®¿é—®æœåŠ¡å™¨çš„æ¡Œé¢ç¯å¢ƒã€‚å¦å¤–è¿æ¥ VNC æœåŠ¡å™¨éœ€è¦ä½¿ç”¨ VNC viewer è¿™ä¸ªå®¢æˆ·ç«¯ã€‚ ä¸€äº› VNC æœåŠ¡å™¨çš„ä¼˜ç‚¹ï¼š è¿œç¨‹çš„å›¾å½¢ç®¡ç†æ–¹å¼è®©å·¥ä½œå˜å¾—ç®€å•æ–¹ä¾¿ã€‚ å‰ªè´´æ¿å¯ä»¥åœ¨ CentOS æœåŠ¡å™¨ä¸»æœºå’Œ VNC å®¢æˆ·ç«¯æœºå™¨ä¹‹é—´å…±äº«ã€‚ CentOS æœåŠ¡å™¨ä¸Šä¹Ÿå¯ä»¥å®‰è£…å›¾å½¢å·¥å…·ï¼Œè®©ç®¡ç†èƒ½åŠ›å˜å¾—æ›´å¼ºå¤§ã€‚ åªè¦å®‰è£…äº† VNC å®¢æˆ·ç«¯ï¼Œé€šè¿‡ä»»ä½•æ“ä½œç³»ç»Ÿéƒ½å¯ä»¥ç®¡ç† CentOS æœåŠ¡å™¨äº†ã€‚ æ¯” ssh å›¾å½¢è½¬å‘å’Œ RDP è¿æ¥æ›´å¯é ã€‚ é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹å®‰è£… VNC æœåŠ¡å™¨ä¹‹æ—…å§ã€‚æˆ‘ä»¬éœ€è¦æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤ä¸€æ­¥ä¸€æ­¥æ¥æ­å»ºä¸€ä¸ªå¯ç”¨çš„ VNCã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ç”¨çš„æ¡Œé¢ç¯å¢ƒï¼ˆX-Windowï¼‰ï¼Œå¦‚æœæ²¡æœ‰çš„è¯è¦å…ˆå®‰è£…ä¸€ä¸ªã€‚ æ³¨æ„ï¼šä»¥ä¸‹å‘½ä»¤å¿…é¡»ä»¥ root æƒé™è¿è¡Œã€‚è¦åˆ‡æ¢åˆ° root ï¼Œè¯·åœ¨ç»ˆç«¯ä¸‹è¿è¡Œâ€œsudo -sâ€ï¼Œå½“ç„¶ä¸åŒ…æ‹¬åŒå¼•å·ï¼ˆâ€œâ€ï¼‰ è¿™é‡Œæˆ‘æ“ä½œæ—¶ï¼Œè¿ç»´ç»™å‡†å¤‡äº†ä¸€å°CentOS 7çš„ç¯å¢ƒå·²ç»å®‰è£…äº†æ¡Œé¢ã€‚æ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ç›´æ¥è·³è¿‡ï¼Œè€Œæ˜¯SSHåˆ°æœåŠ¡å™¨ï¼Œç›´æ¥è¿›è¡ŒVNCçš„å®‰è£…ï¼Œä¸è¿‡è¿˜æ˜¯ä¿ç•™åŸæ–‡çš„å…¨éƒ¨æ­¥éª¤å§ã€‚ å®‰è£… X-Windowé¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£… X-Windowï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå®‰è£…ä¼šèŠ±è´¹ä¸€ç‚¹æ—¶é—´ã€‚ # yum check-update# yum groupinstall &quot;X Window System&quot; # yum install gnome-classic-session gnome-terminal nautilus-open-terminal control-center liberation-mono-fonts ### è®¾ç½®é»˜è®¤å¯åŠ¨å›¾å½¢ç•Œé¢# unlink /etc/systemd/system/default.target# ln -sf /lib/systemd/system/graphical.target /etc/systemd/system/default.target # reboot åœ¨æœåŠ¡å™¨é‡å¯ä¹‹åï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå·¥ä½œç€çš„ CentOS 7 æ¡Œé¢ç¯å¢ƒäº†ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… VNC æœåŠ¡å™¨äº†ã€‚ å®‰è£… VNC æœåŠ¡å™¨ç°åœ¨è¦åœ¨æˆ‘ä»¬çš„ CentOS 7 ä¸Šå®‰è£… VNC æœåŠ¡å™¨äº†ã€‚æˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚ # yum install tigervnc-server -y é…ç½® VNCç„¶åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ /etc/systemd/system/ ç›®å½•é‡Œåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥å°† /lib/systemd/sytem/vncserver@.service æ‹·è´ä¸€ä»½é…ç½®æ–‡ä»¶èŒƒä¾‹è¿‡æ¥ã€‚ # cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service æ¥ç€æˆ‘ä»¬ç”¨è‡ªå·±æœ€å–œæ¬¢çš„ç¼–è¾‘å™¨æ‰“å¼€ /etc/systemd/system/vncserver@:1.service ï¼Œæ‰¾åˆ°ä¸‹é¢è¿™å‡ è¡Œï¼Œç”¨è‡ªå·±çš„ç”¨æˆ·åæ›¿æ¢æ‰ ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘çš„ç”¨æˆ·åæ˜¯ linoxide æ‰€ä»¥æˆ‘ç”¨ linoxide æ¥æ›¿æ¢æ‰ ï¼š ExecStart=/sbin/runuser -l &lt;USER&gt; -c &quot;/usr/bin/vncserver %i&quot;PIDFile=/home/&lt;USER&gt;/.vnc/%H%i.pid æ›¿æ¢æˆ ExecStart=/sbin/runuser -l linoxide -c &quot;/usr/bin/vncserver %i&quot;PIDFile=/home/linoxide/.vnc/%H%i.pid å¦‚æœæ˜¯ root ç”¨æˆ·åˆ™ ExecStart=/sbin/runuser -l root -c &quot;/usr/bin/vncserver %i&quot;PIDFile=/root/.vnc/%H%i.pid å¥½äº†ï¼Œä¸‹é¢é‡å¯ systemd. # systemctl daemon-reload``` æœ€åè¿˜è¦è®¾ç½®ä¸€ä¸‹ç”¨æˆ·çš„ VNC å¯†ç ã€‚è¦è®¾ç½®æŸä¸ªç”¨æˆ·çš„å¯†ç ï¼Œå¿…é¡»è¦æœ‰èƒ½é€šè¿‡ sudo åˆ‡æ¢åˆ°ç”¨æˆ·çš„æƒé™ï¼Œè¿™é‡Œæˆ‘ç”¨ `linoxide` çš„æƒé™ï¼Œæ‰§è¡Œ`su linoxide`å°±å¯ä»¥äº†ã€‚```shell# su linoxide$ sudo vncpasswd ç¡®ä¿ä½ è¾“å…¥çš„å¯†ç å¤šäº6ä¸ªå­—ç¬¦ã€‚ å¼€å¯æœåŠ¡ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼ˆæ°¸ä¹…åœ°ï¼‰å¼€å¯æœåŠ¡ï¼š $ sudo systemctl enable vncserver@:1.service å¯åŠ¨æœåŠ¡ã€‚ $ sudo systemctl start vncserver@:1.service é˜²ç«å¢™è®¾ç½®æˆ‘ä»¬éœ€è¦é…ç½®é˜²ç«å¢™æ¥è®© VNC æœåŠ¡æ­£å¸¸å·¥ä½œã€‚ $ sudo firewall-cmd --permanent --add-service vnc-server$ sudo systemctl restart firewalld.service ç°åœ¨å°±å¯ä»¥ç”¨ IP å’Œç«¯å£å·ï¼ˆLCTT è¯‘æ³¨ï¼šä¾‹å¦‚ 192.168.1.1:1 ï¼Œè¿™é‡Œçš„ç«¯å£ä¸æ˜¯æœåŠ¡å™¨çš„ç«¯å£ï¼Œè€Œæ˜¯è§† VNC è¿æ¥æ•°çš„å¤šå°‘ä»1å¼€å§‹æ’åºï¼‰æ¥è¿æ¥ VNC æœåŠ¡å™¨äº†ã€‚ ç”¨ VNC å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨å¥½äº†ï¼Œç°åœ¨å·²ç»å®Œæˆäº† VNC æœåŠ¡å™¨çš„å®‰è£…äº†ã€‚è¦ä½¿ç”¨ VNC è¿æ¥æœåŠ¡å™¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šå®‰è£…çš„ä»…ä¾›è¿æ¥è¿œç¨‹è®¡ç®—æœºä½¿ç”¨çš„ VNC å®¢æˆ·ç«¯ã€‚ ä½ å¯ä»¥ç”¨åƒ Tightvnc viewer å’Œ Realvnc viewer çš„å®¢æˆ·ç«¯æ¥è¿æ¥åˆ°æœåŠ¡å™¨ã€‚ è¦ç”¨æ›´å¤šçš„ç”¨æˆ·è¿æ¥ï¼Œéœ€è¦åˆ›å»ºé…ç½®æ–‡ä»¶å’Œç«¯å£ï¼Œè¯·å›åˆ°ç¬¬3æ­¥ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„ç”¨æˆ·å’Œç«¯å£ã€‚ä½ éœ€è¦åˆ›å»º vncserver@:2.service å¹¶æ›¿æ¢é…ç½®æ–‡ä»¶é‡Œçš„ç”¨æˆ·åå’Œä¹‹åæ­¥éª¤é‡Œç›¸åº”çš„æ–‡ä»¶åã€ç«¯å£å·ã€‚è¯·ç¡®ä¿ä½ ç™»å½• VNC æœåŠ¡å™¨ç”¨çš„æ˜¯ä½ ä¹‹å‰é…ç½® VNC å¯†ç çš„æ—¶å€™ä½¿ç”¨çš„é‚£ä¸ªç”¨æˆ·åã€‚ VNC æœåŠ¡æœ¬èº«ä½¿ç”¨çš„æ˜¯5900ç«¯å£ã€‚é‰´äºæœ‰ä¸åŒçš„ç”¨æˆ·ä½¿ç”¨ VNC ï¼Œæ¯ä¸ªäººçš„è¿æ¥éƒ½ä¼šè·å¾—ä¸åŒçš„ç«¯å£ã€‚é…ç½®æ–‡ä»¶åé‡Œé¢çš„æ•°å­—å‘Šè¯‰ VNC æœåŠ¡å™¨æŠŠæœåŠ¡è¿è¡Œåœ¨5900çš„å­ç«¯å£ä¸Šã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œï¼Œç¬¬ä¸€ä¸ª VNC æœåŠ¡ä¼šè¿è¡Œåœ¨5901ï¼ˆ5900 + 1ï¼‰ç«¯å£ä¸Šï¼Œä¹‹åçš„ä¾æ¬¡å¢åŠ ï¼Œè¿è¡Œåœ¨5900 + x å·ç«¯å£ä¸Šã€‚å…¶ä¸­ x æ˜¯æŒ‡ä¹‹åç”¨æˆ·çš„é…ç½®æ–‡ä»¶å vncserver@:x.service é‡Œé¢çš„ x ã€‚ åœ¨å»ºç«‹è¿æ¥ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æœåŠ¡å™¨çš„ IP åœ°å€å’Œç«¯å£ã€‚IP åœ°å€æ˜¯ä¸€å°è®¡ç®—æœºåœ¨ç½‘ç»œä¸­çš„ç‹¬ç‰¹çš„è¯†åˆ«å·ç ã€‚æˆ‘çš„æœåŠ¡å™¨çš„ IP åœ°å€æ˜¯96.126.120.92ï¼ŒVNC ç”¨æˆ·ç«¯å£æ˜¯1ã€‚ æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¯ä»¥è·å¾—æœåŠ¡å™¨çš„å…¬ç½‘ IP åœ°å€ï¼ˆè¯‘æ³¨ï¼šå¦‚æœä½ çš„æœåŠ¡å™¨æ”¾åœ¨å†…ç½‘æˆ–ä½¿ç”¨åŠ¨æ€åœ°å€çš„è¯ï¼Œå¯ä»¥è¿™æ ·è·å¾—å…¶å…¬ç½‘ IP åœ°å€ï¼‰ã€‚ # curl -s checkip.dyndns.org|sed -e &apos;s/.*Current IP Address: //&apos; -e &apos;s/&lt;.*$//&apos; æ€»ç»“å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»åœ¨è¿è¡Œ CentOS 7 / RHEL 7 çš„æœåŠ¡å™¨ä¸Šå®‰è£…é…ç½®å¥½äº† VNC æœåŠ¡å™¨ã€‚VNC æ˜¯è‡ªç”±å¼€æºè½¯ä»¶ä¸­æœ€ç®€å•çš„ä¸€ç§èƒ½å®ç°è¿œç¨‹æ§åˆ¶æœåŠ¡å™¨çš„å·¥å…·ï¼Œä¹Ÿæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„ Teamviewer Remote Access æ›¿ä»£å“ã€‚VNC å…è®¸ä¸€ä¸ªå®‰è£…äº† VNC å®¢æˆ·ç«¯çš„ç”¨æˆ·è¿œç¨‹æ§åˆ¶ä¸€å°å®‰è£…äº† VNC æœåŠ¡çš„æœåŠ¡å™¨ã€‚ å…³é—­ VNC æœåŠ¡ã€‚ # systemctl stop vncserver@:1.service ç¦æ­¢ VNC æœåŠ¡å¼€æœºå¯åŠ¨ã€‚ # systemctl disable vncserver@:1.service å…³é—­é˜²ç«å¢™ã€‚ # systemctl stop firewalld.service","tags":[{"name":"Linux","slug":"Linux","permalink":"http://elbarco.cn/tags/Linux/"},{"name":"CentOS7","slug":"CentOS7","permalink":"http://elbarco.cn/tags/CentOS7/"}]},{"title":"ä¸€ä¸ªæˆåŠŸçš„Gitåˆ†æ”¯æ¨¡å‹","date":"2016-03-08T02:29:22.000Z","path":"2016/03/08/ä¸€ä¸ªæˆåŠŸçš„Gitåˆ†æ”¯æ¨¡å‹/","text":"å‰è¨€ä»å¤§å…¬å¸è·³åˆ°äº†å°å›¢é˜Ÿï¼Œç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ä»Gitæ¢åˆ°äº†SVNï¼Œç„¶è€Œå‰æ®µæ—¶é—´ï¼Œå¤´å„¿è®©æˆ‘ç ”ç©¶ä¸‹å¦‚ä½•æ­å»ºç§æœ‰GitæœåŠ¡å™¨ï¼Œå¦‚ä½•â€œä¼˜é›…â€åœ°ä½¿ç”¨Gitã€‚ é’ˆå¯¹å¦‚ä½•æ­å»ºç§æœ‰GitæœåŠ¡å™¨ï¼Œæˆ‘é€‰ç”¨çš„æ˜¯GitLabï¼Œæœ‰ä¸€é”®å®‰è£…åŒ…ï¼Œä¹Ÿæœ‰å¾ˆå¤šStep by Stepçš„æ•™ç¨‹ï¼Œå¯è‡ªè¡ŒGoogleã€‚æœ¬æ–‡å°±ä¸Šé¢æå‡ºçš„åä¸¤ä¸ªé—®é¢˜ï¼Œå‚è€ƒæ–‡ç« ã€ŠA successful Git branching modelã€‹è®²è¿°å¦‚ä½•åˆç†çš„ä½¿ç”¨Git branchè¿›è¡Œå¼€å‘å’Œç‰ˆæœ¬ç®¡ç†ã€‚ å…ˆæ¥å¼ å›¾ï¼š è¯¦ç»†å±•å¼€ä¸»è¦åˆ†æ”¯åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œä¸­å¤®ä»“åº“æŒæœ‰ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸæ— é™é•¿çš„ä¸»è¦åˆ†æ”¯ï¼š master develop æˆ‘ä»¬è®¤ä¸ºï¼Œorigin/masterè¿™ä¸ªä¸»è¦åˆ†æ”¯ä¸Šï¼Œæºç çš„HEADæ°¸è¿œä¿æŒç”Ÿäº§å°±ç»ªçš„çŠ¶æ€ã€‚origin/developè¿™ä¸ªä¸»è¦åˆ†æ”¯çš„æºç HEADåˆ™æ°¸è¿œä»£è¡¨äº†æœ€æ–°æäº¤çš„å¼€å‘å˜æ›´ï¼Œæ‰€ä»¥ä¹Ÿè¢«ç§°ä¸ºæ˜¯â€œé›†æˆåˆ†æ”¯â€ã€‚è¯¥åˆ†æ”¯å¯ä»¥ç”¨äºæ¯æ™šçš„è‡ªåŠ¨åŒ–æ„å»ºæ‰€ä½¿ç”¨ã€‚ å½“developåˆ†æ”¯çš„ä»£ç èƒ½å¤Ÿåˆ°è¾¾ä¸€ä¸ªç¨³å®šç‚¹ï¼Œå¹¶ä¸”å·²ç»å‡†å¤‡å¥½è¿›è¡Œç‰ˆæœ¬å‘å¸ƒï¼Œæ‰€ä»¥çš„å˜æ›´åº”å½“åˆå¹¶åˆ°masterä¸Šï¼Œå¹¶ä¸”ç”¨ç‰ˆæœ¬å·æ ‡æ³¨ã€‚å…·ä½“æ“ä½œåè¯¦ç»†è°ˆåˆ°ã€‚ å› æ­¤ï¼Œæ¯å½“å˜æ›´æœ€ç»ˆåˆå¹¶åˆ°masteråˆ†æ”¯ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ–°çš„ç”Ÿäº§ç‰ˆæœ¬ã€‚å¯¹å¾…è¿™ä¸ªåˆ†æ”¯ï¼Œè¦æå…¶ä¸¥æ ¼ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ¥è®²ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªGit hookè„šæœ¬æ¥è¿›è¡Œè‡ªåŠ¨åŒ–æ„å»ºï¼Œæ¯å½“æœ‰æ–°å†…å®¹æäº¤åˆ°masterï¼Œè„šæœ¬è‡ªåŠ¨å°†è½¯ä»¶å‘å¸ƒåˆ°æˆäº§ç¯å¢ƒã€‚ æ”¯æŒæ€§åˆ†æ”¯åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæœ‰å„ç±»æ”¯æŒæ€§åˆ†æ”¯æ¥ååŠ©å›¢é˜Ÿæˆå‘˜çš„å¹¶è¡Œå¼€å‘ï¼Œæ–¹ä¾¿è·Ÿè¸ªåŠŸèƒ½ç‰¹æ€§ï¼Œå‡†å¤‡ç”Ÿäº§ç‰ˆæœ¬å’Œå¿«é€Ÿä¿®å¤ç”Ÿäº§é—®é¢˜ã€‚ä¸ä¸»è¦åˆ†æ”¯ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸‰ä¸ªæ”¯æŒæ€§åˆ†æ”¯æ˜¯æœ‰æœ‰é™ç”Ÿå‘½å‘¨æœŸçš„ï¼Œæœ€ç»ˆä¼šè¢«ç§»é™¤ã€‚ è¿™é‡Œä½¿ç”¨çš„ä¸‰ç±»åˆ†æ”¯åˆ†åˆ«æ˜¯ï¼š åŠŸèƒ½ç‰¹æ€§åˆ†æ”¯ï¼ˆFeature branchesï¼‰ å‘å¸ƒç”¨åˆ†æ”¯ï¼ˆRelease branchesï¼‰ è¡¥ä¸åˆ†æ”¯ï¼ˆHotfix branchesï¼‰ è¿™ä¸‰ç±»åˆ†æ”¯ç›®çš„æ˜ç¡®ï¼Œæ‰€ä»¥å¯¹äºè¿™äº›åˆ†æ”¯çš„æºåˆ†æ”¯å’Œåˆå¹¶çš„ç›®æ ‡åˆ†æ”¯å…·æœ‰ååˆ†ä¸¥æ ¼çš„è§„åˆ™ã€‚å½“ç„¶ï¼Œè¿™ä¸‰ç±»åˆ†æ”¯ä¹Ÿä»…ä»…æ˜¯åˆ†æ”¯è€Œå·²ï¼Œå¹¶æ²¡æœ‰ç‰¹åˆ«çš„åœ°æ–¹ã€‚ åŠŸèƒ½ç‰¹æ€§åˆ†æ”¯ åˆ†æ”¯æ¥æºï¼šdevelopåˆå¹¶ç›®æ ‡ï¼šdevelopå‘½åæƒ¯ä¾‹ï¼šé™¤masterã€developã€release-*æˆ–è€…hotfix-*ä¹‹å¤–çš„ä»»ä½•åå­—å‡å¯ åŠŸèƒ½ç‰¹æ€§åˆ†æ”¯ï¼ˆæˆ–è€…æœ‰æ—¶è¢«ç§°ä½œä¸“é¢˜åˆ†æ”¯ï¼‰è¢«ç”¨äºå¼€å‘æ¥ä¸‹æ¥æˆ–è€…å°†æ¥ç‰ˆæœ¬çš„æ–°åŠŸèƒ½ã€æ–°ç‰¹æ€§ã€‚å½“å¼€å§‹å¼€å‘ä¸€é¡¹åŠŸèƒ½æ—¶ï¼Œç›®æ ‡å‘å¸ƒç”¨åˆ†æ”¯å¹¶æœªæ˜ç¡®ï¼Œä½†åªè¦åŠŸèƒ½åœ¨å¼€å‘ä¸­ï¼Œè¿™ä¸ªåˆ†æ”¯å°±å­˜åœ¨ï¼Œæœ€ç»ˆä¼šåˆå¹¶å›developï¼ˆæ„å‘³ç€å³å°†å‘å¸ƒçš„ç‰ˆæœ¬ä¸­ä¸€å®šä¼šåŒ…å«è¯¥åŠŸèƒ½ï¼‰æˆ–è€…è¢«åºŸå¼ƒï¼ˆè¿™å½“ç„¶æ˜¯ä¸€ç§ä»¤äººååˆ†å¤±æœ›çš„æƒ…å†µï¼‰ã€‚ åŠŸèƒ½ç‰¹æ€§åˆ†æ”¯ä»…å­˜åœ¨ä¸å¼€å‘çš„ä»£ç ä»“åº“ï¼Œå¹¶ä¸åœ¨originã€‚ åˆ›å»ºä¸€ä¸ªåŠŸèƒ½ç‰¹æ€§åˆ†æ”¯ å½“ç€æ‰‹å¼€å‘æ–°åŠŸèƒ½æ—¶ï¼Œå…ˆåœ¨å¼€å‘åˆ†æ”¯ä¸Šæ£€å‡ºæ–°åˆ†æ”¯ï¼š $ git checkout -b myfeature developSwitched to a new branch \"myfeature\" å°†å®Œæˆçš„åŠŸèƒ½åˆå¹¶åˆ°å¼€å‘åˆ†æ”¯ä¸Š å®Œæˆçš„åŠŸèƒ½ç‰¹æ€§è¢«åˆå¹¶åˆ°developåˆ†æ”¯ä¸Šï¼Œè¡¨ç¤ºè¯¥åŠŸèƒ½è¦æ·»åŠ åˆ°å³å°†å‘å¸ƒçš„ç‰ˆæœ¬ä¸­ï¼š $ git checkout developSwitched to branch 'develop'$ git merge --no-ff myfeatureUpdating ea1b82a..05e9557(Summary of changes)$ git branch -d myfeatureDeleted branch myfeature (was 05e9557).$ git push origin develop --no-ffè¡¨ç¤ºåˆå¹¶æ€»æ˜¯åˆ›å»ºæ–°çš„æäº¤å¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨åˆå¹¶åˆ†æ”¯æ—¶ä¸¢å¤±å†å²ä¿¡æ¯ï¼Œå¯¹æ¯”å›¾å¦‚ä¸‹ï¼š æ˜¾è€Œæ˜“è§ï¼Œè¿™å°±æ˜¯è¯æ®å•Šï¼Œè¯æ®ï¼:joy: å‘å¸ƒç”¨åˆ†æ”¯ åˆ†æ”¯æ¥æºï¼šdevelopåˆå¹¶ç›®æ ‡ï¼šdevelopå’Œmasterå‘½åæƒ¯ä¾‹ï¼šrelease-* å‘å¸ƒç”¨åˆ†æ”¯ç”¨äºæ”¯æŒç”Ÿäº§ç¯å¢ƒæ–°ç‰ˆæœ¬ï¼Œå¦‚ä¿®æ”¹å°‘æ•°çš„ç¼ºé™·ï¼Œå‡†å¤‡ç‰ˆæœ¬å‘å¸ƒçš„å…ƒæ•°æ®ï¼ˆå¦‚ç‰ˆæœ¬å·ï¼Œæ„å»ºæ—¥æœŸç­‰ï¼‰ã€‚åšå®Œè¿™äº›æ“ä½œä¹‹åï¼Œdevelopåˆ†æ”¯ä¾¿å¯ä»¥ä¸ºäº†ä¸‹ä¸ªå¤§ç‰ˆæœ¬æ¥å—è¿™äº›æ–°åŠŸèƒ½äº†ã€‚ å°†å‘å¸ƒç”¨åˆ†æ”¯ä»developåˆ†æ”¯ä¸Šæ£€å‡ºçš„å…³é”®æ—¶åˆ»æ˜¯åœ¨å¼€å‘å‡ ä¹å®Œå…¨å¯ä»¥åæ˜ æ–°åŠŸèƒ½ç†æƒ³çŠ¶æ€çš„æ—¶å€™ã€‚æ­¤æ—¶ï¼Œè‡³å°‘ä¸‹ä¸ªç‰ˆæœ¬è¦å‘å¸ƒçš„åŠŸèƒ½æ‰€åœ¨çš„åŠŸèƒ½åˆ†æ”¯è¦åˆå¹¶åˆ°developä¸Šï¼Œè€ŒåŠŸèƒ½å‘å¸ƒåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­åˆ™å¯ä»¥æš‚æ—¶ä¸åˆå¹¶ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡å‘å¸ƒç”¨åˆ†æ”¯çš„æ£€å‡ºã€‚ åœ¨å‘å¸ƒç”¨åˆ†æ”¯æ‹‰å‡ºæ—¶ï¼Œå°±éœ€è¦ç»™å…¶åˆ†é…ä¸€ä¸ªç‰ˆæœ¬å·ã€‚è€Œæ­¤åçš„developåˆ†æ”¯ä¸Šçš„å˜æ›´éƒ½å°†åæ˜ è¿™ä¸ªç‰ˆæœ¬ã€‚ åˆ›å»ºä¸€ä¸ªå‘å¸ƒç”¨åˆ†æ”¯ å‘å¸ƒç”¨åˆ†æ”¯åœ¨developåˆ†æ”¯ä¸Šæ£€å‡ºã€‚ä¸¾ä¾‹æ¥è®²ï¼Œç›®å‰æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬æ˜¯1.1.5ï¼Œé©¬ä¸Šå°±è¦å‘å¸ƒä¸€ä¸ªå¤§ç‰ˆæœ¬ã€‚developåˆ†æ”¯å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å†³å®šå°†ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„ç‰ˆæœ¬å·ä¸º1.2.æ‰€ä»¥æˆ‘ä»¬æ‹‰å‡ºä¸€ä¸ªå‘å¸ƒç”¨åˆ†æ”¯ï¼Œå‘½åéœ€è¦åæ˜ æ–°çš„ç‰ˆæœ¬å·ï¼š $ git checkout -b release-1.2 developSwitched to a new branch \"release-1.2\"$ ./bump-version.sh 1.2Files modified successfully, version bumped to 1.2.$ git commit -a -m \"Bumped version number to 1.2\"[release-1.2 74d9424] Bumped version number to 1.21 files changed, 1 insertions(+), 1 deletions(-) åˆ›å»ºå®Œæ–°åˆ†æ”¯ä¹‹åï¼Œå˜æ›´ç‰ˆæœ¬å·ï¼ˆè¿™é‡Œçš„bump-version.shè„šæœ¬ç”¨äºä¿®æ”¹æ–‡ä»¶ç‰ˆæœ¬å·ï¼Œå½“ç„¶ï¼Œé’ˆå¯¹ä¸åŒçš„åœºæ™¯ï¼Œä¹Ÿå¯æ‰‹åŠ¨å˜æ›´ç‰ˆæœ¬å·ï¼‰ã€‚ è¯¥åˆ†æ”¯ä¼šå­˜åœ¨ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…ï¼Œè¯¥åˆ†æ”¯å…è®¸ä¿®æ”¹ç¼ºé™·ï¼ˆè€Œä¸æ˜¯åœ¨developä¸Šé¢ï¼‰ã€‚åœ¨è¯¥åˆ†æ”¯ä¸Šç¦æ­¢æ·»åŠ æ–°ç‰¹æ€§ã€‚æœ€ç»ˆï¼Œè¯¥åˆ†æ”¯å¿…é¡»åˆå¹¶åˆ°developã€ å®Œæˆä¸€ä¸ªå‘å¸ƒç”¨åˆ†æ”¯ å½“å‘å¸ƒç”¨åˆ†æ”¯å·²ç»å‡†å¤‡å°±ç»ªå¯ä»¥å‘å¸ƒä¸€ä¸ªç°å®çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰å¾ˆå¤šå·¥ä½œè¦åšã€‚é¦–å…ˆï¼Œå°†å‘å¸ƒç”¨åˆ†æ”¯åˆå¹¶åˆ°masterï¼ˆåˆ‡è®°ï¼Œæ‰€ä»¥æäº¤åˆ°masterå†…å®¹ä¸€å®šæ˜¯ä¸€æ–°ç‰ˆæœ¬ï¼‰ã€‚æ¥ç€ï¼Œæäº¤åˆ°masterä¸Šçš„å˜æ›´å¿…é¡»æ·»åŠ æ ‡è®°ï¼ˆå¦‚ä½¿ç”¨ç‰ˆæœ¬å·ç­‰è¿›è¡Œæ ‡è®°ï¼‰ï¼Œç”¨äºå°†æ¥å‚è€ƒã€‚æœ€åï¼Œåœ¨è¿™ä¸ªå‘å¸ƒç”¨åˆ†æ”¯ä¸Šè¿›è¡Œçš„æ›´æ”¹éœ€è¦åˆå¹¶å›developï¼Œä»¥ä¿è¯å°†æ¥çš„ç‰ˆæœ¬åŒ…å«ç¼ºé™·çš„ä¿®å¤ã€‚ åœ¨Gitä¸­çš„å‰ä¸¤æ­¥ï¼š $ git checkout masterSwitched to branch 'master'$ git merge --no-ff release-1.2Merge made by recursive.(Summary of changes)$ git tag -a 1.2 æ­¤æ—¶ï¼Œç‰ˆæœ¬å·²å‘å¸ƒï¼Œå¹¶ä¸”å·²æ ‡è®°ã€‚ Tips: ä½ å¯ä»¥ä½¿ç”¨-sæˆ–è€…-u &lt;key&gt;æ¥åŠ å¯†æ ‡è®°ã€‚ ä¸ºäº†ä¿ç•™å‘å¸ƒç”¨åˆ†æ”¯çš„å˜æ›´ï¼Œéœ€è¦åˆå¹¶å›developåˆ†æ”¯ï¼š $ git checkout developSwitched to branch 'develop'$ git merge --no-ff release-1.2Merge made by recursive.(Summary of changes) è¿™ä¸€æ­¥å¯èƒ½ä¹Ÿä¼šäº§ç”Ÿå†²çªï¼Œæ‰€ä»¥ï¼Œè§£å†³å†²çªå¹¶ä¸”æäº¤ã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤è¯¥å‘å¸ƒç”¨åˆ†æ”¯ï¼š $ git branch -d release-1.2Deleted branch release-1.2 (was ff452fe) è¡¥ä¸åˆ†æ”¯ åˆ†æ”¯æ¥æºï¼šmasteråˆå¹¶ç›®æ ‡ï¼šdevelopå’Œmasterå‘½åæƒ¯ä¾‹ï¼šhotfix-* è¿™ç±»åˆ†æ”¯ä¸å‘å¸ƒç”¨åˆ†æ”¯å¾ˆç±»ä¼¼ï¼Œä¸è¿‡è¡¥ä¸åˆ†æ”¯çš„äº§ç”Ÿæ˜¯ä¸ºäº†å¿«é€Ÿå“åº”ç”Ÿäº§ç¯å¢ƒä¸­çš„ç´§æ€¥é—®é¢˜ã€‚å½“çº¿ä¸Šé­é‡ç´§æ€¥ç¼ºé™·éœ€è¦ç«‹åˆ»è§£å†³ï¼Œåˆ™éœ€è¦åœ¨å¯¹åº”æ ‡è®°çš„masteråˆ†æ”¯ä¸Šæ‹‰å‡ºä¸€ä¸ªè¡¥ä¸åˆ†æ”¯ã€‚ åœ¨æŸä¸€ä½æˆ–è€…å‡ ä½å¼€å‘è€…ä¿®å¤çº¿ä¸Šé—®é¢˜çš„åŒæ—¶ï¼Œdevelopåˆ†æ”¯å¯ä»¥ç»§ç»­è¿›è¡Œã€‚ åˆ›å»ºä¸€ä¸ªè¡¥ä¸åˆ†æ”¯ è¡¥ä¸åˆ†æ”¯åœ¨masterä¸Šæ‹‰å‡ºï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œ1.2ç‰ˆæœ¬æ˜¯ç›®å‰çš„çº¿ä¸Šç‰ˆæœ¬ï¼Œç”±äºä¸€ä¸ªä¸¥é‡bugé€ æˆå®•æœºçš„æƒ…å†µå‡ºç°ï¼Œä½†æ˜¯ç›®å‰developåˆ†æ”¯ä¸Šçš„å˜æ›´è¿˜ä¸å¤Ÿç¨³å®šï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¡¥ä¸åˆ†æ”¯ï¼Œå…ˆæ¥è§£å†³ç´§æ€¥é—®é¢˜ï¼š $ git checkout -b hotfix-1.2.1 masterSwitched to a new branch \"hotfix-1.2.1\"$ ./bump-version.sh 1.2.1Files modified successfully, version bumped to 1.2.1.$ git commit -a -m \"Bumped version number to 1.2.1\"[hotfix-1.2.1 41e61bb] Bumped version number to 1.2.11 files changed, 1 insertions(+), 1 deletions(-) ä¸è¦å¿˜è®°å¢åŠ ç‰ˆæœ¬å·ã€‚ ç„¶åï¼Œä¿®å¤bugå¹¶æäº¤å˜æ›´ã€‚ $ git commit -m \"Fixed severe production problem\"[hotfix-1.2.1 abbe5d6] Fixed severe production problem5 files changed, 32 insertions(+), 17 deletions(-) ç»“æŸä½¿ç”¨ä¸€ä¸ªè¡¥ä¸åˆ†æ”¯ ä¿®å¤bugä¹‹åï¼Œè¡¥ä¸åˆ†æ”¯å¿…é¡»åˆå¹¶åˆ°masterï¼ŒåŒæ—¶ï¼Œä¹Ÿéœ€è¦åˆå¹¶åˆ°developï¼Œç¡®ä¿åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­åŒ…å«bugçš„ä¿®å¤ã€‚æ­¤æ—¶çš„æ“ä½œä¸å‘å¸ƒç”¨åˆ†æ”¯å®Œå…¨ä¸€è‡´ã€‚ é¦–å…ˆï¼Œæ›´æ–°masterå¹¶ä¸”æ ‡æ³¨ç‰ˆæœ¬ï¼š $ git checkout masterSwitched to branch 'master'$ git merge --no-ff hotfix-1.2.1Merge made by recursive.(Summary of changes)$ git tag -a 1.2.1 æ¥ç€ï¼Œåˆå¹¶åˆ°developï¼š $ git checkout developSwitched to branch 'develop'$ git merge --no-ff hotfix-1.2.1Merge made by recursive.(Summary of changes) è¿™ä¸ªè§„åˆ™å­˜åœ¨ä¸€ä¸ªä¾‹å¤–æƒ…å†µï¼šå¦‚æœå‘å¸ƒç”¨åˆ†æ”¯å½“å‰å­˜åœ¨ï¼Œåˆ™éœ€è¦å°†è¡¥ä¸åˆ†æ”¯åˆå¹¶åˆ°å‘å¸ƒç”¨åˆ†æ”¯ï¼Œè€Œä¸æ˜¯developï¼Œå› ä¸ºè¯¥å‘å¸ƒç”¨åˆ†æ”¯æœ€ç»ˆä¼šåˆå¹¶åˆ°developï¼ˆå¦‚æœdevelopåˆ†æ”¯ç«‹åˆ»éœ€è¦è¿™ä¸ªbugå¾—åˆ°ä¿®å¤ï¼Œè€Œç­‰ä¸åˆ°å‘å¸ƒç”¨åˆ†æ”¯ç»“æŸï¼Œåˆ™ä½ éœ€è¦å°å¿ƒè°¨æ…çš„å°†ä¿®æ­£åˆå¹¶åˆ°æœªå‡†å¤‡å°±ç»ªçš„developåˆ†æ”¯ä¸Šï¼‰ã€‚ æœ€åï¼Œç§»é™¤è¿™ä¸ªä¸´æ—¶åˆ†æ”¯ï¼š $ git branch -d hotfix-1.2.1Deleted branch hotfix-1.2.1 (was abbe5d6). ç»“è¯­è¿™ä¸ªæ¨¡å‹çœ‹èµ·æ¥å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä»¤äººéœ‡æƒŠçš„åœ°æ–¹ï¼Œä½†æ˜¯å´ååˆ†åˆç†ã€‚åœ¨StackOverflowä¸Šé—®é¢˜What does Bump Version stand for?ä¸­ï¼Œæœ‰è§£ç­”è€…æåˆ°äº†è¯¥æ–‡ï¼Œå¹¶ååˆ†æ¨èã€‚ åŸæ–‡ä½œè€…Twitterï¼š@nvie","tags":[{"name":"Git","slug":"Git","permalink":"http://elbarco.cn/tags/Git/"}]},{"title":"è‹±é›„è”ç›Ÿä¸­çš„éšæœºè¡Œä¸ºä¼˜åŒ–","date":"2016-03-07T05:48:24.000Z","path":"2016/03/07/è‹±é›„è”ç›Ÿä¸­çš„éšæœºè¡Œä¸ºä¼˜åŒ–/","text":"åŸæ–‡åœ°å€ï¼šä¼ é€é—¨åŸåˆ›ç¿»è¯‘ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ å¯¹äºåƒè‹±é›„è”ç›Ÿè¿™æ ·ä¸æ–­æ¼”è¿›çš„äº§å“çš„å¼€å‘è€…è€Œè¨€ï¼Œéœ€è¦ä¸æ–­çš„è‡´åŠ›äºä¸ç³»ç»Ÿçš„ç†µä½œæ–—äº‰ï¼Œå› ä¸ºä»–ä»¬å°†è¶Šæ¥è¶Šå¤šçš„å†…å®¹æ·»åŠ åˆ°èµ„æºæœ‰é™çš„æœåŠ¡å™¨ä¸­ã€‚æ–°çš„å†…å®¹å¸¦äº†æ–°çš„éšæ€§æˆæœ¬â€”â€”ä¸ä»…æ˜¯æ›´å¤šçš„å®æ–½æˆæœ¬ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬ç”±äºåˆ›é€ äº†æ›´å¤šçš„çº¹ç†ã€ä»¿çœŸå’Œå¤„ç†é€ æˆçš„å†…å­˜å’Œæ€§èƒ½æˆæœ¬ã€‚å¦‚æœæˆ‘ä»¬å¿½ç•¥ï¼ˆæˆ–è€…é”™è¯¯ä¼°ç®—ï¼‰äº†è¿™äº›æˆæœ¬ï¼Œåˆ™æ•´ä½“æ¸¸æˆæ€§èƒ½ä¸ä½³ï¼Œå¯ç©æ€§å‡å°‘ã€‚æ•…éšœä½¿äººåŒæ¶ï¼Œå»¶è¿Ÿä½¿äººæ„¤æ€’ï¼Œå¸§ç‡ä¸‹é™è®©äººæ²®ä¸§ã€‚ æˆ‘æ˜¯è‡´åŠ›äºæé«˜è‹±é›„è”ç›Ÿæ€§èƒ½å›¢é˜Ÿä¸­çš„ä¸€å‘˜ã€‚æˆ‘ä»¬ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åšå¿«ç…§ï¼Œå‘ç°é—®é¢˜ (æ€§èƒ½ç›¸å…³å’Œå…¶ä»–)ï¼Œç„¶åä¿®å¤é—®é¢˜ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­¦åˆ°çš„ä¸œè¥¿åé¦ˆå…¶ä»–å›¢é˜Ÿï¼Œå¹¶ä¸”ç»™ä»–ä»¬æä¾›å·¥å…·ï¼Œä½¿ä»–ä»¬åœ¨å½±å“ç”¨æˆ·ä¹‹å‰æ¥æ£€æµ‹å¹¶å®šä½ä»–ä»¬è‡ªå·±çš„æ€§èƒ½é—®é¢˜ã€‚æˆ‘ä»¬ä¸æ–­çš„æé«˜è‹±é›„è”ç›Ÿçš„æ€§èƒ½ä¸ºè‰ºæœ¯å®¶å’Œè®¾è®¡å¸ˆæ·»åŠ æ–°çš„ä¸œè¥¿æä¾›äº†ç©ºé—´ï¼šå½“ä»–ä»¬ä½¿æ¸¸æˆæ›´åºå¤§æ›´ä¼˜ç§€çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä½¿ä¹‹æ›´å¿«ã€‚ è¿™æ˜¯å…³äºæˆ‘ä»¬å›¢é˜Ÿå¦‚ä½•ä¼˜åŒ–è‹±é›„è”ç›Ÿæ€§èƒ½ç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œåç»­æˆ‘ä»¬å°†ä¸æ–­æŒç»­æ›´æ–°ã€‚è¿™æ˜¯ä¸€é¡¹å›æŠ¥ä¸°åšçš„æŒ‘æˆ˜ï¼Œè¿™ç¯‡æ–‡ç« å°†æ·±å…¥ä»‹ç»æˆ‘ä»¬åœ¨ç²’å­ç³»ç»Ÿä¸­é‡åˆ°çš„ä¸€äº›æœ‰è¶£çš„æŒ‘æˆ˜â€”â€”æ­£å¦‚åœ¨ä¸‹å›¾ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ç²’å­ç³»ç»Ÿåœ¨æ¸¸æˆä¸­æ‰®æ¼”äº†ååˆ†é‡è¦çš„è§’è‰²ã€‚ ä¸Šå›¾æ˜¯åœ¨è‹±é›„è”ç›Ÿæ¸¸æˆä¸­é«˜ç²’å­å¯†åº¦çš„ä¸€ä¸ªä¾‹å­ã€‚ ä¼˜åŒ–ï¼Œå¹¶ä¸æ˜¯åœ¨ç¨‹åºé›†ä¸­é‡å†™å¤§é‡çš„ä»£ç â€”â€”å°½ç®¡æœ‰äº›æ—¶å€™æ˜¯è¿™æ ·çš„ã€‚æˆ‘ä»¬ä»…å˜æ›´é‚£äº›ä¸ä»…èƒ½å¤Ÿæé«˜æ€§èƒ½ï¼Œè€Œä¸”ç»´æŠ¤æ­£ç¡®æ€§çš„ä»£ç ï¼Œå¦‚æœæœ‰å¯èƒ½çš„è¯ï¼Œè¿˜ä¼šæé«˜ä»£ç è´¨é‡ã€‚æœ€åä¸€é¡¹ç•¥æ˜¾æŒ‘å‰”ï¼šä»»ä½•ä¸æ˜“è¯»ã€ä¸æ˜“ç»´æŠ¤çš„ä»£ç éƒ½ä¼šäº§ç”ŸæŠ€æœ¯å€ºåŠ¡ï¼Œè¿™ä¸ªæˆ‘ä»¬ç¨åå†è°ˆã€‚ ä¼˜åŒ–å·²æœ‰çš„ä»£ç åº“ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸‰ä¸ªåŸºæœ¬æ­¥éª¤ï¼šé‰´åˆ«ã€ç†è§£å’Œè¿­ä»£ã€‚ æ­¥éª¤ä¸€ï¼šé‰´åˆ« åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®è®¤å“ªäº›ä»£ç éœ€è¦è¿›è¡Œä¼˜åŒ–ã€‚å³ä½¿æœ‰äº›ä»£ç çœ‹èµ·æ¥æ˜æ˜¾æ€§èƒ½è¾ƒå·®ï¼Œä½†æ˜¯ç”±äºå…¶å¯¹æ•´ä½“æ€§èƒ½å½±å“æå°ï¼Œä¼˜åŒ–è¿™ç±»ä»£ç æ”¶ç›Šæå°‘ï¼ˆå°¤å…¶å½“èŠ±è´¹åœ¨ä¸Šé¢çš„æ—¶é—´å’Œç²¾åŠ›åœ¨å…¶ä»–æ–¹é¢å¯ä»¥åšåˆ°æ›´å¥½çš„æ”¶ç›Šï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨ä»£ç æ£€æµ‹å·¥å…·å’Œé‡‡æ ·åˆ†æå™¨æ¥å¸®åŠ©è¯†åˆ«éæ€§èƒ½éƒ¨åˆ†çš„åŸºæœ¬ä»£ç ã€‚ æ­¥éª¤äºŒï¼šç†è§£ ä¸€æ—¦æˆ‘ä»¬å¾—çŸ¥ä»£ç åº“çš„å“ªéƒ¨åˆ†ä»£ç æ€§èƒ½è¾ƒå·®ï¼Œæˆ‘ä»¬ä¾¿ä¼šè¯¦ç»†çš„æŸ¥çœ‹è¿™éƒ¨åˆ†ä»£ç ä»¥æ±‚å®Œå…¨ç†è§£ä»£ç ã€‚ç†è§£ä»£ç æ„å‘³ç€ç†è§£è¿™äº›ä»£ç çš„å«ä¹‰åŠåŸæœ¬çš„ç›®çš„ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥æ‚‰ä¸ºä½•è¿™äº›ä»£ç äº§ç”Ÿç“¶é¢ˆäº†ã€‚ æ­¥éª¤ä¸‰ï¼šè¿­ä»£ å½“æˆ‘ä»¬ç†è§£äº†ä¸ºä½•ç‰¹å®šéƒ¨åˆ†ä»£ç æ‰§è¡Œè¾ƒæ…¢åŠä»£ç æœ¬æ„è¦æ‰§è¡Œçš„å†…å®¹ï¼Œæˆ‘ä»¬å°±æœ‰äº†è¶³å¤Ÿçš„ä¿¡æ¯æ¥è®¾è®¡å’Œå¼€å‘ä¸€å¥—å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ä½¿ç”¨é‰´åˆ«æ­¥éª¤ä¸­çš„å·¥å…·å’Œå¾—åˆ°çš„å¿«ç…§æ•°æ®ï¼Œæˆ‘ä»¬å°†æ–°ä»£ç å’Œæ—§ä»£ç çš„æ€§èƒ½åšäº†æ¯”è¾ƒã€‚å¦‚æœè§£å†³æ–¹æ¡ˆæ•ˆæœå‡ºä¼—ï¼Œæˆ‘ä»¬ä¼šå½»åº•çš„è¿›è¡Œæµ‹è¯•ä»¥ç¡®ä¿ä¸å¼•å…¥æ¥æ–°çš„bugï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥å‡»æŒåº†è´ºäº†ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ä¸ºå…¶ä»–å†…éƒ¨æµ‹è¯•åšå¥½äº†å……åˆ†çš„å‡†å¤‡ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ–°çš„ä»£ç ä¸è§çš„è¶³å¤Ÿå¿«ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸æ–­è¿­ä»£è§£å†³æ–¹æ¡ˆï¼ŒçŸ¥é“æ–°çš„ä»£ç èƒ½è¾¾åˆ°ä¼˜åŒ–çš„ç›®çš„ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹åœ¨è‹±é›„è”ç›Ÿä»£ç åº“ä¸­è¿™å‡ ä¸ªæ­¥éª¤çš„å®æ–½ç»†èŠ‚ï¼Œå¹¶ä»¥æœ€è¿‘ä¼˜åŒ–çš„ç²’å­ç³»ç»Ÿé€æ­¥ä»‹ç»ã€‚ æ­¥éª¤1:é‰´åˆ«æ‹³å¤´çš„å·¥ç¨‹å¸ˆä½¿ç”¨å¤§é‡çš„åˆ†æå·¥å…·æ¥æ£€æŸ¥æ¸¸æˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ€§èƒ½ã€‚æˆ‘ä»¬å…ˆæŸ¥çœ‹æ¥å®¢æˆ·ç«¯çš„å¸§ç‡å’Œé€šè¿‡Waffleså¾—åˆ°çš„é«˜çº§åˆ†æä¿¡æ¯ï¼ˆé€šè¿‡å·¥å…·çš„ç‰¹å®šå‡½æ•°è·å¾—çš„è¾“å‡ºä¿¡æ¯ï¼‰ï¼Œè¿™ä¸ªå†…éƒ¨å·¥å…·å¯ä»¥è®©æˆ‘ä»¬åœ¨å†…éƒ¨æ„å»ºçš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¿æŒè”é€šã€‚æ­¤å¤–ï¼ŒWafflesè¿˜å…·å¤‡å…¶ä»–åŠŸèƒ½ï¼Œå¦‚åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­è§¦å‘è°ƒè¯•ã€æ£€æŸ¥æ¸¸æˆå†…éƒ¨æ•°æ®å¦‚å¯¼èˆªåˆ†æ ¼å’Œæš‚åœæˆ–è€…å‡ç¼“æ¸¸æˆè¿‡ç¨‹ã€‚ Wafflesæˆªå›¾ Wafflesæä¾›äº†ä¸€ä¸ªå®æ—¶å±•ç¤ºç•Œé¢ï¼Œå¹¶æä¾›è¯¦ç»†çš„æ€§èƒ½ä¿¡æ¯ã€‚ä¸Šå›¾æ˜¯Waffleså¦‚ä½•å±•ç°å®¢æˆ·ç«¯æ€§èƒ½è¡¨ç°çš„ç»å…¸ä¾‹å­ï¼Œä¸Šè¾¹å›¾å½¢ï¼ˆç»¿è‰²æŸ±çŠ¶å›¾ï¼‰ä»¥æ¯«ç§’ä¸ºå•ä½è¡¨ç¤ºäº†å¸§ç‡â€”â€”è¶Šé«˜çš„æŸ±çŠ¶å›¾è¡¨ç¤ºè¶Šä½çš„å¸§ç‡ã€‚éå¸¸æ…¢çš„å¸§ç‡åœ¨æ¸¸æˆä¸­æ˜¯å¯ä»¥æ„Ÿå—å¾—åˆ°çš„ã€‚æŸ±çŠ¶å›¾ä¸‹é¢æ˜¯é‡è¦åŠŸèƒ½çš„åˆ†å±‚è§†å›¾ï¼Œé€šè¿‡ç‚¹å‡»ä»»ä½•ç»¿è‰²æŸ±çŠ¶å›¾ï¼Œå·¥ç¨‹å¸ˆéƒ½ä¼šçœ‹åˆ°å½±å“è¯¥å¸§ç‡çš„è¯¦ç»†ä¿¡æ¯ã€‚é€šè¿‡è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºäº›ç«¯å€ªï¼Œå³å“ªéƒ¨åˆ†ä»£ç è¿è¡Œæ—¶å¯¼è‡´æ€§èƒ½è¾ƒå·®çš„å…³é”®ã€‚ æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å®åœ¨ä»£ç åº“å†…æ‰‹å·¥æ£€æµ‹ä¸€äº›é‡è¦å‡½æ•°æ¥æä¾›è¿™ä»½æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ã€‚åœ¨å¯¹å¤–å‘å¸ƒçš„æ¸¸æˆç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªå®å¹¶æ²¡æœ‰è¢«æ‰“åŒ…ç¼–è¯‘ï¼Œä½†åœ¨æµ‹è¯•ç‰ˆæœ¬æ‰“åŒ…ä¸­ï¼Œè¿™ä¸ªå®ä½œä¸ºä¸€ä¸ªå¾ˆå°çš„classå­˜åœ¨ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªäº‹ä»¶ï¼Œå­˜æ”¾äºé…ç½®æ–‡ä»¶ç¼“å†²åŒºã€‚è¯¥äº‹ä»¶åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²è¯†åˆ«ç ã€ä¸€ä¸ªçº¿ç¨‹IDã€ä¸€ä¸ªæ—¶é—´æˆ³å’Œå…¶ä»–å¿…è¦çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚å®ƒè¿˜å¯ä»¥å­˜å‚¨åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…æ‰€æœ‰å‘ç”Ÿçš„å†…å­˜é…ç½®æ•°ï¼‰ã€‚å½“å¯¹è±¡è¶…å‡ºèŒƒå›´åï¼Œææ„å™¨ä¼šåœ¨é…ç½®ç¼“å†²åŒºä¸­æ›´æ–°è¯¥äº‹ä»¶è‡ªæ„é€ ä»¥æ¥çš„è¿è¡Œæ—¶é—´ã€‚åœ¨éšåçš„æ—¶é—´ï¼Œå¯ä»¥è¾“å‡ºå’Œè§£ææ­¤é…ç½®æ–‡ä»¶ç¼“å†²åŒºâ€”â€”ç†æƒ³çš„æƒ…å†µæ˜¯åœ¨å¦ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œä»¥å°½é‡å‡å°‘å¯¹æ¸¸æˆæœ¬èº«çš„å½±å“ã€‚ Chrome Tracing åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ†æç¼“å†²åŒºè¾“å‡ºåˆ°æ–‡ä»¶ï¼Œå¹¶ä¸”è¯»å…¥åˆ°æ„å»ºåœ¨Chromeæµè§ˆä¸­å¯è§†åŒ–å·¥å…·ä¸­ï¼ˆå…³äºè·Ÿè¸ªå·¥å…·çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥ç‚¹å‡»è¿™é‡Œï¼Œä½ å¯ä»¥åœ¨è‡ªå·±çš„Chromeæµè§ˆå™¨ä¸­é€šè¿‡åœ¨åœ°å€æ æ•²å…¥â€chrome://tracing/â€œè¿›è¡Œå°è¯•ã€‚è¿™ä¸ªæ‰©å±•ç¨‹åºè¢«è®¾è®¡ç”¨æ¥è¿›è¡Œç½‘é¡µæ€§èƒ½åˆ†æï¼Œè¾“å…¥æ ¼å¼æ—¶JSONï¼Œæ‰€ä»¥ä½ å¯ä»¥è½»æ¾çš„æ ¹æ®ä½ è‡ªå·±çš„æ•°æ®æ„é€ è¾“å…¥ï¼‰ã€‚é€šè¿‡å›¾å½¢åŒ–åçš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å“ªäº›æ˜¯æ‰§è¡Œè¾ƒæ…¢çš„å‡½æ•°ï¼Œæˆ–è€…åœ¨é‚£é‡Œä¸æ–­æœ‰å¤§é‡çš„å°å‡½æ•°è¢«è°ƒç”¨ï¼šè¿™äº›éƒ½æ˜¯æ¬¡ä¼˜ä»£ç çš„è¿¹è±¡ã€‚ è®©æˆ‘æ¥å±•ç¤ºè¯¦ç»†æ“ä½œï¼šä¸Šé¢çš„è§†å›¾æ˜¯Chrome Tracingçš„è§†å›¾ï¼Œå›¾ä¸­å±•ç¤ºäº†å®¢æˆ·ç«¯ä¸Šä¸¤ä¸ªè¿è¡Œçš„çº¿ç¨‹ã€‚ä¸Šéƒ¨åˆ†çš„æ˜¯ä¸»çº¿ç¨‹ï¼Œæ‰§è¡Œå¤§å¤šæ•°çš„å¤„ç†å·¥ä½œï¼Œåº•éƒ¨çš„æ˜¯ç²’å­çº¿ç¨‹ï¼Œç”¨æ¥æ‰§è¡Œç²’å­å¤„ç†ã€‚æ¯ä¸€ä¸ªç€è‰²çš„æ¨ªæ¡å‡å¯¹åº”ä¸€ä¸ªå‡½æ•°ï¼Œæ¨ªæ¡çš„é•¿åº¦æŒ‡ç¤ºäº†å…¶æ‰§è¡Œæ—¶é—´ã€‚è¢«è°ƒç”¨çš„å‡½æ•°ç”±ç«–ç›´æ ˆç»“æ„å±•ç¤ºï¼Œçˆ¶å‡½æ•°åœ¨å­å‡½æ•°ä¹‹ä¸Šã€‚è¿™ä¸ªå·¥å…·æä¾›ç»™æˆ‘ä»¬ä¸€ç§éå¸¸ç¥å¥‡æ–¹å¼æ¥å¯è§†åŒ–æ‰§è¡Œå¤æ‚åº¦ä»¥åŠå¸§çš„ç­¾åæ—¶é—´ã€‚å½“æˆ‘ä»¬å‘ç°ä¸€ä¸ªæ¬¡ä¼˜ä»£ç åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¤§ç²’å­åŒºåŸŸä»¥æ±‚æŸ¥çœ‹æ›´å¤šç»†èŠ‚ã€‚ Chrome Tracingæ”¾å¤§æ•ˆæœå›¾ è®©æˆ‘ä»¬æ”¾å¤§å›¾å½¢ä¸­é—´éƒ¨åˆ†ã€‚ä»ä¸Šé¢çš„çº¿ç¨‹ä¸­æˆ‘å¯ä»¥çœ‹åˆ°ä¸€ä¸ªéå¸¸åœºçš„ç­‰å¾…ï¼Œåªæœ‰å½“ä¸‹é¢çš„ç²’å­æ¨¡æ‹Ÿå‡½æ•°æ‰§è¡Œå®Œæ¯•æ‰ç»“æŸã€‚æ¨¡æ‹ŸåŠŸèƒ½åŒ…å«å¤§é‡ä¸åŒå‡½æ•°ï¼ˆç€è‰²çš„æ¨ªæ¡ï¼‰çš„è°ƒç”¨ã€‚æ¯ä¸€ç±»éƒ½æ˜¯ç²’å­ç³»ç»Ÿçš„æ›´æ–°åŠŸèƒ½ï¼Œç”¨äºå°†ä½ç½®ã€ æ–¹å‘å’Œæ¯ä¸ªç²’å­åœ¨è¯¥ç³»ç»Ÿä¸­å…¶ä»–å¯è§æ€§çŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚ä¸€ä¸ªæ˜æ˜¾çš„ä¼˜åŒ–æ–¹å¼æ˜¯å°†æ¨¡æ‹Ÿå‡½æ•°æ”¹é€ æˆå¤šçº¿ç¨‹æ–¹å¼ï¼Œå³å¯è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ç²’å­çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¯¹äºæœ¬ä¾‹ï¼Œæˆ‘ä»¬ä»…å…³æ³¨ä¸ä¼˜åŒ–æ¨¡æ‹Ÿä»£ç æœ¬èº«ã€‚ æ—¢ç„¶ç°åœ¨æˆ‘ä»¬çŸ¥é“å»ä½•å¤„æŸ¥çœ‹æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ‡æ¢åˆ°æ ·æœ¬åˆ†æã€‚è¿™ç±»åˆ†æå‘¨æœŸæ€§çš„è¯»å–å’Œå­˜å‚¨ç¨‹åºè®¡æ•°å™¨å’Œè¿è¡Œä¸­çš„è¿›ç¨‹çš„æ ˆä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ã€‚ä¸€æ®µæ—¶é—´åï¼Œè¿™ä¸ªä¿¡æ¯å¯ä»¥ç»™å‡ºä¸€ä¸ªéšæœºæ¦‚è¿°ï¼Œæ¦‚è¿°ä¸­æè¿°äº†ä»£ç åº“å†…çš„è€—æ—¶ã€‚è¾ƒæ…¢çš„å‡½æ•°ä¼šå¾—åˆ°æ›´å¤šçš„æ ·æœ¬ï¼Œæ›´æœ‰ç”¨çš„æ˜¯ï¼Œç”¨æ—¶æœ€é•¿çš„å•ä¸ªå‡½æ•°ä¼šç´¯ç§¯æ›´å¤šçš„æ ·æœ¬ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥çœ‹åˆ°å“ªäº›å‡½æ•°æ‰§è¡Œæœ€æ…¢ï¼ŒåŒæ—¶å¯ä»¥çœ‹åˆ°å“ªå‡ è¡Œä»£ç æ‰§è¡Œæœ€æ…¢ã€‚å¦‚ä»Šæœ‰å¾ˆå¤šä¸é”™çš„æ ·æœ¬åˆ†æå·¥å…·å¯ä¾›é€‰æ‹©ï¼Œä»å…è´¹çš„Very Sleepyåˆ°æ›´å¤šç‰¹æ€§æ”¯æŒçš„å•†ä¸šè½¯ä»¶ï¼Œå¦‚Intelçš„VTuneã€‚ é€šè¿‡åœ¨æ¸¸æˆå®¢æˆ·ç«¯ä¸Šè¿è¡ŒVTuneæ¥æ£€æŸ¥ç²’å­çº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹åˆ—è¡¨ä¸­è¿è¡Œæœ€æ…¢çš„å‡½æ•°ã€‚ VTuneä¸­çš„Hot Functions ä¸Šé¢çš„è¡¨æ ¼å±•ç°äº†ä¸€äº›ç²’å­ç›¸å…³çš„å‡½æ•°ã€‚ä½œä¸ºå‚è€ƒï¼Œæœ€ä¸Šé¢ä¸¤ä¸ªè¾ƒå¤§çš„å‡½æ•°ç”¨äºä¸ºæ¯ä¸ªç²’å­æ›´æ–°çŸ©é˜µå’Œä½ç½®ã€æ–¹å‘ç›¸å…³çš„çŠ¶æ€ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬æ¥çœ‹åœ¨ç¬¬ä¸‰å’Œç¬¬ä¹é¡¹AnimatedVariableWithRandomFactor&lt;&gt;ä¸­çš„Evaluateå‡½æ•°ï¼Œå‡½æ•°å¾ˆå°ï¼ˆå¹¶ä¸”å®¹æ˜“ç†è§£ï¼‰ï¼Œä½†æ˜¯ç›¸å¯¹è€Œè¨€æ¯”è¾ƒè€—æ—¶ã€‚ æ­¥éª¤2:ç†è§£ç°åœ¨ï¼Œæˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªéœ€è¦ä¼˜åŒ–çš„å‡½æ•°ï¼Œåˆ™éœ€è¦ç†è§£è¿™ä¸ªå‡½æ•°è¦åšçš„äº‹æƒ…å’Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšçš„åŸå› ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒAnimatedVariablesè¢«è‹±é›„è”ç›Ÿç¾æœ¯å¸ˆç”¨æ¥å®šä¹‰ç²’å­ç‰¹å¾æ˜¯å¦‚ä½•éšç€æ—¶é—´å˜åŒ–ã€‚ä¸€æ—¦ä¸€ä¸ªç¾æœ¯å¸ˆä¸ºä¸€ä¸ªç‰¹å®šçš„ç²’å­å¯è§æ€§æŒ‡å®šå…³é”®å¸§å€¼åï¼Œä»£ç ä¸­ä¾¿ä¼šæ’å…¥è¿™äº›æ•°æ®æ¥äº§ç”Ÿä¸€æ¡æ›²çº¿ã€‚æ’å€¼æ–¹æ³•æ˜¯çº¿æ€§æ’å€¼æˆ–ä¸€é˜¶æˆ–äºŒæ¬¡é›†æˆã€‚åŠ¨ç”»æ›²çº¿è¢«å¤§é‡çš„ä½¿ç”¨â€”â€”å°½åœ¨å¬å”¤å¸ˆå³¡è°·ï¼ˆè¯‘è€…æ³¨ï¼šè‹±é›„è”ç›Ÿçš„åœ°å›¾ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æœ€çƒ­é—¨çš„åœ°å›¾ï¼‰ä¸­å°±æœ‰æ¥è¿‘40000çš„åŠ¨ç”»æ›²çº¿â€”â€”æ¶µç›–äº†ä»ç²’å­é¢œè‰²æ‰©å±•åˆ°æ—‹è½¬é€Ÿåº¦æ–¹æ–¹é¢é¢ã€‚Evaluateå‡½æ•°åœ¨æ¯åœºæ¸¸æˆä¸­ä¼šè¢«è°ƒç”¨æ•°ä»¥äº¿è®¡æ¬¡ã€‚æ­¤å¤–ï¼ŒLOLä¸­çš„ç²’å­ç³»ç»Ÿæ˜¯æ¸¸æˆä½“éªŒä¸­å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å®ƒä»¬çš„è¡Œä¸ºä¸èƒ½åšå‡ºä»»ä½•æ”¹å˜ã€‚ è¿™ä¸ªç±»å…¶å®å·²ç»åšè¿‡äº†ä¼˜åŒ–ï¼Œé€šè¿‡æŸ¥è¡¨çš„æ–¹å¼ï¼Œå¯¹æ¯ä¸ªtimestepæ‰€éœ€è¦çš„å€¼éƒ½é¢„å…ˆè®¡ç®—è¿‡å¹¶å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ‰€ä»¥åœ¨è¯»å–è¿™äº›æ•°å€¼æ—¶ä¸å¿…å†æ¬¡è®¡ç®—ï¼Œæ‰€ä»¥å‡å°‘äº†è®¡ç®—çš„è€—æ—¶ã€‚è¿™æ˜¯ä¸€ä¸ªæ˜æ™ºçš„é€‰æ‹©ï¼Œå› ä¸ºæ›²çº¿çš„ä¸€é˜¶å’ŒäºŒæ¬¡é›†æˆæ˜¯ä¸€ä¸ªæ˜‚è´µçš„è¿›ç¨‹ã€‚ä¸ºæ¯ä¸ªç³»ç»Ÿä¸­çš„æ¯ä¸ªç²’å­ä¸Šçš„åŠ¨ç”»å˜é‡è¿›è¡Œè¿™ä¸ªæ“ä½œä¼šä½¿å¾—å¤„ç†è¿‡ç¨‹å¤§å¤§å‡å°‘ã€‚ åŠ¨ç”»å˜é‡æ›²çº¿çš„æŸ¥è¯¢è¡¨ åœ¨æŸ¥è¯¢æ€§èƒ½é—®é¢˜æ—¶ï¼Œé€šè¿‡æ‰¾åˆ°æœ€åçš„åœºæ™¯æ¥æ”¾å¤§é—®é¢˜å¾€å¾€æ˜¯ä¸€ä¸ªååˆ†æœ‰ç”¨çš„æŠ€å·§ã€‚ä¸ºäº†æ¨¡æ‹Ÿç²’å­å¤„ç†å‡ç¼“ï¼Œæˆ‘å¼€å§‹äº†ä¸€åœºå•ä¸ªç©å®¶çš„æ¸¸æˆï¼Œæ¸¸æˆä¸­æœ‰9ä¸ªä¸­æœŸçº§åˆ«çš„ç”µè„‘ï¼Œå¹¶ä¸”åœ¨ä¸‹è·¯æŒ‘èµ·äº†ä¸€åœºæ··ä¹±çš„å›¢æˆ˜ã€‚æ¥ç€ï¼Œæˆ‘åœ¨å›¢æˆ˜æœŸé—´åœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œäº†VTuneï¼Œè®°å½•äº†å¤§é‡çš„æ•°æ®ç”¨äºåˆ†æã€‚è¿™äº›æ•°æ®ç»™å‡ºäº†åœ¨Evaluateä»£ç ä¸­çš„å½’å› æ ·æœ¬ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚ ä¸‹å›¾ä¸­æˆ‘æˆªå–äº†ç¬¬91-95è¡Œä»£ç ï¼Œä¸ºäº†æ›´å¥½çš„è¯´æ˜ç¬¬90è¡Œè°ƒç”¨Evaluateçš„æƒ…å½¢ã€‚ VTuneä¸­çš„åˆ†ææ ·æœ¬ å¯¹äºä¸ç†Ÿæ‚‰VTuneçš„äººæ¥è¯´ï¼Œå…¶å®è¿™ä¸ªè¯•å›¾å±•ç¤ºçš„å°±æ˜¯è§£ææœŸé—´æ‰€æ”¶é›†çš„ä»£ç ã€‚å³ä¾§çš„çº¢è‰²æ¨ªæ¡æŒ‡ç¤ºäº†å‘½ä¸­æ¬¡æ•°ï¼Œæ¨ªæ¡è¶Šé•¿å°±æ„å‘³ç€å‘½ä¸­æ¬¡æ•°è¶Šå¤šï¼Œè€Œå‘½ä¸­æ¬¡æ•°è¶Šå¤šè¡¨ç¤ºè¿™ä¸€è¡Œæ‰§è¡Œè¶Šæ…¢ã€‚æŒ¨ç€æ¨ªæ¡çš„æ—¶é—´æ˜¯å¤„ç†è¿™è¡Œä»£ç æ‰€ç”¨çš„é¢„ä¼°æ—¶é—´ã€‚ä½ ä¹Ÿå¯ä»¥å°±æŸä¸ªç‰¹å®šå‡½æ•°çš„åˆ°ä¸€ä¸ªå‡†ç¡®è§†å›¾æ¥æŸ¥çœ‹æ˜¯ä»€ä¹ˆå› ç´ â€œè´¡çŒ®â€äº†æ‰§è¡Œç¼“æ…¢ã€‚ å¦‚æœå°±çº¢è‰²çš„æ¨ªæ¡æ¥çœ‹ï¼Œç¬¬95è¡Œä»£ç å°±æ˜¯é—®é¢˜æ‰€åœ¨ã€‚ä½†æ˜¯è¿™æ®µä»£ç æ‰€åšçš„ä»…ä»…æ˜¯åœ¨Vector3fä¸­å¤åˆ¶å‡ºæ‹¼å†™é”™è¯¯çš„æŸ¥è¯¢è¡¨ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªå‡½æ•°æˆä¸ºæœ€æ…¢çš„éƒ¨åˆ†å‘¢ï¼Ÿä¸ºä»€ä¹ˆ12å­—èŠ‚çš„å¤åˆ¶è¿™ä¹ˆæ…¢ï¼Ÿ ç­”æ¡ˆåœ¨äºç°ä»£CPUè®¿é—®å†…å­˜çš„æ–¹å¼ä¸­ã€‚CPUéå¸¸å¿ å®çš„éµå¾ªäº†æ‘©å°”å®šå¾‹ï¼Œæ¯å¹´éƒ½ä¼šæé€Ÿ60%ï¼Œè€Œå†…å­˜é€Ÿåº¦æ¯å¹´çš„å¢é€Ÿåªæœ‰å¯æ€œçš„10%ã€‚ å›¾å‡ºè‡ªã€Šè®¡ç®—æœºä½“ç³»ç»“æ„ï¼šé‡åŒ–ç ”ç©¶æ–¹æ³•ã€‹By John L. Hennessy, David A. Patterson, Andrea C. Arpaci-Dusseau ç¼“å­˜å¯ä»¥å‡å°æ€§èƒ½å·®è·ï¼Œè¿è¡Œè‹±é›„è”ç›Ÿçš„å¤§å¤šæ•°CPUéƒ½æœ‰3çº§ç¼“å­˜ï¼Œä¸€çº§ç¼“å­˜æœ€å¿«ä½†å®¹é‡æœ€å°ï¼Œä¸‰çº§ç¼“å­˜æœ€æ…¢ä½†å®¹é‡ç›¸å¯¹æœ€å¤§ã€‚ä»ä¸€çº§ç¼“å­˜è¯»å–æ•°æ®åªéœ€è¦4ä¸ªå‘¨æœŸï¼Œè€Œè¯»å–ä¸»å†…å­˜å´éœ€è¦å¤§çº¦300ä¸ªå‘¨æœŸç”šè‡³æ›´å¤šã€‚ä½ å¯ä»¥åœ¨300ä¸ªå‘¨æœŸå†…åšå¤§é‡å¤„ç†å·¥ä½œã€‚ æœ€åˆæŸ¥è¯¢è¡¨çš„è§£å†³æ–¹æ¡ˆçš„é—®é¢˜åœ¨äºï¼Œè™½ç„¶ä»æŸ¥è¯¢è¡¨ä¸­çš„é¡ºåºè¯»å–å€¼çš„æ“ä½œæ˜¯éå¸¸å¿«çš„(ç”±äºç¡¬ä»¶é¢„å–)ï¼Œä½†æ˜¯æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„é¢—ç²’å¹¶ä¸æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºå­˜å‚¨ï¼Œæ‰€ä»¥å®é™…æŸ¥æ‰¾é¡ºåºæ˜¯éšæœºçš„ã€‚è¿™é€šå¸¸ä¼šå¯¼è‡´CPUç­‰å¾…ä»ä¸»å­˜å‚¨è®¾å¤‡è¯»å–æ•°æ®æ—¶äº§ç”Ÿå»¶è¿Ÿã€‚è™½ç„¶300ä¸ªå‘¨æœŸæ¯”ä¸€çº§æˆ–è€…äºŒçº§é›†æˆä»£ä»·æ›´ä½ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯éœ€è¦çŸ¥é“è¿™ä¸ªå‡½æ•°åœ¨æ¸¸æˆä¸­çš„ä½¿ç”¨é¢‘ç‡å¦‚ä½•ï¼Œå› ä¸ºæ¯•ç«Ÿè¿™ä¸ªå‡½æ•°åœ¨æ¸¸æˆä¸­è¢«å¤§é‡çš„ä½¿ç”¨ã€‚ ä¸ºäº†æ¢æ±‚çœŸç›¸ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­æ·»åŠ ä¸€äº›é¢å¤–çš„å†…å®¹æ¥æ”¶é›†AnimatedVariablesçš„æ•°é‡å’Œç±»å‹ã€‚ç»“æœè¡¨ç¤ºï¼Œåœ¨38000ä¸ªAnimatedVariablesä¸­ï¼š 37500ä¸ªæ˜¯çº¿æ€§æ’å€¼ï¼›100ä¸ªæ˜¯ä¸€çº§ï¼Œ400ä¸ªæ˜¯äºŒçº§ 31500ä¸ªä»…æœ‰ä¸€ä¸ªå…³é”®å€¼ï¼›2500ä¸ªæœ‰3ä¸ªå…³é”®å€¼ï¼›1500æœ‰2ä¸ªæˆ–è€…4ä¸ªå…³é”®å€¼ æ‰€ä»¥æœ€å¸¸è§çš„é€”å¾„æ˜¯é’ˆå¯¹å•é”®å€¼ã€‚å› ä¸ºä»£ç æ€»æ˜¯ç”ŸæˆæŸ¥è¯¢è¡¨ï¼Œè¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªä¸éœ€è¦ä¼ æ’­çš„å•æ•°å€¼è¡¨ã€‚ä¹Ÿå°±æ„å‘³ç€æ¯æ¬¡æŸ¥è¯¢ï¼ˆæ€»æ˜¯è¿”å›ç›¸åŒå€¼ï¼‰ä¸€èˆ¬ä¼šäº§ç”Ÿç¼“å­˜ä¸¢å¤±ï¼Œè¿›è€Œå¯¼è‡´å¤§é‡çš„å†…å­˜å’ŒCPUå‘¨æœŸæµªè´¹ã€‚ é€šå¸¸æ¥è®²ï¼Œä»£ç æˆä¸ºç“¶é¢ˆä¸€åŠæœ‰å››ä¸ªåŸå› ï¼š è°ƒç”¨é¢‘ç‡è¿‡é«˜ ç®—æ³•é€‰æ‹©ä¸ä½³ï¼šå¦‚O(n^2)vsO(n) åšäº†ä¸å¿…è¦çš„å·¥ä½œæˆ–è€…å¤ªé¢‘ç¹çš„æ‰§è¡Œå¿…è¦çš„æ“ä½œ æ•°æ®è¾ƒå·®ï¼šæˆ–è€…æ˜¯æ•°æ®é‡å¤ªå¤§ï¼Œæˆ–è€…æ˜¯æ•°æ®åˆ†å¸ƒå’Œè®¿é—®æ¨¡å¼è¾ƒå·® è¿™é‡Œäº§ç”Ÿçš„é—®é¢˜åŸå› ä¸æ˜¯ç”±äºä»£ç è®¾è®¡ä¸å¥½æˆ–è€…å¼€å‘è´¨é‡å¯¼è‡´ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å¥½çš„ï¼Œä½†æ˜¯åœ¨è¢«ç¾æœ¯å¸ˆå¤§é‡ä½¿ç”¨ä¹‹åï¼Œæ™®é€šè·¯å¾„æ˜¯é’ˆå¯¹å•å€¼çš„ï¼Œè€Œè¿™äº›ç®€å•çš„é—®é¢˜åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æ˜¯å¾ˆä¸æ˜æ˜¾çš„ã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘å­¦ä¼šäº†ä½œä¸ºä¸€åç¨‹åºå‘˜æœ€é‡è¦çš„äº‹æƒ…ä¹‹ä¸€ä¾¿æ˜¯å°Šé‡ä½ æ­£åœ¨å¤„ç†çš„ä»£ç ã€‚ä»£ç æœ‰å¯èƒ½çœ‹èµ·å¾ˆç–¯ç‹‚ï¼Œä½†æ˜¯è¿™æ ·å†™çš„ç›®çš„å¯èƒ½æ˜¯åŸºäºä¸€ä¸ªå¥½çš„å‡ºå‘ç‚¹ã€‚åœ¨æ²¡æœ‰å®Œå…¨ç†è§£ä»£ç å¦‚ä½•ä½¿ç”¨å’Œå…¶ä¸ºä½•è®¾è®¡ä¹‹å‰ä¸è¦é”™è¯¯çš„è®¤ä¸ºè¿™äº›ä»£ç æ˜¯ä¸‘é™‹æ„šè ¢çš„ã€‚ æ¥è‡ªï¼šhttp://codesoftly.com/2010/03/ha-code-entropy-explained.html æ­¥éª¤3:è¿­ä»£ç°åœ¨æˆ‘ä»¬äº†è§£äº†å“ªéƒ¨åˆ†ä»£ç æ‰§è¡Œè¾ƒæ…¢ã€è¿™éƒ¨åˆ†ä»£ç æœ¬æ„æ˜¯ä»€ä¹ˆå’Œä¸ºä½•æ‰§è¡Œè¾ƒæ…¢ï¼Œæ˜¯æ—¶å€™å¼€å§‹æ„æƒ³è§£å†³æ–¹æ¡ˆäº†ã€‚æ¯ä¸ªå¸¸è§çš„æ‰§è¡Œè·¯å¾„éƒ½æ˜¯ä¸ºå•ç‹¬å˜é‡è®¾è®¡ï¼Œæˆ‘ä»¬è¿˜çŸ¥é“æ•°é‡å°‘çš„é”®çš„çº¿æ€§æ’å€¼éå¸¸å¿«ï¼ˆåœ¨å°‘é‡é«˜é€Ÿç¼“å­˜ä¸­ä½œç®€å•çš„è®¡ç®—ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è€ƒè™‘è¿™ç§æƒ…å†µçš„åŸºç¡€ä¸Šè¿›è¡Œé‡æ–°è®¾è®¡ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å›åˆ°å‰é¢ç½•è§é›†æˆæ›²çº¿çš„é¢„è®¡ç®—æŸ¥è¯¢è¡¨ä¸Šã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬ä¸ä½¿ç”¨æŸ¥è¯¢è¡¨æ—¶ï¼Œé¦–å…ˆæ„é€ è¿™äº›è¡¨æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥ä¼šé‡Šæ”¾å¤§é‡æ„ä¹‰éå‡¡çš„å†…å­˜ï¼ˆå¤§å¤šæ•°è¡¨å…·æœ‰256ä¸ªæ¡ç›®æˆ–è€…æ›´å¤šï¼Œæ¯ä¸ªæ¡ç›®å¯è¾¾12å­—èŠ‚çš„å¤§å°ï¼Œè¿™ç›¸å½“äºå¤§çº¦æ¯å¼ è¡¨3kbï¼‰ã€‚æ‰€ä»¥ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢å¤–çš„ä¸€äº›å†…å­˜æ¥æ·»åŠ ç¼“å­˜çš„æ¡ç›®å’Œå­˜å‚¨çš„å•å€¼çš„æ•°é‡ã€‚ ä¹‹å‰çš„ä»£ç çœ‹èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š template &lt;typename T&gt;class AnimatedVariable&#123; // &lt;snip&gt;private: std::vector&lt;float&gt; mTimes; std::vector&lt;T&gt; mValues;&#125;;template &lt;typename T&gt;class AnimatedVariablePrecomputed&#123; // &lt;snip&gt;private: std::vector&lt;T&gt; mPrecomutedValues;&#125;; AnimatedVariablePrecomputedå¯¹è±¡åœ¨AnimatedVariableä¸­è¿›è¡Œæ„é€ ï¼Œä»å®ƒçš„æŒ‡å®šå¤§å°æ’å€¼å’Œæ„å»ºä¸€ä¸ªè¡¨ã€‚Evaluate()ä»…åœ¨é¢„è®¡ç®—å¯¹è±¡ä¸­è¢«è°ƒç”¨ã€‚ æˆ‘ä»¬ä¿®æ”¹äº†ä¸€ä¸‹AnimatedVariableç±»ï¼Œç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š template &lt;typename T&gt;class AnimatedVariable&#123; // &lt;snip&gt;private: int mNumValues; T mSingleValue; struct Key &#123; float mTime; T mvalue; &#125;; std::vector&lt;Key&gt; mKeys; AnimatedVariablePrecomputed&lt;T&gt; *mPrecomputed;&#125;; æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªç¼“å­˜å€¼mSingleValueï¼Œå’Œä¸€ä¸ªæ•´æ•°mNumValuesï¼Œç”¨äºå‘Šè¯‰æˆ‘ä»¬ä½•æ—¶æ‰ä½¿ç”¨mSingleValueã€‚å¦‚æœmNumValuesæ˜¯1ï¼ˆå³å¯¹åº”å•å€¼çš„æƒ…å†µï¼‰ï¼ŒEvaluate()ä¼šç›´æ¥è¿”å›mSingleValueçš„å€¼â€”â€”ä¸éœ€è¦å…¶ä»–å¤šä½™çš„å¤„ç†ã€‚ä½ è¿˜å¯ä»¥æ³¨æ„åˆ°æ’å…¥æ—¶é—´å’Œå€¼æ„é€ çš„Keyèƒ½å¤Ÿå‡å°‘ç¼“å­˜æœªå‘½ä¸­çš„æƒ…å†µã€‚ æŒ‡å‘æ­¤ç±»çš„æ•°æ®å‘é‡å¤§å°ç°åœ¨èŒƒå›´ä»24åˆ°36ä¸ªå­—èŠ‚ä¸ç­‰ï¼Œå…·ä½“å–å†³äºæ¨¡æ¿ç±»å‹ï¼ˆåŒæ—¶ä¹Ÿä¾èµ–ä¸å¹³å°ï¼Œstd::vector&lt;&gt;çš„å¤§å°ä¹Ÿä¼šä¸åŒï¼‰ã€‚ Evaluate()ä¹‹å‰çš„ä»£ç çœ‹èµ·æ¥æ˜¯è¿™æ ·å­çš„ï¼š template &lt;typename T&gt;T AnimatedVariablePrecomputed&lt;T&gt;::Evaluate(float time) const&#123; in numValues = mPrecomputedValues.size(); RIOT_ASSERT(numValues &gt; 1); int index = static_cast&lt;int&gt;(time * numValues); // clamp to valid table entry to handle the 1.0 boundary or out of bounds input index = Clamp(index, 0, numValues - 1); return mPrecomputedValues[index];&#125; ä¿®æ”¹åçš„Evaluate()æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼Œè¿™æ˜¯åœ¨VTuneä¸­å±•ç¤ºçš„ã€‚ä½ å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªå¯èƒ½çš„æ‰§è¡Œcaseï¼šå•å€¼ï¼ˆçº¢è‰²éƒ¨åˆ†ï¼‰ï¼Œçº¿æ€§æ’å€¼ï¼ˆè“è‰²éƒ¨åˆ†ï¼‰å’Œé¢„è®¡ç®—æŸ¥è¯¢ï¼ˆç»¿è‰²éƒ¨åˆ†ï¼‰ã€‚ åœ¨VTuneä¸­å±•ç¤ºçš„ä¼˜åŒ–è¿‡çš„ä»£ç ç‰‡æ®µ ä¿®æ”¹åçš„ä»£ç æ‰§è¡Œé€Ÿåº¦å¤§çº¦å¿«äº†3å€ï¼šåœ¨æœ€æ…¢çš„å‡½æ•°åˆ—è¡¨ä¸­è¯¥å‡½æ•°ä»ç¬¬ä¸‰ä½é™åˆ°äº†ç¬¬22ä½ï¼ä¸ä»…æ‰§è¡Œæ›´å¿«ï¼ŒåŒæ—¶è¿˜é™ä½äº†å†…å­˜çš„ä½¿ç”¨ï¼Œå¤§çº¦å‡å°‘äº†750kbã€‚è¿™è¿˜ä¸ç®—å®Œï¼Œä¸ä»…å‡½æ•°æ‰§è¡Œæ›´å¿«ï¼Œå å†…å­˜æ›´å°‘ï¼ŒåŒæ—¶æé«˜äº†çº¿æ€§æ’å€¼çš„å‡†ç¡®åº¦ã€‚å¯è°“ä¸€çŸ³ä¸‰é¸Ÿã€‚ è¿™é‡Œå¹¶æ²¡æœ‰æåˆ°çš„å†…å®¹ï¼ˆå°½ç®¡æ–‡ç« å·²ç»è¶³å¤Ÿé•¿äº†ï¼‰æ˜¯æˆ‘å¦‚ä½•é€šè¿‡ä¸æ–­è¿­ä»£æ‰¾åˆ°äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆã€‚æˆ‘æœ€åˆçš„å°è¯•å‡å°‘åœ¨ç²’å­ç”Ÿå‘½å‘¨æœŸå†…æ ·æœ¬è¡¨çš„å¤§å°ã€‚è¿™ä¸ªæ–¹æ¡ˆå‡ ä¹æœ‰æ•ˆâ€”â€”ä½†æœ‰äº›ç§»åŠ¨è¾ƒå¿«çš„ç²’å­ç”±äºæ ·æœ¬è¡¨çš„å‡å°‘ï¼Œå˜çš„å‚å·®ä¸é½ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ªç°è±¡å¾ˆå¿«å°±è¢«å‘ç°äº†ï¼Œä½¿å¾—æˆ‘ä¾ç„¶èƒ½å¤Ÿå°†æ–¹æ¡ˆæ›´æ¢ä¸ºæœ¬æ–‡ä¸­æåˆ°çš„æ–¹æ³•ã€‚å½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä»£ç ä¿®æ”¹ï¼Œä½†æ˜¯å¯¹äºæ€§èƒ½æé«˜å¹¶æ²¡æœ‰ç›´æ¥æ•ˆæœï¼Œä¹Ÿæœ‰äº›ä»£ç çš„ä¿®æ”¹ç”šè‡³é€ æˆäº†ä»£ç æ‰§è¡Œæ›´æ…¢ã€‚ æ€»ç»“æœ¬æ–‡ä¸­ä»‹ç»çš„æ˜¯è‹±é›„è”ç›Ÿæ¸¸æˆä»£ç åº“ä¸­ä»£ç ä¼˜åŒ–çš„ä¸€ä¸ªå…¸å‹æ¡ˆä¾‹ã€‚è™½ç„¶å˜åŠ¨æ›´å°ï¼Œä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨ä½¿å¾—å†…å­˜èŠ‚çº¦äº†750kbï¼Œç²’å­çº¿ç¨‹æ¯”è¾ƒä¹‹å‰è¿è¡Œå¿«äº†1åˆ°2æ¯«ç§’ï¼Œè¿™ä½¿å¾—ä¸»çº¿ç¨‹æ‰§è¡Œçš„æ›´å¿«ã€‚ å½“ç¨‹åºå‘˜å¯»æ±‚ä¼˜åŒ–çš„æ—¶å€™ï¼Œè™½ç„¶çœ‹ä¼¼æ˜¾è€Œæ˜“è§ï¼Œä½†è¿™é‡Œæåˆ°çš„ä¸‰ä¸ªé˜¶æ®µéƒ½å¸¸å¸¸ä¼šè¢«å¿½è§†ã€‚è¿™é‡Œåªæ˜¯ä¸ºäº†å¼ºè°ƒä¸€ä¸‹ï¼š é‰´åˆ«ï¼šåˆ†æåº”ç”¨å¹¶æ‰¾å‡ºæ€§èƒ½æœ€å·®çš„éƒ¨åˆ† ç†è§£ï¼šç†è§£ä»£ç çš„æœ¬æ„å’Œæ‰§è¡Œç¼“æ…¢çš„åŸå›  è¿­ä»£ï¼šåŸºäºä¸Šé¢ä¸¤ä¸ªé˜¶æ®µçš„åˆ°çš„æˆæœè¿›è¡Œä»£ç çš„ä¿®æ”¹ã€è¿­ä»£ï¼Œå¹¶é‡æ–°åˆ†æã€‚é‡å¤è¿™ä¸‰ä¸ªæ­¥éª¤ç›´åˆ°è¶³å¤Ÿå¿«ã€‚ ä¸Šé¢æåˆ°çš„è§£å†³æ–¹æ¡ˆä¸è§å¾—æ˜¯æœ€å¿«çš„è§£å†³æ–¹æ¡ˆï¼Œä½†è‡³å°‘æ–¹å‘æ˜¯æ­£ç¡®çš„â€”â€”æ€§èƒ½æå‡çš„å®‰å…¨è·¯å¾„æ˜¯é€šè¿‡è¿­ä»£æ”¹è¿›ã€‚ æœ¬æ–‡ä½œè€…ï¼šTony Albrecht","tags":[{"name":"ç¿»è¯‘","slug":"ç¿»è¯‘","permalink":"http://elbarco.cn/tags/ç¿»è¯‘/"}]},{"title":"å¼€å±±ç¬¬ä¸€ç¯‡","date":"2016-03-03T01:30:24.000Z","path":"2016/03/03/å¼€å±±ç¬¬ä¸€ç¯‡/","text":"å…³äºåšå®¢ç”¨è¿‡å¥½å¤šåšå®¢ï¼Œå¦‚Cnblogã€CSDNã€ITeyeç­‰ç­‰ï¼Œåæ¥è§‰å¾—ç”¨Githubæ›´Geekä¸€ç‚¹ï¼Œäºæ˜¯å­¦ä¹ gizakæäº†ä¸€ä¸ªä»‹ä¸ªã€‚åæ¥ï¼Œåœ¨éƒ­å¸ˆå“¥çš„æ€‚æ¿ä¸‹ï¼Œæäº†å°é˜¿é‡Œäº‘ä¸»æœºæŠŠç©ï¼Œå› ä¸ºæœ‰ä¹‹å‰çš„ç»éªŒï¼Œæ‰€ä»¥æ¯”è¾ƒæ„‰å¿«é€‰æ‹©äº†Hexoæ¥æ­å»ºè‡ªå·±çš„åšå®¢ã€‚æ‹–å»¶äº†å¥½ä¹…ï¼Œä¸Šå‘¨æœ«ç»ˆäºä¸‹å®šå†³å¿ƒå¥½å¥½å¼„ä¸€å¼„ã€‚ Hexoçš„ä¸»é¢˜ååˆ†ä¸°å¯Œï¼Œå®˜æ–¹çš„ä¸»é¢˜å‘è¿™é‡Œ(è‡ªå¤‡æ¢¯å­)çœ‹é½ã€‚è‡³äºæˆ‘ï¼Œé€‰ç”¨çš„æ˜¯indigoï¼Œå› ä¸ºMaterial Designçš„é£æ ¼å¾ˆèˆ’æœï¼Œè€Œä¸”ç§»åŠ¨è®¾å¤‡é€‚é…ä¹Ÿå¾ˆå¥½ï¼ŒåŠŸèƒ½åŸºæœ¬æ»¡è¶³ï¼Œä¸ªæ€§åŒ–å®šåˆ¶ä¹Ÿæ–¹ä¾¿ï¼ˆä¸»è¦æ˜¯ä¿®æ”¹èµ·æ¥æ–¹ä¾¿â€¦â€¦(:3 ã€âˆ )ï¼‰ã€‚åˆšæ­å»ºå®Œæˆçš„æ—¶å€™ï¼Œæˆ‘å°†æ•´ä¸ªåšå®¢çš„æºç éƒ½æ”¾åœ¨äº†GitHubä¸Šé¢ï¼Œçœ‹è¿™ä¸ªé¡¹ç›®ï¼Œdevåˆ†æ”¯æ˜¯å¤‡ä»½ï¼Œmasteråˆ†æ”¯æ˜¯ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„åšå®¢å†…å®¹ã€‚Feel free to build your own blog based on that. å…³äºæˆ‘90åï¼Œç”·ï¼Œå•èº«ç‹—ï¼Œç¨‹åºçŒ¿ã€‚ç›®å‰å¸éƒ½æŸåˆ›ä¸šå‹äº’è”ç½‘å…¬å¸å°±èŒï¼Œäº‘è®¡ç®—ç›¸å…³çš„Javaæ”»åŸç‹®ï¼Œæ‰€ä»¥åˆ°åº•æ˜¯ğŸ¶è¿˜æ˜¯ğŸ¦ï¸ï¼Œå‚»å‚»åˆ†ä¸æ¸…æ¥šã€‚å–œæ¬¢åšæŠ€æœ¯ï¼Œçƒ­çˆ±äº’è”ç½‘ï¼Œæ‹¥æŠ±å¼€æºã€‚ä¸€ä¸ªäººæƒ¯äº†ï¼Œä¹Ÿçˆ±å®…ã€‚çˆ±å¥½ååˆ†å¹¿æ³›ï¼Œç¾å‰§ã€ç”µå½±ã€éŸ³ä¹ã€æ—…è¡Œã€æŠ˜è…¾ã€‚å…¶ä»–å…³é”®å­—ï¼Œå¼ºè¿«ç—‡ï¼ˆå°½ç®¡æˆ‘æ˜¯å°„æ‰‹åº§ä¸æ˜¯å¤„å¥³åº§ï¼‰ã€è½»å¾®äººæ ¼åˆ†è£‚ã€å¶å°”çŠ¯äºŒâ€¦â€¦å„ä½çœ‹å®˜ï¼Œéšä¾¿æ„Ÿå—ä¸‹å°±å¥½ã€‚è¿™é‡Œçš„æˆ‘ï¼Œæ— å…³ç´§è¦ã€‚ å…³äºåŸŸåç›®å‰åŸŸåä¸º0x4b5.topï¼Œæ•°å­—è¡¨ç¤ºäº†æˆ‘çš„ç”Ÿæ—¥ï¼Œæ— ä»–ã€‚æ­£åœ¨å¤‡æ¡ˆçš„åŸŸåelbarco.cnï¼Œé€šè¿‡åå°†æ­£å¼å¯ç”¨ã€‚El barcoï¼ˆéŸ³è¯‘ï¼šåŸƒå°”å·´ç§‘ï¼‰ï¼Œè¥¿ç­ç‰™è¯­èˆ¹çš„æ„æ€ï¼Œæœ‹å‹ä»¬å–Šæˆ‘å°èˆ¹ï¼Œä¼°è®¡æ˜¯å› ä¸ºæˆ‘æ˜¯å¼ å¸†ã€‚å®¶äººå–çš„è¿™åé‡åç‡æé«˜ï¼Œé€‰ä¸ªåŸŸåæ— ä»ä¸‹æ‰‹ï¼Œæ‰€ä»¥æ‰æƒ³åˆ°äº†ç”¨El barcoï¼ŒBTWï¼Œæœ¬åŸŸåä¸ä»€ä¹ˆelbarco.comæ¯«æ— å…³ç³»ï¼Œç‰¹æ­¤å£°æ˜ã€‚ä¹Ÿå¸Œæœ›åœ¨è¿™é‡Œï¼Œæˆ‘èƒ½åšé‚£æ²‰èˆŸä¾§ç•”åƒå¸†ä¸­çš„ä¸€å‘˜ï¼Œæœ‰æ‰€åˆ†äº«ï¼Œæœ‰æ‰€è¿›æ­¥ã€‚ æœ€åï¼Œæ„Ÿè°¢å„ä½çœ‹å®˜è€çˆ·ã€‚","tags":[{"name":"æ‚","slug":"æ‚","permalink":"http://elbarco.cn/tags/æ‚/"}]}]